function _saveTask(a,b,c){Fire.AssetDB.task("save",function(){var d=b||null,e=c||null;Fire.AssetDB.saveAsset(a,d,e).on("end",function(a,b){for(var c=0;c<b.length;++c){var d=b[c];"create"===d.command?Fire.sendToAll("asset:created",{url:d.url,uuid:d.uuid,"parent-uuid":d.parentUuid}):"change"===d.command&&Fire.sendToAll("asset:changed",{uuid:d.uuid}),Fire.sendToAll("asset:saved",{url:d.url,uuid:d.uuid})}Fire.AssetDB.taskDone()})})}var Shell=require("shell"),Path=require("fire-path"),Url=require("fire-url"),Fs=require("fire-fs"),Ipc=require("ipc");Ipc.on("asset-db:explore",function(a){var b=a.url,c=Fire.AssetDB.fspath(b);Shell.showItemInFolder(c)}),Ipc.on("asset-db:explore-lib",function(a){var b=a.url,c=Fire.AssetDB.urlToUuid(b);""!==c&&Shell.showItemInFolder(Fire.AssetDB.uuidToLibraryPath(c))}),Ipc.on("asset-db:import",function(a){var b=a["dest-url"],c=a.files;Fire.AssetDB.watchOFF(),Fire.AssetDB.task("import",function(){Fire.AssetDB.importTo(b,c).on("end",function(a){Fire.sendToAll("assets:created",{results:Fire.AssetDB.results(b,a)}),Fire.AssetDB.taskDone(),Fire.mainWindow.isFocused||Fire.AssetDB.watchON()})})}),Ipc.on("asset-db:reimport",function(a){var b=a.url;Fire.AssetDB.task("reimport",function(){var a=Fire.AssetDB.isRoot(b),c=!0;a&&(c=!1);var d=Fire.AssetDB.urlToUuid(b);Fire.AssetDB.clean(b,c).on("end",function(a){return Fire.sendToAll("assets:deleted",{results:a}),Fire.AssetDB.exists(b)?void Fire.AssetDB.precache(b,{includeSelf:c}).on("end",function(){Fire.AssetDB.refresh(b,{force:!0,includeSelf:c}).on("end",function(a){Fire.sendToAll("assets:created",{results:Fire.AssetDB.results(b,a)}),Fire.AssetDB.taskDone()})}):void Fire.AssetDB.taskDone()})})}),Ipc.on("asset-db:delete",function(a){var b=a.url;Fire.AssetDB.task("delete",function(){Fire.AssetDB.deleteAsset(b).on("end",function(a,b){Fire.sendToAll("assets:deleted",{results:b}),Fire.AssetDB.taskDone()})})}),Ipc.on("asset-db:move",function(a){var b=a["src-url"],c=a["dest-url"];Fire.AssetDB.task("move",function(){Fire.AssetDB.moveAsset(b,c).on("end",function(a,b){for(var c=0;c<b.length;++c){var d=b[c];Fire.sendToAll("asset:moved",{uuid:d.uuid,"dest-url":d.destUrl,"dest-parent-uuid":d.destParentUuid})}Fire.AssetDB.taskDone()})})}),Ipc.on("asset-db:save",function(a){var b=a.url,c=a.json,d=a.buffer;_saveTask(b,c,d)}),Ipc.on("asset-db:save-by-uuid",function(a){var b=a.uuid,c=a.json,d=a.buffer,e=Fire.AssetDB.uuidToUrl(b);_saveTask(e,c,d)}),Ipc.on("asset-db:new-folder",function(a){Fire.AssetDB.makedirs(a.url)}),Ipc.on("asset-db:new-script",function(a){var b=a.url,c=a.template,d=Url.extname(b),e=Fire.url("fire://templates/"+c+d);Fs.readFile(e,function(a,c){var d=new Fire.ScriptAsset;_saveTask(b,Fire.serialize(d),c)})}),Ipc.on("asset-db:apply",function(a){Fire.AssetDB.task("apply",function(){var b=a["meta-json"]||null,c=a["asset-json"]||null,d=a["asset-buffer"]||null,e=a["asset-dirty"]||!1;Fire.AssetDB.applyAsset(b,c,d,e).on("end",function(a,b){for(var c=[],d=0;d<b.length;++d){var e=b[d];"change"===e.command?Fire.sendToAll("asset:changed",{uuid:e.uuid}):"create"===e.command?Fire.sendToAll("asset:created",{url:e.url,uuid:e.uuid,"parent-uuid":e.parentUuid}):"delete"===e.command&&c.push({url:e.url,uuid:e.uuid})}c.length>0&&Fire.sendToAll("assets:deleted",{results:c}),Fire.AssetDB.taskDone()})})}),Ipc.on("asset-db:query",function(a,b){Fire.AssetDB.task("query",function(){var c=b.url,d=b["type-id"]||Fire.JS._getClassId(Fire.Asset);Fire.AssetDB.queryAssets(c,d).on("end",function(b){a(b),Fire.AssetDB.taskDone()})})}),Ipc.on("asset-db:deep-query",function(a,b){var c=b.url;Fire.AssetDB.task("deep-query",function(){Fire.AssetDB.deepQuery(c).on("end",function(b){var d=Fire.AssetDB.results(c,b);a(d),Fire.AssetDB.taskDone()})})});