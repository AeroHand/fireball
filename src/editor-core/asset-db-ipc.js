function _saveTask(a,b){Fire.AssetDB.task("save",function(){Fire.AssetDB.saveAsset(a,b).on("end",function(a,b){for(var c=0;c<b.length;++c){var d=b[c];"create"===d.command?Fire.sendToAll("asset:created",d.url,d.uuid,d.parentUuid):"change"===d.command&&Fire.sendToAll("asset:changed",d.uuid),Fire.sendToAll("asset:saved",d.url,d.uuid)}Fire.AssetDB.taskDone()})})}var Shell=require("shell"),Path=require("fire-path"),Ipc=require("ipc");Ipc.on("asset-db:explore",function(a){var b=Fire.AssetDB.fspath(a);Shell.showItemInFolder(b)}),Ipc.on("asset-db:explore-lib",function(a){var b=Fire.AssetDB.urlToUuid(a);""!==b&&Shell.showItemInFolder(Fire.AssetDB.uuidToLibraryPath(b))}),Ipc.on("asset-db:import",function(a,b){Fire.AssetDB.watchOFF(),Fire.AssetDB.task("import",function(){Fire.AssetDB.importTo(a,b).on("end",function(b){Fire.sendToAll("assets:created",Fire.AssetDB.results(a,b)),Fire.AssetDB.taskDone(),Fire.App.mainWindow.isFocused||Fire.AssetDB.watchON()})})}),Ipc.on("asset-db:reimport",function(a){Fire.AssetDB.task("reimport",function(){var b=Fire.AssetDB.isRoot(a),c=!0;b&&(c=!1);var d=Fire.AssetDB.urlToUuid(a);Fire.AssetDB.clean(a,c).on("end",function(b){return Fire.sendToAll("assets:deleted",b),Fire.AssetDB.exists(a)?void Fire.AssetDB.precache(a,{includeSelf:c}).on("end",function(){Fire.AssetDB.refresh(a,{force:!0,includeSelf:c}).on("end",function(b){Fire.sendToAll("assets:created",Fire.AssetDB.results(a,b)),Fire.AssetDB.taskDone()})}):void Fire.AssetDB.taskDone()})})}),Ipc.on("asset-db:delete",function(a){Fire.AssetDB.task("delete",function(){Fire.AssetDB.deleteAsset(a).on("end",function(a,b){Fire.sendToAll("assets:deleted",b),Fire.AssetDB.taskDone()})})}),Ipc.on("asset-db:move",function(a,b){Fire.AssetDB.task("move",function(){Fire.AssetDB.moveAsset(a,b).on("end",function(a,b){for(var c=0;c<b.length;++c){var d=b[c];Fire.sendToAll("asset:moved",d.uuid,d.destUrl,d.destDirUuid)}Fire.AssetDB.taskDone()})})}),Ipc.on("asset-db:save",function(a,b){_saveTask(a,b)}),Ipc.on("asset-db:save-by-uuid",function(a,b){var c=Fire.AssetDB.uuidToUrl(a);_saveTask(c,b)}),Ipc.on("asset-db:apply",function(a,b,c){Fire.AssetDB.task("apply",function(){Fire.AssetDB.applyAsset(a,b,c).on("end",function(a,b){for(var c=[],d=0;d<b.length;++d){var e=b[d];"change"===e.command?Fire.sendToAll("asset:changed",e.uuid):"create"===e.command?Fire.sendToAll("asset:created",e.url,e.uuid,e.parentUuid):"delete"===e.command&&c.push({url:e.url,uuid:e.uuid})}c.length>0&&Fire.sendToAll("assets:deleted",c),Fire.AssetDB.taskDone()})})}),Ipc.on("asset-db:query",function(a,b){Fire.AssetDB.task("query",function(){Fire.AssetDB.queryAssets(a,b).on("end",function(c){Fire.sendToAll("asset-db:query-results",a,b,c),Fire.AssetDB.taskDone()})})}),Ipc.on("asset-db:deep-query",function(a){Fire.AssetDB.task("deep-query",function(){Fire.AssetDB.deepQuery(a).on("end",function(b){var c=Fire.AssetDB.results(a,b);Fire.sendToAll("asset-db:deep-query-results",a,c),Fire.AssetDB.taskDone()})})});