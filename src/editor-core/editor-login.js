function _verifyEmail(a){var b=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;return b.test(a)}var Path=require("fire-path"),Fs=require("fire-fs"),Ipc=require("ipc"),Request=require("request");Ipc.on("editor:login",function(a,b,c){var d=_verifyEmail(b),e={username:d?"":b,email:d?b:"",password:c},f={url:"https://accounts.fireball-x.com/login",form:e,headers:{accept:"application/json","content-type":"application/json"}};Request.post(f,function(b,c,d){if(b)return void a(b.message);if(200!==c.statusCode)return void a(JSON.parse(d).error.message);var e=JSON.parse(d).id,f=JSON.parse(d).userId,g={url:"https://accounts.fireball-x.com/api/users/"+f+"?access_token="+e,headers:{accept:"application/json","content-type":"application/json"}};Request.get(g,function(b,c,d){if(b)return void a(b.message);if(200!==c.statusCode)return void a(JSON.parse(d).error.message);var f=JSON.parse(d);Editor.token=e,Editor.userInfo=f,Editor.sendToWindows("editor:user-info-changed",{token:e,"user-info":f}),a(null,{token:e,"user-info":f})})})}),Ipc.on("editor:token-login",function(a,b,c){var d={url:"https://accounts.fireball-x.com/api/users/"+c+"?access_token="+b,headers:{accept:"application/json","content-type":"application/json"}};Request.get(d,function(c,d,e){if(c)return void a(c);if(200!==d.statusCode)return void a(JSON.parse(e).error.message);var f=JSON.parse(e);Editor.userInfo=f,Editor.token=b,Editor.sendToWindows("editor:user-info-changed",{token:Editor.token,"user-info":f}),a(f)})}),Ipc.on("editor:logout",function(a){var b={url:"https://accounts.fireball-x.com//logout?access_token="+Editor.token,headers:{accept:"application/json","content-type":"application/json"}};Editor.token=null,Editor.userInfo=null;var c=Editor.loadProfile("fireball","global"),d=c["last-login"];c["last-login"]="",c["login-type"]="account";var e=Path.join(Editor.dataPath,".info");if(Fs.existsSync(e)){var f=JSON.parse(Fs.readFileSync(e));f[d]&&delete f[d],Fs.writeFileSync(e,JSON.stringify(f,null,2))}c.save(),Request.post(b,function(a,b,c){a||200!==b.statusCode||Editor.sendToWindows("editor:user-info-changed",{token:null,"user-info":null})}),a("log out")});