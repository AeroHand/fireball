var Ipc=require("ipc"),Path=require("fire-path");require("./reloader");var SEND_PROJ_LOAD="project-plugin:load",SEND_PROJ_UNLOAD="project-plugin:unload",SEND_LOAD="plugin:load",SEND_UNLOAD="plugin:unload",PackageManager=exports,loadedPlugins={},uuidToNames={};Ipc.on("window-reloaded",function(a){if(a.isMainWindow)for(var b in loadedPlugins){var c=loadedPlugins[b];Fire.sendToMainWindow(SEND_LOAD,c["package"],c.path)}}),PackageManager.loadPlugin=function(a,b){var c=a.name;if(!c||"string"!=typeof c)return void Fire.error("Invalid name of package %s(%s)",c,b);var d={path:b,"package":a};loadedPlugins[c]=d,Fire.mainWindow&&Fire.mainWindow.isLoaded&&Fire.sendToMainWindow(SEND_LOAD,a,b)},PackageManager.unloadPlugin=function(a){Fire.sendToMainWindow(SEND_UNLOAD,a),delete loadedPlugins[a],Fire.PanelMng.closeAll(a)},PackageManager.getPackageInfo=function(a){var b=loadedPlugins[a];return b?b["package"]:null},PackageManager.getPackagePath=function(a){var b=loadedPlugins[a];return b?Path.dirname(b.path):""},Ipc.on("assets:deleted",function(a){for(var b=a.results,c=0;c<b.length;c++)PackageManager.unloadProjectPlugin(b[c].uuid)}),PackageManager.unloadProjectPlugin=function(a){var b=uuidToNames[a];delete uuidToNames[a],b&&(this.unloadPlugin(b),Fire.sendToCore(SEND_PROJ_UNLOAD,b))},PackageManager.loadProjectPlugin=function(a,b,c){Fire.sendToCore(SEND_PROJ_LOAD,b,c),this.loadPlugin(b,c);var d=b.name;uuidToNames[a]=d};