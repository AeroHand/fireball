function parseTemplate(a,b){for(var c=a.length-1;c>=0;c--){var d=a[c];if(d.visible!==!1)if(d.message){if(d.click){Fire.error("Not support to use click and message at the same time: "+d.label);continue}var e=[d.message];if(d.params){if(!Array.isArray(d.params))return void Fire.error("message parameters must be an array");e=e.concat(d.params),delete d.params}d.click=function(a){return b?function(){b.send.apply(b,a)}:function(){Fire.sendToPages.apply(Fire,a),setImmediate(function(){Fire.sendToCore.apply(Fire,a)})}}(e),delete d.message}else d.submenu&&parseTemplate(d.submenu,b);else a.splice(c,1)}}var Ipc=require("ipc"),Menu=require("menu"),MenuItem=require("menu-item"),BrowserWindow=require("browser-window"),FireMenu={};FireMenu.buildFromTemplate=function(a,b){return parseTemplate(a,b),Menu.buildFromTemplate(a)},FireMenu.setApplicationMenu=function(a){Menu.setApplicationMenu(a)},FireMenu.reset=function(){},FireMenu.find=function(a,b,c){function d(a,b){for(var c=0;c<a.items.length;c++){var d=a.items[c];if(d.label===b)return d}return null}a=a.submenu||a,c="undefined"!=typeof c?c:!1;for(var e=b.split("/"),f=null,g=0;g<e.length;g++){var h=g===e.length-1,i=e[g];if(f=d(a,i)){if(h)return f;if(!f.submenu||"submenu"!==f.type)return console.error("menu path already occupied: %s",b),null}else{if(!c)return Fire.error("Can not find menu item by: "+b),null;if(f=new MenuItem({label:i,submenu:new Menu,type:"submenu"}),a.append(f),h)return f}a=f.submenu}return f},Ipc.on("menu:popup",function(a,b,c,d){var e=FireMenu.buildFromTemplate(b,a.sender);c&&(c=Math.floor(c)),d&&(d=Math.floor(d)),e.popup(BrowserWindow.fromWebContents(a.sender),c,d)}),module.exports=FireMenu;