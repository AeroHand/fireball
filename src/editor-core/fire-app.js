function getOptions(a){var b=a[a.length-1];return b&&"object"==typeof b&&b.FIRE_MSG_OPTIONS&&b}function doSendToCore(a,b){"use strict";if(arguments.length>2){var c,d=getOptions(arguments);return d?d.RequireIpcEvent?(c=[].slice.call(arguments,0,-1),c[0]=b,c[1]=a):c=[].slice.call(arguments,1,-1):c=[].slice.call(arguments,1),Ipc.emit.apply(Ipc,c)}return Ipc.emit(b)}function sendToWindows(a,b){"use strict";if(arguments.length>2){var c,d=getOptions(arguments);if(d){if(c=[].slice.call(arguments,1,-1),d.SelfExcluded)return void Fire.sendToWindowsExclude(c,a.sender)}else c=[].slice.call(arguments,1);Fire.sendToWindows.apply(Fire,c)}else Fire.sendToWindows(b)}function FireApp(){this.id=Math.randomRangeInt(0,1e3),Fire.App=this,Fire.Window=require("./fire-window"),Fire.PanelMng=require("./panel-mng"),Fire.JS.mixin(Fire,{log:function(){var a=Util.format.apply(Util,arguments);Winston.normal(a),Fire.sendToWindows("console:log",a)},success:function(){var a=Util.format.apply(Util,arguments);Winston.success(a),Fire.sendToWindows("console:success",a)},failed:function(){var a=Util.format.apply(Util,arguments);Winston.failed(a),Fire.sendToWindows("console:failed",a)},info:function(){var a=Util.format.apply(Util,arguments);Winston.info(a),Fire.sendToWindows("console:info",a)},warn:function(){var a=Util.format.apply(Util,arguments);Winston.warn(a),console.trace(),Fire.sendToWindows("console:warn",a)},error:function(){var a=Util.format.apply(Util,arguments);Winston.error(a),console.trace(),Fire.sendToWindows("console:error",a)},fatal:function(){var a=Util.format.apply(Util,arguments);Winston.fatal(a),console.trace()},sendToWindowsExclude:function(a,b){for(var c=Fire.Window.windows.slice(),d=0;d<c.length;++d){var e=c[d];e.nativeWin.webContents!==b&&e.sendToPage.apply(e,a)}},sendToWindows:function(){for(var a=Fire.Window.windows.slice(),b=0;b<a.length;++b){var c=a[b];c.sendToPage.apply(c,arguments)}},sendToCore:function(){Ipc.emit.apply(Ipc,arguments)===!1&&Fire.failed("sendToCore "+arguments[0]+" failed.")},sendToAll:function(){if(arguments.length>1){var a=!0,b=arguments,c=getOptions(arguments);c&&(b=[].slice.call(arguments,0,-1),c.SelfExcluded&&(a=!1)),a&&Ipc.emit.apply(Ipc,b),Fire.sendToWindows.apply(Fire,b)}else Ipc.emit(arguments[0]),Fire.sendToWindows(arguments[0])},sendToPlugin:function(a,b){for(var c=Fire.PanelMng.findPanels(a),d=[].slice.call(arguments,1),e=0;e<c.length;++e)Fire.sendToPanel.apply(Fire,[a,c[e]].concat(d))},sendToPanel:function(a,b,c){var d=Fire.PanelMng.findWindow(a,b);if(!d)return void Fire.warn("Failed to send %s to panel %s, can not find it.",c,b);var e=[].slice.call(arguments,0);e.unshift("fire:send2panel"),d.sendToPage.apply(d,e)},sendToMainWindow:function(){var a=Fire.mainWindow;a?a.sendToPage.apply(a,arguments):console.error('Failed to send "%s" because main page not initialized.',arguments[0])}}),this.registerGlobalShortcut(),this.registerGlobal(),this.registerBuiltinMessages()}var Util=require("util"),EventEmitter=require("events"),Ipc=require("ipc"),BrowserWindow=require("browser-window"),Winston=require("winston");Ipc.on("fire:send2core",function a(b,c){"use strict";doSendToCore.apply(Ipc,arguments)||Fire.failed("fire:send2core@"+c+" failed.")}),Ipc.on("fire:send2wins",sendToWindows),Ipc.on("fire:send2mainwin",function(a,b){"use strict";var c=Fire.mainWindow;if(c)if(arguments.length>2){var d=[].slice.call(arguments,1);c.sendToPage.apply(c,d)}else c.sendToPage(b);else console.error('Failed to send "%s" because main page not initialized.',b)}),Ipc.on("fire:send2all",function(){doSendToCore.apply(Ipc,arguments),sendToWindows.apply(Ipc,arguments)}),Ipc.on("fire:send2panel",function(a){var b=[].slice.call(arguments,1);Fire.sendToPanel.apply(Fire,b)}),Ipc.on("fire:sendreq2core",function(a,b,c,d){function e(){f?Fire.error('The callback which reply to "%s" can only be called once!',b):(f=!0,a.sender.send("fire:send-reply-back",[].slice.call(arguments),d))}var f=!1;c.unshift(b,e),Ipc.emit.apply(Ipc,c)||Fire.error('The listener of request "%s" is not yet registered!',b)}),Fire.JS.extend(FireApp,EventEmitter),FireApp.prototype.quit=function(){for(var a=Fire.Window.windows,b=0;b<a.length;++b)a[b].close()},FireApp.prototype.registerBuiltinMessages=function(){Ipc.on("console:log",Fire.log),Ipc.on("console:warn",Fire.warn),Ipc.on("console:error",Fire.error),Ipc.on("console:success",Fire.success),Ipc.on("console:failed",Fire.failed),Ipc.on("console:info",Fire.info)},FireApp.prototype.registerGlobalShortcut=function(){},FireApp.prototype.registerGlobal=function(){},module.exports=FireApp;