function getOptions(a){var b=a[a.length-1];return b&&"object"==typeof b&&b.FIRE_MSG_OPTIONS&&b}function doSendToCore(a,b){"use strict";if(arguments.length>2){var c;return c=getOptions(arguments)?[].slice.call(arguments,1,-1):[].slice.call(arguments,1),Ipc.emit.apply(Ipc,c)!==!1}return Ipc.emit(b)!==!1}function sendToCore(a,b){"use strict";doSendToCore.apply(Ipc,arguments)||Fire.failed("send2core@"+b+" failed.")}function sendToPages(a,b){"use strict";if(arguments.length>2){var c,d=getOptions(arguments);if(d){if(c=[].slice.call(arguments,1,-1),d.SelfExcluded)return void Fire.sendToPagesExclude(c,a.sender)}else c=[].slice.call(arguments,1);Fire.sendToPages.apply(Fire,c)}else Fire.sendToPages(b)}function FireApp(){this.id=Math.randomRangeInt(0,1e3),this._windows=[],this._mainWindow=null,Fire.App=this,Fire.mixin(Fire,{log:function(){var a=Util.format.apply(Util,arguments);Fire.Console.printID(Fire.App.id),Fire.Console.log(a),Fire.sendToPages("console:log",a)},warn:function(){var a=Util.format.apply(Util,arguments);Fire.Console.printID(Fire.App.id),Fire.Console.warn(a),Fire.sendToPages("console:warn",a)},error:function(){var a=Util.format.apply(Util,arguments);Fire.Console.printID(Fire.App.id),Fire.Console.error(a),Fire.sendToPages("console:error",a)},success:function(){var a=Util.format.apply(Util,arguments);Fire.Console.printID(Fire.App.id),Fire.Console.success(a),Fire.sendToPages("console:success",a)},failed:function(){var a=Util.format.apply(Util,arguments);Fire.Console.printID(Fire.App.id),Fire.Console.failed(a),Fire.sendToPages("console:failed",a)},info:function(){var a=Util.format.apply(Util,arguments);Fire.Console.printID(Fire.App.id),Fire.Console.info(a),Fire.sendToPages("console:info",a)},sendToPagesExclude:function(a,b){for(var c=Fire.App._windows.slice(),d=0;d<c.length;++d){var e=c[d];e.nativeWin.webContents!==b&&e.sendToPage.apply(e,a)}},sendToPages:function(){for(var a=Fire.App._windows.slice(),b=0;b<a.length;++b){var c=a[b];c.sendToPage.apply(c,arguments)}},sendToCore:function(){Ipc.emit.apply(Ipc,arguments)===!1&&Fire.failed("sendToCore "+arguments[0]+" failed.")},sendToAll:function(){if(arguments.length>1){var a=!0,b=arguments,c=getOptions(arguments);c&&(b=[].slice.call(arguments,0,-1),c.SelfExcluded&&(a=!1)),a&&Ipc.emit.apply(Ipc,b),Fire.sendToPages.apply(Fire,b)}else Ipc.emit(arguments[0]),Fire.sendToPages(arguments[0])},sendToPlugin:function(){PluginWindowMgr.sendToPlugin.apply(PluginWindowMgr,arguments)},sendToPage:function(a){var b=Fire.App.findWindow(a);if(!b)return void Fire.warn("Failed to send "+arguments[1]+" to "+a);var c=[].slice.call(arguments,1);b.sendToPage.apply(b,c)},sendToMainPage:function(){var a=Fire.App.mainWindow;a?a.sendToPage.apply(a,arguments):console.error('Failed to send "%s" because main page not initialized.',arguments[0])}}),this.registerGlobalShortcut(),this.registerGlobal(),this.registerBuiltinMessages()}var Util=require("util"),EventEmitter=require("events"),Ipc=require("ipc"),BrowserWindow=require("browser-window"),PluginWindowMgr=require("./packages/plugin-window-mgr");Ipc.on("send2core",sendToCore),Ipc.on("send2pages",sendToPages),Ipc.on("send2mainpage",function(a,b){"use strict";var c=Fire.App.mainWindow;if(c)if(arguments.length>2){var d=[].slice.call(arguments,1);c.sendToPage.apply(c,d)}else c.sendToPage(b);else console.error('Failed to send "%s" because main page not initialized.',b)}),Ipc.on("send2all",function(){doSendToCore.apply(Ipc,arguments),sendToPages.apply(Ipc,arguments)}),Ipc.on("rpc",function(a,b){"use strict";var c=b.split(":");if(2!==c.length)return void Fire.failed("rpc@"+b+" failed. Invalid command");var d=null,e=c[0],f=c[1];switch(e){case"app":d=Fire.App;break;case"asset-db":d=Fire.AssetDB;break;case"window":d=BrowserWindow.fromWebContents(a.sender);break;case"menu":d=Fire.FireMenu;break;default:d=Fire[e]}if(!d)return void Fire.failed("rpc@"+b+" failed. Can not find module "+e);var g=d[f],h=arguments.length>2?[].slice.call(arguments,2):[];return g&&"function"==typeof g?void g.apply(d,h):void(Ipc.emit.apply(Ipc,[b,a].concat(h))||Fire.failed("rpc@"+b+" failed."))}),Fire.extend(FireApp,EventEmitter),FireApp.prototype.quit=function(){for(var a=this._windows.slice(),b=0;b<a.length;++b)a[b].close()},FireApp.prototype.registerBuiltinMessages=function(){Ipc.on("app:quit",function(){this.quit()}.bind(this)),Ipc.on("console:log",Fire.log),Ipc.on("console:warn",Fire.warn),Ipc.on("console:error",Fire.error),Ipc.on("console:success",Fire.success),Ipc.on("console:failed",Fire.failed),Ipc.on("console:info",Fire.info)},FireApp.prototype.registerGlobalShortcut=function(){},FireApp.prototype.registerGlobal=function(){},Object.defineProperty(FireApp.prototype,"mainWindow",{get:function(){return this._mainWindow},set:function(a){this._mainWindow=a}}),FireApp.prototype.findWindow=function(a){for(var b=0;b<this._windows.length;++b){var c=this._windows[b];if(c.name===a)return c}return null},FireApp.prototype.addWindow=function(a){this._windows.push(a)},FireApp.prototype.removeWindow=function(a){var b=this._windows.indexOf(a);return-1===b?void Fire.warn("Can not find window "+a.name):void this._windows.splice(b,1)},module.exports=FireApp;