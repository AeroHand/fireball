(function(){function a(b,c){if(b){var d=Object.getOwnPropertyDescriptor(b,c);return d||a(Object.getPrototypeOf(b),c)}}function b(b,c,d){var e=a(c,b);Object.defineProperty(d,b,e)}function c(a){return"object"==typeof Node?a instanceof Node:a&&"object"==typeof a&&"number"==typeof a.nodeType&&"string"==typeof a.nodeName}function d(a,b,c){return function(d,e){var f=k.attr(d,e)||{};if(f.type!==a)return void k.warn("Can only indicate one type attribute for %s.%s.",t.getClassName(d),e);if(f.hasOwnProperty("default")){var g=f["default"];if("undefined"!=typeof g){var h=Array.isArray(g)||u(g);if(!h){var i=typeof g;if(i===a)if("object"===a){if(!g||g instanceof c)return;k.warn("The default value of %s.%s is not instance of %s.",t.getClassName(d),e,t.getClassName(c))}else k.warn('No needs to indicate the "%s" attribute for %s.%s, which its default value is type of %s.',b,t.getClassName(d),e,a);else k.warn('Can not indicate the "%s" attribute for %s.%s, which its default value is type of %s.',b,t.getClassName(d),e,i);delete f.type}}}}}function e(a,b){for(var c in x)Object.defineProperty(b,c,{value:x[c],writable:"__props__"===c,enumerable:"__props__"===c})}function f(a,b){var c;return a?(g(a),c=b?function(){this._observing=!1,b.apply(this,arguments),y(this,c),a.apply(this,arguments)}:function(){this._observing=!1,y(this,c),a.apply(this,arguments)}):c=b?function(){this._observing=!1,b.apply(this,arguments),y(this,c)}:function(){this._observing=!1,y(this,c)},c}function g(a){return k._isFireClass(a)?void k.error("Constructor can not be another FireClass"):"function"!=typeof a?void k.error("Constructor of FireClass must be function type"):a.length>0?void k.warn("Can not instantiate FireClass with arguments."):void 0}function h(a,b){b&&(a.toString=function(){var a=Function.toString.call(this);return a.replace("function ","function "+t.getClassName(this))})}function i(a){var b=a.constructor.prototype;return b.hasOwnProperty("__cid__")?a.__cid__:b.hasOwnProperty("__classname__")?a.__classname__:""}var j=this,k=j.Fire||{};if(k._customAssetMenuItems=[],k.addCustomAssetMenu=function(a,b,c){k._customAssetMenuItems.push({customAsset:a,menuPath:b,priority:c}),k.sendToPages&&k.sendToPages("asset:refresh-context-menu")},k.isNode=!("undefined"==typeof process||!process.versions||!process.versions.node),k.isNodeWebkit=!!(k.isNode&&"node-webkit"in process.versions),k.isAtomShell=!!(k.isNode&&"atom-shell"in process.versions),k.isApp=k.isNodeWebkit||k.isAtomShell,k.isPureWeb=!k.isNode&&!k.isApp,k.isEditor=k.isApp,k.isWeb=k.isAtomShell?"undefined"!=typeof process&&"renderer"===process.type:"undefined"==typeof __dirname||null===__dirname,k.isEditorCore=k.isApp&&!k.isWeb,Object.defineProperty(k,"isRetina",{get:function(){return k.isWeb&&window.devicePixelRatio&&window.devicePixelRatio>1}}),k.isNode)k.isDarwin="darwin"===process.platform,k.isWin32="win32"===process.platform;else{var l=window.navigator.platform;k.isDarwin="Mac"===l.substring(0,3),k.isWin32="Win"===l.substring(0,3)}var m=1,n=2,o=4,p=8,q=16,r={DontSave:o,EditorOnly:p,Dirty:q,Destroying:512,HideInGame:1024,HideInEditor:2048,IsOnEnableCalled:4096,IsOnLoadCalled:8192,IsOnStartCalled:16384,IsEditorOnEnabledCalled:32768};r.Hide=r.HideInGame|r.HideInEditor,k._ObjectFlags=r;var s=~(n|q|r.Destroying|r.IsOnEnableCalled|r.IsEditorOnEnabledCalled|r.IsOnLoadCalled|r.IsOnStartCalled),t=k.JS={addon:function(a){"use strict";a=a||{};for(var c=1,d=arguments.length;d>c;c++){var e=arguments[c];for(var f in e)f in a||b(f,e,a)}return a},mixin:function(a){"use strict";a=a||{};for(var c=1,d=arguments.length;d>c;c++){var e=arguments[c];if(e){if("object"!=typeof e){k.error("Fire.mixin called on non-object:",e);continue}for(var f in e)b(f,e,a)}}return a},extend:function(a,b){function c(){this.constructor=a}if(!b)return void k.error("The base class to extend from must be non-nil");if(!a)return void k.error("The class to extend must be non-nil");for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a},clear:function(a){for(var b=Object.keys(a),c=0;c<b.length;c++)delete a[b[c]]}};t.getClassName=function(a){if("function"==typeof a&&a.prototype.__classname__)return a.prototype.__classname__;if(a&&a.constructor){if(a.constructor.prototype&&a.constructor.prototype.hasOwnProperty("__classname__"))return a.__classname__;var b;if(a.constructor.name&&(b=a.constructor.name),a.constructor.toString){var c,d=a.constructor.toString();c=d.match("["===d.charAt(0)?/\[\w+\s*(\w+)\]/:/function\s*(\w+)/),c&&2===c.length&&(b=c[1])}return"Object"!==b?b:null}return null},function(){function a(a,b){return function(c,d){if(d.prototype.hasOwnProperty(a)&&delete b[d.prototype[a]],d.prototype[a]=c,c){var e=b[c];if(e&&e!==d){var f="A Class already exists with the same "+a+' : "'+c+'".';k.isEditor||(f+=' (This may be caused by error of unit test.) If you dont need serialization, you can set class id to "". You can also call Fire.unregisterClass to remove the id of unused class'),k.error(f)}else b[c]=d}}}var b={},c={};t._setClassId=a("__cid__",b);var d=a("__classname__",c);t.setClassName=function(a,b){d(a,b),a&&!b.prototype.hasOwnProperty("__cid__")&&t._setClassId(a,b)},t.unregisterClass=function(a){"use strict";for(var d=0;d<arguments.length;d++){var e=arguments[d].prototype,f=e.__cid__;f&&delete b[f];var g=e.__classname__;g&&delete c[g]}},t._getClassById=function(a){return b[a]},t.getClassByName=function(a){return c[a]},t._getClassId=function(a){return"function"==typeof a&&a.prototype.__cid__?a.prototype.__cid__:a&&a.constructor&&a.constructor.prototype&&a.constructor.prototype.hasOwnProperty("__cid__")?a.__cid__:""},Object.defineProperty(t,"_registeredClassIds",{get:function(){var a={};for(var c in b)a[c]=b[c];return a},set:function(a){t.clear(b);for(var c in a)b[c]=a[c]}}),Object.defineProperty(t,"_registeredClassNames",{get:function(){var a={};for(var b in c)a[b]=c[b];return a},set:function(a){t.clear(c);for(var b in a)c[b]=a[b]}})}(),k.log=function(){console.log.apply(console,arguments)},k.info=function(){(console.info||console.log).apply(console,arguments)},k.warn=function(){console.warn.apply(console,arguments)},k.error=console.error.bind?console.error.bind(console):function(){console.error.apply(console,arguments)},function(){var a=Math.PI/180,b=180/Math.PI;t.mixin(Math,{TWO_PI:2*Math.PI,HALF_PI:.5*Math.PI,deg2rad:function(b){return b*a},rad2deg:function(a){return a*b},rad180:function(a){return(a>Math.PI||a<-Math.PI)&&(a=(a+Math.TOW_PI)%Math.TOW_PI),a},rad360:function(a){return a>Math.TWO_PI?a%Math.TOW_PI:0>a?Math.TOW_PI+a%Math.TOW_PI:a},deg180:function(a){return(a>180||-180>a)&&(a=(a+360)%360),a},deg360:function(a){return a>360?a%360:0>a?360+a%360:a},randomRange:function(a,b){return Math.random()*(b-a)+a},randomRangeInt:function(a,b){return Math.floor(this.randomRange(a,b))},clamp:function(a,b,c){return b="undefined"==typeof b?0:b,c="undefined"==typeof c?1:c,Math.min(Math.max(a,b),c)},calculateMaxRect:function(a,b,c,d,e){var f=Math.min(b.x,c.x,d.x,e.x),g=Math.max(b.x,c.x,d.x,e.x),h=Math.min(b.y,c.y,d.y,e.y),i=Math.max(b.y,c.y,d.y,e.y);return a.x=f,a.y=h,a.width=g-f,a.height=i-h,a}})}(),k.Intersection=function(){function a(a,b,c,d){var e,f=(d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x),g=(b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x),h=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y);if(0!==h){var i=f/h,j=g/h;if(i>=0&&1>=i&&j>=0&&1>=j)return!0}return!1}function b(b,c,d){var e=new k.Vec2(d.x,d.y),f=new k.Vec2(d.x,d.yMax),g=new k.Vec2(d.xMax,d.yMax),h=new k.Vec2(d.xMax,d.y);return a(b,c,e,f)?!0:a(b,c,f,g)?!0:a(b,c,g,h)?!0:a(b,c,h,e)?!0:!1}function c(b,c,d){for(var e=d.points.length,f=0;e>f;++f){var g=d.points[f],h=d.points[(f+1)%e];if(a(b,c,g,h))return!0}return!1}function d(a,b){var c=a.x,d=a.y,e=a.x+a.width,f=a.y+a.height,g=b.x,h=b.y,i=b.x+b.width,j=b.y+b.height;return i>=c&&e>=g&&j>=d&&f>=h}function e(a,b){var d,e=new k.Vec2(a.x,a.y),f=new k.Vec2(a.x,a.yMax),g=new k.Vec2(a.xMax,a.yMax),h=new k.Vec2(a.xMax,a.y);if(c(e,f,b))return!0;if(c(f,g,b))return!0;if(c(g,h,b))return!0;if(c(h,e,b))return!0;for(d=0;d<b.points.length;++d)if(a.contains(b.points[d]))return!0;return b.contains(e)?!0:b.contains(f)?!0:b.contains(g)?!0:b.contains(h)?!0:!1}function f(a,b){var d;for(d=0;d<length;++d){var e=a.points[d],f=a.points[(d+1)%length];if(c(e,f,b))return!0}for(d=0;d<b.points.length;++d)if(a.contains(b.points[d]))return!0;for(d=0;d<a.points.length;++d)if(b.contains(a.points[d]))return!0;return!1}var g={};return g.lineLine=a,g.lineRect=b,g.linePolygon=c,g.rectRect=d,g.rectPolygon=e,g.polygonPolygon=f,g}(),function(){var a=function(){this._callbackTable={}};k._CallbacksHandler=a,a.prototype.add=function(a,b){var c=this._callbackTable[a];return"undefined"!=typeof c?(b&&(null!==c?c.push(b):(c=[b],this._callbackTable[a]=c)),!1):(c=b?[b]:null,this._callbackTable[a]=c,!0)},a.prototype.has=function(a,b){var c=this._callbackTable[a];return c&&c.length>0?b?-1!==c.indexOf(b):!0:!1},a.prototype.removeAll=function(a){delete this._callbackTable[a]},a.prototype.remove=function(a,b){var c=this._callbackTable[a];if(c){var d=c.indexOf(b);if(-1!==d)return c.splice(d,1),!0}return!1};var b=function(){this._callbackTable={}};return t.extend(b,a),k.CallbacksInvoker=b,b.prototype.invoke=function(a,b,c,d,e,f){var g=this._callbackTable[a];if(g)for(var h=0;h<g.length;h++)g[h](b,c,d,e,f)},b.prototype.invokeAndRemove=function(a,b,c,d,e,f){var g=this._callbackTable[a];if(g)for(var h=0;h<g.length;h++)g[h](b,c,d,e,f);this.removeAll(a)},b.prototype.bindKey=function(a,b){var c=this;return function d(e,f,g,h,i){var j=c._callbackTable[a];if(j)for(var k=0;k<j.length;k++)j[k](e,f,g,h,i);b&&c.removeAll(a)}},b}(),k.padLeft=function(a,b,c){return a=a.toString(),b-=a.length,b>0?new Array(b+1).join(c)+a:a},k.getEnumList=function(a){if(void 0!==a.__enums__)return a.__enums__;var b=[];for(var c in a)if(a.hasOwnProperty(c)){var d=parseInt(c);isNaN(d)&&b.push({name:a[a[c]],value:a[c]})}return b.sort(function(a,b){return a.value-b.value}),a.__enums__=b,a.__enums__},k.getVarFrom=function(a,b){for(var c=b.split("."),d=a,e=0;e<c.length;++e){var f=c[e];if(d=d[f],void 0===d||null===d)return null}return d},k.rgb2hsv=function(a,b,c){var d={h:0,s:0,v:0},e=Math.max(a,b,c),f=Math.min(a,b,c),g=0;return d.v=e,d.s=e?(e-f)/e:0,d.s?(g=e-f,d.h=a===e?(b-c)/g:b===e?2+(c-a)/g:4+(a-b)/g,d.h/=6,d.h<0&&(d.h+=1)):d.h=0,d},k.hsv2rgb=function(a,b,c){var d={r:0,g:0,b:0};if(0===b)d.r=d.g=d.b=c;else if(0===c)d.r=d.g=d.b=0;else{1===a&&(a=0),a*=6,b=b,c=c;var e=Math.floor(a),f=a-e,g=c*(1-b),h=c*(1-b*f),i=c*(1-b*(1-f));switch(e){case 0:d.r=c,d.g=i,d.b=g;break;case 1:d.r=h,d.g=c,d.b=g;break;case 2:d.r=g,d.g=c,d.b=i;break;case 3:d.r=g,d.g=h,d.b=c;break;case 4:d.r=i,d.g=g,d.b=c;break;case 5:d.r=c,d.g=g,d.b=h}}return d};var u=function(a){if(!a||a.constructor!=={}.constructor)return!1;for(var b in a)return!1;return!0},v=function(a){return a&&"function"==typeof a.clone&&(a.constructor.prototype.hasOwnProperty("clone")||a.hasOwnProperty("clone"))};k.attr=function(a,b,c){var d="_attr$"+b,e,f,g;if("function"==typeof a){if(e=a.prototype,f=e[d],"undefined"!=typeof c){if("object"!=typeof c)return e[d]=c,c;f||(e[d]=f={});for(g in c)"_"!==g[0]&&(f[g]=c[g])}return f}if(e=a,"undefined"!=typeof c){if("object"==typeof c){e.hasOwnProperty(d)&&(f=e[d]),f||(e[d]=f={});for(g in c)"_"!==g[0]&&(f[g]=c[g]);return t.addon({},f,e.constructor.prototype[d])}return e[d]=c,c}return f=e[d],"object"==typeof f?t.addon({},f,e.constructor.prototype[d]):f},k.NonSerialized={serializable:!1,_canUsedInGetter:!1},k.EditorOnly={editorOnly:!0,_canUsedInGetter:!1},k.Integer={type:"int"},k.Float={type:"float"},k.SingleText={textMode:"single"},k.MultiText={textMode:"multi"},k.Boolean={type:"boolean",_onAfterProp:d("boolean","Fire.Boolean")},k.String={type:"string",_onAfterProp:d("string","Fire.String")},k.ObjectType=function(a){return a?"function"!=typeof a?void k.warn("Argument for Fire.ObjectType must be function type"):{type:"object",ctor:a,_onAfterProp:function(b,c){var e=d("object","Fire.ObjectType",a);e(b,c);var f=k.attr(b,c)||{},g=null===f["default"]||void 0===f["default"];g&&"function"==typeof a.prototype.clone&&k.warn('Please set the default value of %s.%s to a valid instance such as "new %s()", because its ObjectType is value type.',t.getClassName(b),c,t.getClassName(a))}}:void k.warn("Argument for Fire.ObjectType must be non-nil")},k.Enum=function(a){return{type:"enum",enumList:k.getEnumList(a)}},k.EnumList=function(a){return{type:"enum",enumList:a}},k.RawType=function(a){var b=["image","json","text","audio"];return{type:"raw",rawType:a,serializable:!1,hideInInspector:!0,_canUsedInGetter:!1,_onAfterProp:function(a,c){var d=function g(a){if(!k.isChildClassOf(a,E))return k.error("RawType is only available for Assets"),!1;for(var b=!1,c=0;c<a.__props__.length;c++){var d=a.__props__[c],e=k.attr(a,d),f=e.type;if("raw"===f){var g=e.rawType.toLowerCase()!==e.rawType;if(g)return k.error("RawType name cannot contain uppercase"),!1;if(b)return k.error("Each asset cannot have more than one RawType"),!1;b=!0}}return!0}(a);if(d){var e=k.attr(a,c)||{},f=-1!==b.indexOf(e.rawType);f&&a.prop("_rawext","",k.HideInInspector)}}}},k.Custom=function(a){return{custom:a}},k.HideInInspector={hideInInspector:!0},k.DisplayName=function(a){return{displayName:a}},k.ReadOnly={readOnly:!0},k.Tooltip=function(a){return{tooltip:a}},k.Nullable=function(a,b){return{nullable:a,_onAfterProp:function(c,d){c.prop(a,b,k.HideInInspector);var e=k.attr(c,d)||{};e.serializable===!1?k.attr(c,a,k.NonSerialized):e.editorOnly&&k.attr(c,a,k.EditorOnly)}}},k.Watch=function(a,b){return{watch:[].concat(a),watchCallback:b}},k.Range=function(a,b){return{min:a,max:b}};var w=function(a){var b=/^[a-zA-Z_$][a-zA-Z0-9_$]*$/;if(!b.test(a))return void k.error('The property name "'+a+'" is not compliant with JavaScript naming standards');if(this.__props__){var c=this.__props__.indexOf(a);0>c&&this.__props__.push(a)}else this.__props__=[a]},x={__props__:null,prop:function(a,b,c){"use strict";if("object"==typeof b&&b)if(Array.isArray(b)){if(b.length>0)return k.error("Default array must be empty, set default value of "+t.getClassName(this)+'.prop("'+a+'", ...) to null or [], and initialize in constructor please. (just like "this.'+a+' = [...];")'),this}else if(!u(b)&&!v(b))return k.error('Do not set default value to non-empty object, unless the object defines its own "clone" function. Set default value of '+t.getClassName(this)+'.prop("'+a+'", ...) to null or {}, and initialize in constructor please. (just like "this.'+a+' = {foo: bar};")'),this;for(var d=this.$super;d;d=d.$super)if(d.prototype.hasOwnProperty(a))return void k.error("Can not declare "+t.getClassName(this)+"."+a+", it is already defined in the prototype of "+t.getClassName(d));if(k.attr(this,a,{"default":b}),w.call(this,a),c){for(var e=null,f=2,g=f;g<arguments.length;g++){var h=arguments[g];k.attr(this,a,h),h._onAfterProp&&(e=e||[],e.push(h._onAfterProp))}if(e)for(var i=0;i<e.length;i++)e[i](this,a)}return this},get:function(a,b,c){"use strict";var d=Object.getOwnPropertyDescriptor(this.prototype,a);if(d&&d.get)return k.error(t.getClassName(this)+': the getter of "'+a+'" is already defined!'),this;var e=!0;if(c)for(var f=2,g=f;g<arguments.length;g++){var h=arguments[g];if(h._canUsedInGetter!==!1){if(k.attr(this,a,h),h.hideInInspector&&(e=!1),(h.serializable===!1||h.editorOnly===!0)&&k.warn("No need to use Fire.NonSerialized or Fire.EditorOnly for the getter of "+t.getClassName(this)+"."+a+", every getter is actually non-serialized."),h.hasOwnProperty("default"))return k.error(t.getClassName(this)+": Can not set default value of a getter!"),this}else k.error('Can not apply the specified attribute to the getter of "'+t.getClassName(this)+"."+a+'", attribute index: '+(g-f))}if(k.attr(this,a,k.NonSerialized),e)w.call(this,a);else{var i=this.__props__.indexOf(a);if(i>=0)return k.error(t.getClassName(this)+"."+a+" is already defined!"),this}return Object.defineProperty(this.prototype,a,{get:b,configurable:!0}),k.attr(this,a,{hasGetter:!0}),this},set:function(a,b){var c=Object.getOwnPropertyDescriptor(this.prototype,a);return c&&c.set?(k.error(t.getClassName(this)+': the setter of "'+a+'" is already defined!'),this):(Object.defineProperty(this.prototype,a,{set:function d(c){this._observing&&Object.getNotifier(this).notify({type:"update",name:a,oldValue:this[a]}),b.call(this,c)},configurable:!0}),k.attr(this,a,{hasSetter:!0}),k.attr(this,a,{originalSetter:b}),this)},getset:function(a,b,c,d){return this.get(a,b,d),this.set(a,c),this}},y=function(a,b){var c=b.__props__;if(c)for(var d=0;d<c.length;d++){var e=c[d],f=k.attr(b,e);if(f&&f.hasOwnProperty("default")){var g=f["default"];"object"==typeof g&&g&&(g=g.clone?g.clone():Array.isArray(g)?[]:{}),a[e]=g}}};k._isFireClass=function(a){return!!a&&a.prop===x.prop},k.isChildClassOf=function(a,b){if(a&&b){if("function"!=typeof a)return k.warn("[isChildClassOf] subclass should be function type, not",a),!1;if("function"!=typeof b)return k.warn("[isChildClassOf] superclass should be function type, not",b),!1;for(;a&&a.$super;a=a.$super)if(a===b)return!0;if(a===b)return!0;for(var c=Object.getPrototypeOf(a.prototype);c;){if(a=c.constructor,a===b)return!0;c=Object.getPrototypeOf(a.prototype)}}return!1},k._doDefine=function(a,b,c){var d=f(c,b);return e(a,d),b&&(t.extend(d,b),d.$super=b,b.__props__&&(d.__props__=b.__props__.slice())),t.setClassName(a,d),h(d,a),d},k.define=function(a,b){return k.extend(a,null,b)},k.extend=function(a,b,c){if("function"==typeof a){if(c)return k.error("[Fire.extend] invalid type of arguments"),null;c=b,b=a,a=""}return"string"==typeof a?k._doDefine(a,b,c):(k.error(a?"[Fire.extend] unknown typeof first argument":"[Fire.extend] first argument must be non-nil"),null)},k._fastDefine=function(a,b,c){t.setClassName(a,b),b.__props__=c;for(var d=0;d<c.length;d++)k.attr(b,c[d],k.HideInInspector)},k.Path=k.isNode?require("path"):function(){var a;if(k.isWin32){var b=/^([a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?([\\\/])?([\s\S]*?)$/,c=/^([\s\S]*?)((?:\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))(?:[\\\/]*)$/;a=function(a){var d=b.exec(a),e=(d[1]||"")+(d[2]||""),f=d[3]||"",g=c.exec(f),h=g[1],i=g[2],j=g[3];return[e,h,i,j]}}else{var d=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;a=function(a){return d.exec(a).slice(1)}}return path={basename:function(a){return a.replace(/^.*(\\|\/|\:)/,"")},extname:function(a){return a.substring((~-a.lastIndexOf(".")>>>0)+1)},dirname:function(b){var c=a(b),d=c[0],e=c[1];return d||e?(e&&(e=e.substr(0,e.length-1)),d+e):"."},sep:k.isWin32?"\\":"/"},path}(),k.Path.setExtname=function(a,b){var c=(~-a.lastIndexOf(".")>>>0)+1;return a.substring(0,c)+b},k.Path.setEndWithSep=function(a,b){b="undefined"!=typeof b?b:!0;var c=a[a.length-1],d="\\"===c||"/"===c;return!d&&b?a+=k.Path.sep:d&&!b&&(a=a.substring(0,a.length-1)),a},FObject=function(){function a(){this._name="",this._objFlags=0}k._fastDefine("Fire.FObject",a,["_name","_objFlags"]),k.isValid=function(a){return!(!a||a._objFlags&m)};var b=[];return Object.defineProperty(a,"_deferredDestroy",{value:function(){for(var a=b.length,c=0;a>c;++c){var d=b[c];d._objFlags&m||d._destroyImmediate()}a===b.length?b.length=0:b.splice(0,a)},enumerable:!1}),Object.defineProperty(a.prototype,"name",{get:function(){return this._name},set:function(a){this._name=a},enumerable:!1}),Object.defineProperty(a.prototype,"isValid",{get:function(){return!(this._objFlags&m)}}),a.prototype.destroy=function(){return this._objFlags&m?void k.error("object already destroyed"):this._objFlags&n?!1:(this._objFlags|=n,b.push(this),!0)},a.prototype._destruct=function(){for(var a in this)if(this.hasOwnProperty(a)){var b=typeof this[a];switch(b){case"string":this[a]="";break;case"object":this[a]=null;break;case"function":this[a]=null}}},a.prototype._onPreDestroy=null,a.prototype._destroyImmediate=function(){return this._objFlags&m?void k.error("object already destroyed"):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),void(this._objFlags|=m))},a}(),k.FObject=FObject;var z=function(){var a=k.extend("Fire.HashObject",k.FObject,function(){Object.defineProperty(this,"_hashCode",{value:0,writable:!0,enumerable:!1}),Object.defineProperty(this,"_id",{value:"",writable:!0,enumerable:!1})}),b=0;return Object.defineProperty(a.prototype,"hashCode",{get:function(){return this._hashCode||(this._hashCode=++b)}}),Object.defineProperty(a.prototype,"id",{get:function(){return this._id||(this._id=""+this.hashCode)}}),a}();k.HashObject=z,Vec2=function(){function a(a,b){this.x="number"==typeof a?a:0,this.y="number"==typeof b?b:0}return t.setClassName("Fire.Vec2",a),Object.defineProperty(a,"one",{get:function(){return new a(1,1)}}),Object.defineProperty(a,"zero",{get:function(){return new a(0,0)}}),a.prototype.clone=function(){return new a(this.x,this.y)},a.prototype.set=function(a){this.x=a.x,this.y=a.y},a.prototype.equals=function(a){return a&&a.constructor===k.Vec2?this.x===a.x&&this.y===a.y:!1},a.prototype.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},a.prototype.addSelf=function(a){return this.x+=a.x,this.y+=a.y,this},a.prototype.add=function(b,c){return c=c||new a,c.x=this.x+b.x,c.y=this.y+b.y,c},a.prototype.subSelf=function(a){return this.x-=a.x,this.y-=a.y,this},a.prototype.sub=function(b,c){return c=c||new a,c.x=this.x-b.x,c.y=this.y-b.y,c},a.prototype.mulSelf=function(a){return this.x*=a,this.y*=a,this},a.prototype.mul=function(b,c){return c=c||new a,c.x=this.x*b,c.y=this.y*b,c},a.prototype.scaleSelf=function(a){return this.x*=a.x,this.y*=a.y,this},a.prototype.scale=function(b,c){return c=c||new a,c.x=this.x*b.x,c.y=this.y*b.y,c},a.prototype.divSelf=function(a){return this.x/=a.x,this.y/=a.y,this},a.prototype.div=function(b,c){return c=c||new a,c.x=this.x/b.x,c.y=this.y/b.y,c},a.prototype.negSelf=function(){return this.x=-this.x,this.y=-this.y,this},a.prototype.neg=function(b){return b=b||new a,b.x=-this.x,b.y=-this.y,b},a.prototype.dot=function(a){return this.x*a.x+this.y*a.y},a.prototype.cross=function(a){return this.y*a.x-this.x*a.y},a.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.prototype.magSqr=function(){return this.x*this.x+this.y*this.y},a.prototype.normalizeSelf=function(){var a=this.x*this.x+this.y*this.y;if(1===a)return this;if(0===a)return console.warn("Can't normalize zero vector"),this;var b=1/Math.sqrt(a);return this.x*=b,this.y*=b,this},a.prototype.normalize=function(b){return b=b||new a,b.x=this.x,b.y=this.y,b.normalizeSelf(),b},a.prototype.angle=function(a){var b=this.magSqr(),c=a.magSqr();if(0===b||0===c)return console.warn("Can't get angle between zero vector"),0;var d=this.dot(a),e=d/Math.sqrt(b*c);return e=Math.clamp(e,-1,1),Math.acos(e)},a.prototype.signAngle=function(a){return Math.atan2(this.y,this.x)-Math.atan2(a.y,a.x)},a.prototype.rotate=function(b,c){return c=c||new a,c.x=this.x,c.y=this.y,c.rotateSelf(b)},a.prototype.rotateSelf=function(a){var b=Math.sin(a),c=Math.cos(a),d=this.x;return this.x=c*d-b*this.y,this.y=b*d+c*this.y,this},a}(),k.Vec2=Vec2,k.v2=function $(a,b){return Array.isArray(a)?new Vec2(a[0],a[1]):new Vec2(a,b)};var A=function(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0};t.setClassName("Fire.Matrix23",A),k.Matrix23=A,A.identity=new A,A.prototype.clone=function(){var a=new A;return a.a=this.a,a.b=this.b,a.c=this.c,a.d=this.d,a.tx=this.tx,a.ty=this.ty,a},A.prototype.set=function(a){this.a=a.a,this.b=a.b,this.c=a.c,this.d=a.d,this.tx=a.tx,this.ty=a.ty},A.prototype.equals=function(a){return this.a===a.a&&this.b===a.b&&this.c===a.c&&this.d===a.d&&this.tx===a.tx&&this.ty===a.ty},A.prototype.toString=function(){return"|"+this.a.toFixed(2)+" "+this.c.toFixed(2)+" "+this.tx.toFixed(2)+"|\n|"+this.b.toFixed(2)+" "+this.d.toFixed(2)+" "+this.ty.toFixed(2)+"|\n|0.00 0.00 1.00|"},A.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},A.prototype.prepend=function(a){var b=a.a,c=a.b,d=a.c,e=a.d;if(1!==b||0!==c||0!==d||1!==e){var f=this.a,g=this.c;this.a=f*b+this.b*d,this.b=f*c+this.b*e,this.c=g*b+this.d*d,this.d=g*c+this.d*e;var h=this.tx;this.tx=h*b+this.ty*d+a.tx,this.ty=h*c+this.ty*e+a.ty}else this.tx+=a.tx,this.ty+=a.ty;return this},A.prototype.invert=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=1/(a*d-b*c);return this.a=d*f,this.b=-b*f,this.c=-c*f,this.d=a*f,this.tx=(c*this.ty-d*e)*f,this.ty=(b*e-a*this.ty)*f,this},A.prototype.transformPoint=function(a,b){b=b||new Vec2;var c=a.x;return b.x=this.a*c+this.c*a.y+this.tx,b.y=this.b*c+this.d*a.y+this.ty,b},A.prototype.getScale=function(a){return a=a||new Vec2,a.x=Math.sqrt(this.a*this.a+this.b*this.b),a.y=Math.sqrt(this.c*this.c+this.d*this.d),a},A.prototype.setScale=function(a){var b=this.getScale(),c=a.x/b.x,d=a.y/b.y;return this.a*=c,this.b*=c,this.c*=d,this.d*=d,this},A.prototype.getRotation=function(){var a=this.b/this.a!==-this.c/this.d;return a?.5*(Math.atan2(this.b,this.a)+Math.atan2(-this.c,this.d)):Math.atan2(-this.c,this.d)},A.prototype.getTranslation=function(a){return a=a||new Vec2,a.x=this.tx,a.y=this.ty,a},A.prototype.rotate=function(a){var b=Math.sin(a),c=Math.cos(a),d=this.a,e=this.b;return this.a=d*c+this.c*b,this.b=e*c+this.d*b,this.c=this.c*c-d*b,this.d=this.d*c-e*b,this};var B=function(){function a(a,b,c,d){this.x="number"==typeof a?a:0,this.y="number"==typeof b?b:0,this.width="number"==typeof c?c:0,this.height="number"==typeof d?d:0}return t.setClassName("Fire.Rect",a),a.fromVec2=function(b,c){var d=Math.min(b.x,c.x),e=Math.min(b.y,c.y),f=Math.max(b.x,c.x),g=Math.max(b.y,c.y);return new a(d,e,f-d,g-e)},a.contain=function b(a,c){return a.x<=c.x&&a.x+a.width>=c.x+c.width&&a.y<=c.y&&a.y+a.height>=c.y+c.height?1:c.x<=a.x&&c.x+c.width>=a.x+a.width&&c.y<=a.y&&c.y+c.height>=a.y+a.height?-1:0},a.prototype.clone=function(){return new a(this.x,this.y,this.width,this.height)},a.prototype.equals=function(a){return this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height},a.prototype.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},Object.defineProperty(a.prototype,"xMax",{get:function(){return this.x+this.width}}),Object.defineProperty(a.prototype,"yMax",{get:function(){return this.y+this.height}}),Object.defineProperty(a.prototype,"center",{get:function(){return new k.Vec2(this.x+.5*this.width,this.y+.5*this.height)}}),a.prototype.intersects=function(a){return k.Intersection.rectRect(this,a)},a.prototype.contains=function(a){return this.x<=a.x&&this.x+this.width>=a.x&&this.y<=a.y&&this.y+this.height>=a.y?!0:!1},a.prototype.containsRect=function(a){return this.x<=a.x&&this.x+this.width>=a.x+a.width&&this.y<=a.y&&this.y+this.height>=a.y+a.height?!0:!1},a}();k.Rect=B,k.rect=function _(a,b,c,d){return Array.isArray(a)?new B(a[0],a[1],a[2],a[3]):new B(a,b,c,d)},k.Polygon=function(){function a(a){this.points=a,this.points.length<3&&console.warn("Invalid polygon, the data must contains 3 or more points.")}return t.setClassName("Fire.Polygon",a),a.prototype.intersects=function(a){return Intersection.polygonPolygon(this,a)},a.prototype.contains=function(a){for(var b=!1,c=a.x,d=a.y,e=this.points.length,f=0,g=e-1;e>f;g=f++){var h=this.points[f].x,i=this.points[f].y,j=this.points[g].x,k=this.points[g].y,l=i>d!=k>d&&(j-h)*(d-i)/(k-i)+h>c;l&&(b=!b)}return b},Object.defineProperty(a.prototype,"center",{get:function(){if(this.points.length<3)return null;for(var a=this.points[0].x,b=this.points[0].y,c=this.points[0].x,d=this.points[0].y,e=1;e<this.points.length;++e){var f=this.points[e].x,g=this.points[e].y;a>f?a=f:f>c&&(c=f),b>g?b=g:g>d&&(d=g)}return new k.Vec2(.5*(c+a),.5*(d+b))}}),a}();var C=function(){function a(a,b,c,d){this.r="number"==typeof a?a:0,this.g="number"==typeof b?b:0,this.b="number"==typeof c?c:0,this.a="number"==typeof d?d:1}var b={white:[1,1,1,1],black:[0,0,0,1],transparent:[0,0,0,0],gray:[.5,.5,.5],red:[1,0,0],green:[0,1,0],blue:[0,0,1],yellow:[1,235/255,4/255],cyan:[0,1,1],magenta:[1,0,1]};t.setClassName("Fire.Color",a);for(var c in b){var d=function(b,c,d,e){return function(){return new a(b,c,d,e)}}.apply(null,b[c]);Object.defineProperty(a,c,{get:d})}return a.prototype.clone=function(){return new a(this.r,this.g,this.b,this.a)},a.prototype.equals=function(a){return this.r===a.r&&this.g===a.g&&this.b===a.b&&this.a===a.a},a.prototype.toString=function(){return"rgba("+this.r.toFixed(2)+", "+this.g.toFixed(2)+", "+this.b.toFixed(2)+", "+this.a.toFixed(2)+")"},a.prototype.toCSS=function(a){return"rgba"===a?"rgba("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+","+this.a.toFixed(2)+")":"rgb"===a?"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")":"#"+this.toHEX(a)},a.prototype.equalTo=function(b){return b instanceof a&&this.r===b.r&&this.g===b.g&&this.b===b.b&&this.a===b.a},a.prototype.clamp=function(){this.r=Math.clamp(this.r),this.g=Math.clamp(this.g),this.b=Math.clamp(this.b),this.a=Math.clamp(this.a)},a.prototype.fromHEX=function(a){var b=parseInt(a.indexOf("#")>-1?a.substring(1):a,16);return this.r=b>>16,this.g=(65280&b)>>8,this.b=255&b,this},a.prototype.toHEX=function(a){var b=[(255*this.r|0).toString(16),(255*this.g|0).toString(16),(255*this.b|0).toString(16)],c=-1;if("#rgb"===a)for(c=0;c<b.length;++c)b[c].length>1&&(b[c]=b[c][0]);else if("#rrggbb"===a)for(c=0;c<b.length;++c)1===b[c].length&&(b[c]="0"+b[c]);return b.join("")},a.prototype.toRGBValue=function(){return(255*this.r<<16)+(255*this.g<<8)+255*this.b},a.prototype.fromHSV=function(a,b,c){var d=k.hsv2rgb(a,b,c);return this.r=d.r,this.g=d.g,this.b=d.b,this},a.prototype.toHSV=function(){return k.rgb2hsv(this.r,this.g,this.b)},a}();k.Color=C,k.color=function ab(a,b,c,d){return Array.isArray(a)?new C(a[0],a[1],a[2],a[3]):new C(a,b,c,d)};var D=function(){function a(a,b,c,d,e){if(this._editor=d,this._classFinder=e,this._target=c,this._idList=[],this._idObjList=[],this._idPropList=[],this.result=b||new k._DeserializeInfo,Array.isArray(a)){var h=a,i=h.length;this.deserializedList=new Array(i);for(var j=0;i>j;j++)if(h[j]){var l;l=0===j&&c,this.deserializedList[j]=g(this,h[j],l)}this.deserializedData=i>0?this.deserializedList[0]:[]}else this.deserializedList=[null],this.deserializedData=a?g(this,a,c):null,this.deserializedList[0]=this.deserializedData;f(this)}function b(a,b,c,d,e){var f=c.__id__;if("undefined"==typeof f){var h=c.__uuid__;h?(a.result.uuidList.push(h),a.result.uuidObjList.push(b),a.result.uuidPropList.push(d)):b[d]=g(a,c,e&&e[d])}else{var i=a.deserializedList[f];i?b[d]=i:(a._idList.push(f),a._idObjList.push(b),a._idPropList.push(d))}}function c(a,c,d){for(var e in d)if(d.hasOwnProperty(e)){var f=d[e];"object"!=typeof f?"__type__"!==e&&(c[e]=f):f?f.__uuid__||"undefined"!=typeof f.__id__?b(a,c,f,e,a._target&&c):c[e]=g(a,f,a._target&&c[e]):c[e]=null}}function d(a,c,d){for(var e in c){var f=d[e];"undefined"!=typeof f&&d.hasOwnProperty(e)&&("object"!=typeof f?c[e]=f:f?f.__uuid__||"undefined"!=typeof f.__id__?b(a,c,f,e,a._target&&c):c[e]=g(a,f,a._target&&c[e]):c[e]=null)}}function e(a,d,e,f,h){var i=f.__props__;if(i){for(var j=0;j<i.length;j++){var l=i[j],m=k.attr(f,l),n=m.rawType;if(n)a.result.rawProp&&k.error("not support multi raw object in a file"),a.result.rawProp=l;else{if(m.serializable===!1)continue;if(!a._editor&&m.editorOnly)continue;var o=e[l];"undefined"!=typeof o&&("object"!=typeof o?d[l]=o:o?o.__uuid__||"undefined"!=typeof o.__id__?b(a,d,o,l,h&&d):d[l]=g(a,o,h&&h[l]):d[l]=null)}}"_$erialized"===i[i.length-1]&&(d._$erialized=e,c(a,d._$erialized,e))}}var f=function(a){for(var b=a.deserializedList,c=0,d=a._idList.length;d>c;c++){var e=a._idPropList[c],f=a._idList[c];a._idObjList[c][e]=b[f]}},g=function(a,f,h){var i,j,l=null,m=null;if(f.__type__){if(m=a._classFinder(f.__type__),!m)return k.error("[Fire.deserialize] unknown type: "+f.__type__),null;h?(h instanceof m||k.warn("Type of target to deserialize not matched with data: target is %s, data is %s",t.getClassName(h),m),l=h):l=new m,k._isFireClass(m)?e(a,l,f,m,h):d(a,l,f)
}else if(Array.isArray(f)){h?(h.length=f.length,l=h):l=new Array(f.length);for(var n=0;n<f.length;n++)j=f[n],"object"==typeof j&&j?j.__uuid__||"undefined"!=typeof j.__id__?b(a,l,j,""+n,h&&h[n]):l[n]=g(a,j,h&&h[n]):l[n]=j}else l=h||{},c(a,l,f);return l};return a}();k.deserialize=function(a,b,c){var d=c&&"isEditor"in c?c.isEditor:k.isEditor,e=c&&c.classFinder||t._getClassById,f=c&&c.createAssetRefs||k.isEditorCore,g;g=c&&c.target,k.isNode&&Buffer.isBuffer(a)&&(a=a.toString()),"string"==typeof a&&(a=JSON.parse(a)),f&&!b&&(b=new k._DeserializeInfo),k._isCloning=!0;var h=new D(a,b,g,d,e);return k._isCloning=!1,f&&b.assignAssetsBy(k.serialize.asAsset),h.deserializedData},k._DeserializeInfo=function(){this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.rawProp=""},k._DeserializeInfo.prototype.reset=function(){this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.rawProp=""},k._DeserializeInfo.prototype.getUuidOf=function(a,b){for(var c=0;c<this.uuidObjList.length;c++)if(this.uuidObjList[c]===a&&this.uuidPropList[c]===b)return this.uuidList[c];return""},k._DeserializeInfo.prototype.assignAssetsBy=function(a){for(var b=0,c=this.uuidList.length;c>b;b++){var d=this.uuidList[b],e=a(d);if(e){var f=this.uuidObjList[b],g=this.uuidPropList[b];f[g]=e}else k.error("Failed to assign asset: "+d)}},k.instantiate=function(a){if("object"!=typeof a||Array.isArray(a))return k.error("The thing you want to instantiate must be an object"),null;if(!a)return k.error("The thing you want to instantiate is nil"),null;if(a instanceof k.FObject&&!a.isValid)return k.error("The thing you want to instantiate is destroyed"),null;var b;return a._instantiate?(k._isCloning=!0,b=a._instantiate(),k._isCloning=!1,b):a instanceof k.Asset?(k.error("The instantiate method for given asset do not implemented"),null):(k._isCloning=!0,b=k._doInstantiate(a),k._isCloning=!1,b)},k._doInstantiate=function(){function a(a){if(Array.isArray(a))return k.error("Can not instantiate array"),null;if(c(a))return k.error("Can not instantiate DOM element"),null;for(var b=e(a),f=0,g=d.length;g>f;++f)d[f]._iN$t=null;return d.length=0,b}function b(a){var f=a._iN$t;if(f)return f;if(a instanceof E)return a;if(Array.isArray(a)){var g=a.length;f=new Array(g),a._iN$t=f;for(var h=0;g>h;++h){var i=a[h],j=typeof i;f[h]="object"===j?i?b(i):i:"function"!==j?i:null}return d.push(a),f}return c(a)?null:e(a)}var d=[],e=function(a){var c,e,f=a.constructor,g=new f;if(a._iN$t=g,d.push(a),k._isFireClass(f)){var h=f.__props__;if(h)for(var i=0;i<h.length;i++){var j=h[i],l=k.attr(f,j);l.serializable!==!1&&(c=a[j],e=typeof c,g[j]="object"===e?c?b(c):c:"function"!==e?c:null)}}else for(var m in a)a.hasOwnProperty(m)===!1||95===m.charCodeAt(0)&&95===m.charCodeAt(1)||(c=a[m],c!==g&&(e=typeof c,g[m]="object"===e?c?b(c):c:"function"!==e?c:null));return a instanceof FObject&&(g._objFlags&=s),g};return a}(),k._isCloning=!1;var E=function(){var a=k.extend("Fire.Asset",k.HashObject,function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0,enumerable:!1})});return a.prototype._setRawExtname=function(a){this.hasOwnProperty("_rawext")?("."===a.charAt(0)&&(a=a.substring(1)),this._rawext=a):k.error("Have not defined any RawTypes yet, no need to set raw file's extname.")},a}();k.Asset=E;var F=function(){var a=k.extend("Fire.CustomAsset",k.Asset);return a}();k.CustomAsset=F,k.addCustomAssetMenu=k.addCustomAssetMenu||function(a,b,c){},k.Texture=function(){var a=k.extend("Fire.Texture",k.Asset,function(){var a=arguments[0];a&&(this.image=a,this.width=a.width,this.height=a.height)});return a.WrapMode=function(a){return a[a.Repeat=0]="Repeat",a[a.Clamp=1]="Clamp",a}({}),a.FilterMode=function(a){return a[a.Point=0]="Point",a[a.Bilinear=1]="Bilinear",a[a.Trilinear=2]="Trilinear",a}({}),a.prop("image",null,k.RawType("image")),a.prop("width",0,k.Integer),a.prop("height",0,k.Integer),a.prop("wrapMode",a.WrapMode.Clamp,k.Enum(a.WrapMode)),a.prop("filterMode",a.FilterMode.Bilinear,k.Enum(a.FilterMode)),a}(),k.Sprite=function(){var a=k.extend("Fire.Sprite",k.Asset,function(){var a=arguments[0];a&&(this.texture=new k.Texture(a),this.width=a.width,this.height=a.height)});return a.prop("pivot",new k.Vec2(.5,.5),k.Tooltip("The pivot is normalized, like a percentage.\n(0,0) means the bottom-left corner and (1,1) means the top-right corner.\nBut you can use values higher than (1,1) and lower than (0,0) too.")),a.prop("trimX",0,k.Integer),a.prop("trimY",0,k.Integer),a.prop("width",0,k.Integer),a.prop("height",0,k.Integer),a.prop("texture",null,k.ObjectType(k.Texture),k.HideInInspector),a.prop("rotated",!1,k.HideInInspector),a.prop("x",0,k.Integer,k.HideInInspector),a.prop("y",0,k.Integer,k.HideInInspector),a.prop("rawWidth",0,k.Integer,k.HideInInspector),a.prop("rawHeight",0,k.Integer,k.HideInInspector),Object.defineProperty(a.prototype,"rotatedWidth",{get:function(){return this.rotated?this.height:this.width}}),Object.defineProperty(a.prototype,"rotatedHeight",{get:function(){return this.rotated?this.width:this.height}}),a}(),k.Atlas=function(){var a=k.extend("Fire.Atlas",k.Asset);return a.Algorithm=function(a){return a[a.Basic=0]="Basic",a[a.Tree=1]="Tree",a[a.MaxRect=2]="MaxRect",a}({}),a.SortBy=function(a){return a[a.UseBest=0]="UseBest",a[a.Width=1]="Width",a[a.Height=2]="Height",a[a.Area=3]="Area",a[a.Name=4]="Name",a}({}),a.SortOrder=function(a){return a[a.UseBest=0]="UseBest",a[a.Ascending=1]="Ascending",a[a.Descending=2]="Descending",a}({}),a.prop("width",512,k.Integer),a.prop("height",512,k.Integer),a.prop("sprites",[],k.ObjectType(k.Sprite),k.HideInInspector),a.prototype.add=function(a){for(var b=0;b<this.sprites.length;++b){var c=this.sprites[b];if(c._uuid===a._uuid)return!1}return this.sprites.push(a),!0},a.prototype.remove=function(a){for(var b=0;b<this.sprites.length;++b){var c=this.sprites[b];if(c._uuid===a._uuid)return this.sprites.splice(b,1),!0}return!1},a.prototype.clear=function(){this.sprites=[]},a.prototype.layout=function(a){void 0===a.algorithm&&(a.algorithm=k.Atlas.Algorithm.MaxRect),void 0===a.sortBy&&(a.sortBy=k.Atlas.SortBy.UseBest),void 0===a.sortOrder&&(a.sortOrder=k.Atlas.SortOrder.UseBest),void 0===a.allowRotate&&(a.allowRotate=!0),void 0===a.autoSize&&(a.autoSize=!0),void 0===a.padding&&(a.padding=2),k.AtlasUtils.sort(this,a.algorithm,a.sortBy,a.sortOrder,a.allowRotate),k.AtlasUtils.layout(this,a.algorithm,a.autoSize,a.padding,a.allowRotate)},a}();var G={},H=function(a,b){for(var c=0,d=0,e=0,f=0;f<a.sprites.length;++f){var g=a.sprites[f];if(c+g.rotatedWidth>a.width&&(c=0,d=d+e+b,e=0),d+g.rotatedHeight>a.height)throw new Error("Warning: Failed to layout element "+g.name);g.x=c,g.y=d,c=c+g.rotatedWidth+b,g.rotatedHeight>e&&(e=g.rotatedHeight)}},I=function(a,b,c,d){if(null!==a.right){var e=I(a.right,b,c,d);return null!==e?e:I(a.bottom,b,c,d)}var f=b.rotatedWidth,g=b.rotatedHeight,h=f+c,i=g+c,j=a.rect;if(f>j.width||g>j.height){if(d===!1)return null;if(g>j.width||f>j.height)return null;b.rotated=!b.rotated,f=b.rotatedWidth,g=b.rotatedHeight,h=f+c,i=g+c}return a.right={rect:new k.Rect(j.x+h,j.y,j.width-h,g),right:null,bottom:null},a.bottom={rect:new k.Rect(j.x,j.y+i,j.width,j.height-i),right:null,bottom:null},[j.x,j.y]},J=function(a,b,c){for(var d={rect:new k.Rect(0,0,a.width,a.height),right:null,bottom:null},e=0;e<a.sprites.length;++e){var f=a.sprites[e],g=I(d,f,b,c);if(null===g)throw new Error("Warning: Failed to layout element "+f.name);f.x=g[0],f.y=g[1]}},K=function(a,b,c){if(c.x>=b.x+b.width||c.x+c.width<=b.x||c.y>=b.y+b.height||c.y+c.height<=b.y)return!1;var d;return c.x<b.x+b.width&&c.x+c.width>b.x&&(c.y>b.y&&c.y<b.y+b.height&&(d=b.clone(),d.height=c.y-d.y,a.push(d)),c.y+c.height<b.y+b.height&&(d=b.clone(),d.y=c.y+c.height,d.height=b.y+b.height-(c.y+c.height),a.push(d))),c.y<b.y+b.height&&c.y+c.height>b.y&&(c.x>b.x&&c.x<b.x+b.width&&(d=b.clone(),d.width=c.x-d.x,a.push(d)),c.x+c.width<b.x+b.width&&(d=b.clone(),d.x=c.x+c.width,d.width=b.x+b.width-(c.x+c.width),a.push(d))),!0},L=function(a,b){var c;for(c=0;c<a.length;++c)K(a,a[c],b)&&(a.splice(c,1),--c);for(c=0;c<a.length;++c)for(var d=c+1;d<a.length;++d){if(a[d].containsRect(a[c])){a.splice(c,1),--c;break}a[c].containsRect(a[d])&&(a.splice(d,1),--d)}},M=function(a,b,c){var d=[];d.push(new k.Rect(0,0,a.width+b,a.height+b));for(var e,f,g=function(a,b,c,d){e=Number.MAX_VALUE,score2=Number.MAX_VALUE;for(var f=new k.Rect(0,0,1,1),g=!1,h=0;h<a.length;++h){var i=a[h],j,l,m,n;i.width>=b&&i.height>=c&&(j=Math.abs(Math.floor(i.width)-b),l=Math.abs(Math.floor(i.height)-c),m=Math.min(j,l),n=Math.max(j,l),(e>m||m===e&&n<score2)&&(f.x=i.x,f.y=i.y,f.width=b,f.height=c,e=m,score2=n,g=!0)),d&&i.width>=c&&i.height>=b&&(j=Math.abs(Math.floor(i.width)-c),l=Math.abs(Math.floor(i.height)-b),m=Math.min(j,l),n=Math.max(j,l),(e>m||m===e&&n<score2)&&(f.x=i.x,f.y=i.y,f.width=c,f.height=b,e=m,score2=n,g=!0))}return g===!1&&(e=Number.MAX_VALUE,score2=Number.MAX_VALUE),f},h=a.sprites.slice();h.length>0;){for(var i=Number.MAX_VALUE,j=Number.MAX_VALUE,l=-1,m=new k.Rect(0,0,1,1),n=0;n<h.length;++n){var o=g(d,h[n].width+b,h[n].height+b,c);(i>e||e===i&&score2<j)&&(i=e,j=score2,m=o,l=n)}if(-1===l)throw new Error("Error: Failed to layout atlas element");L(d,m);var p=h[l];p.x=Math.floor(m.x),p.y=Math.floor(m.y),p.rotated=p.width+b!==m.width,h.splice(l,1)}};G.layout=function(a,b,c,d,e){try{switch(b){case k.Atlas.Algorithm.Basic:H(a,d);break;case k.Atlas.Algorithm.Tree:J(a,d,e);break;case k.Atlas.Algorithm.MaxRect:M(a,d,e)}}catch(f){if(c===!1)return void k.error(f.message);if(4096===a.width&&4096===a.height)return void k.error(f.message);a.width===a.height?a.width*=2:a.height=a.width,G.layout(a,b,c,d,e)}};var N=function(a,b){var c=a.width-b.width;return 0===c&&(c=a.name.localeCompare(b.name)),c},O=function(a,b){var c=a.height-b.height;return 0===c&&(c=a.name.localeCompare(b.name)),c},P=function(a,b){var c=a.width*a.height-b.width*b.height;return 0===c&&(c=a.name.localeCompare(b.name)),c},Q=function(a,b){return a.name.localeCompare(b.name)},R=function(a,b){var c=a.width;a.height>a.width&&(c=a.height,a.rotated=!0);var d=b.width;b.height>b.width&&(d=b.height,b.rotated=!0);var e=c-d;return 0===e&&(e=a.name.localeCompare(b.name)),e},S=function(a,b){var c=a.height;a.width>a.height&&(c=a.width,a.rotated=!0);var d=b.height;b.width>b.height&&(d=b.width,b.rotated=!0);var e=c-d;return 0===e&&(e=a.name.localeCompare(b.name)),e};G.sort=function(a,b,c,d,e){for(var f=0;f<a.sprites.length;++f){var g=a.sprites[f];g.rotated=!1}var h=c,i=d;if(h===k.Atlas.SortBy.UseBest)switch(b){case k.Atlas.Algorithm.Basic:h=k.Atlas.SortBy.Height;break;case k.Atlas.Algorithm.Tree:h=k.Atlas.SortBy.Area;break;case k.Atlas.Algorithm.MaxRect:h=k.Atlas.SortBy.Area;break;default:h=k.Atlas.SortBy.Height}switch(i===k.Atlas.SortOrder.UseBest&&(i=k.Atlas.SortOrder.Descending),h){case k.Atlas.SortBy.Width:a.sprites.sort(e?R:N);break;case k.Atlas.SortBy.Height:a.sprites.sort(e?S:O);break;case k.Atlas.SortBy.Area:a.sprites.sort(P);break;case k.Atlas.SortBy.Name:a.sprites.sort(Q)}i===k.Atlas.SortOrder.Descending&&a.sprites.reverse()},k.AtlasUtils=G;var T=function(){var a=k.extend("Fire.JsonAsset",E).prop("json",null,k.RawType("json"));return a}();k.JsonAsset=T,k.TextAsset=function(){var a=k.extend("Fire.TextAsset",k.Asset);return a.prop("text","",k.RawType("text")),a}();var U=function(){var a=k.extend("Fire.BitmapFont",k.Asset);return a.prop("texture",null,k.ObjectType(k.Texture)),a.prop("charInfos",[]),a.prop("kernings",[]),a.prop("baseLine",0,k.Integer),a.prop("lineHeight",0,k.Integer),a.prop("size",0,k.Integer),a.prop("face",null,k.HideInInspector),a}();k.BitmapFont=U;var V=function(){function a(a,b){this._exporting=b,this.serializedList=[],this._parsingObjs=[],this._parsingData=[],this._objsToResetId=[],h(this,a);for(var c=0;c<this._objsToResetId.length;++c)this._objsToResetId[c].__id__=void 0;this._parsingObjs=null,this._parsingData=null,this._objsToResetId=null}var b=function(a,b){var c=a._parsingObjs.indexOf(b),d=-1!==c;if(d){var e=a.serializedList.length;b.__id__=e,a._objsToResetId.push(b);var f=a._parsingData[c];if(Array.isArray(b)===!1){var g=i(b);g&&(f.__type__=g)}return a.serializedList.push(f),f}},d=function(a,b,c){if(Array.isArray(b))for(var f=0;f<b.length;++f){var g=e(a,b[f]);"undefined"!=typeof g&&c.push(g)}else{var h=b.constructor;if(k._isFireClass(h)){var i=h.__props__;if(i)if("_$erialized"!==i[i.length-1])for(var j=0;j<i.length;j++){var l=i[j],m=k.attr(h,l);m.serializable!==!1&&(a._exporting&&m.editorOnly||(c[l]=e(a,b[l])))}else c.__type__=b._$erialized.__type__,d(a,b._$erialized,c)}else for(var n in b)!b.hasOwnProperty(n)||95===n.charCodeAt(0)&&95===n.charCodeAt(1)||(c[n]=e(a,b[n]))}},e=function(a,b){var c=typeof b;if("object"===c){if(b instanceof FObject){var d=b._objFlags;if(d&o)return void 0;if(a._exporting&&d&p)return void 0}return g(a,b)}return"function"!==c?b:null},f=function(a,b){var c;if(Array.isArray(b))c=[];else{c={};var e=i(b);e&&(c.__type__=e)}var f=a.serializedList.length;if(a._parsingObjs.push(b),a._parsingData.push(c),d(a,b,c),a._parsingObjs.pop(),a._parsingData.pop(),a.serializedList.length>f){var g=a.serializedList.indexOf(c,f);if(-1!==g)return{__id__:g}}return c},g=function(a,e){if(!e)return null;var g=e.__id__;if("undefined"!=typeof g)return{__id__:g};if(e instanceof FObject){if(!e.isValid)return null;var h=e._uuid;if(h)return{__uuid__:h};g=a.serializedList.length,e.__id__=g,a._objsToResetId.push(e);var j={};a.serializedList.push(j);var k=i(e);return k&&(j.__type__=k),d(a,e,j),j._objFlags&=s,{__id__:g}}if(c(e))return null;var l=b(a,e);return l?(g=e.__id__,{__id__:g}):f(a,e)},h=function(a,b){if(b instanceof FObject){var e=b._uuid;"undefined"!=typeof e&&(b._uuid=null),g(a,b),"undefined"!=typeof e&&(b._uuid=e)}else if("object"==typeof b&&b){if(c(b))return k.warn(""+b+" won't be serialized"),void a.serializedList.push(null);var f;if(Array.isArray(b))f=[];else{f={};var h=i(b);h&&(f.__type__=h)}b.__id__=0,a._objsToResetId.push(b),a.serializedList.push(f),d(a,b,f)}else a.serializedList.push(g(a,b))};return a}();k.serialize=function(a,b){var c=b&&b.exporting,d=b&&b.network,e=b&&"stringify"in b?b.stringify:!0,f=b&&b.nicify,g=new V(a,c,d),h=g.serializedList;f&&X(h);var i=1===h.length?h[0]:h;return e===!1?i:JSON.stringify(i,null,2)},k.serialize.asAsset=function(a){a||k.error("[Fire.serialize.asAsset] The uuid must be non-nil!");var b=new E;return b._uuid=a,b},k.serialize.setName=function(a,b){Array.isArray(a)?a[0]._name=b:a._name=b};var W=function(){this.objList=[],this.keyList=[],this.referncedIDList=[],this.referencedCounts=[],this.temporaryDataList=[]},X=function(a){var b=a[0];if("undefined"!=typeof b){var c=new W;c.referencedCounts=new Array(a.length);var d,e,f,g,h,i=a.slice();Y(b,a,c);var j=0;for(j=0;j<c.temporaryDataList.length;j++)delete c.temporaryDataList[j]._iN$t;for(j=0;j<c.objList.length;j++)if(e=c.objList[j],d=c.referncedIDList[j],f=c.keyList[j],g=i[d],h=c.referencedCounts[d]>1,!h){e[f]=g;var k=a.indexOf(g);a.splice(k,1)}for(j=0;j<c.objList.length;j++)if(d=c.referncedIDList[j],f=c.keyList[j],e=c.objList[j],h=c.referencedCounts[d]>1){g=i[d];var l=a.indexOf(g);e[f].__id__=l}}};k._nicifySerialized=X;var Y=function(a,b,c){if("object"==typeof a){var d;if(a._iN$t=!0,c.temporaryDataList.push(a),Array.isArray(a))for(var e=0;e<a.length;e++)d=a[e],d&&Z(d,e,a,b,c);else for(var f in a)d=a[f],d&&Z(d,f,a,b,c)}},Z=function(a,b,c,d,e){var f,g=a.__id__,h="undefined"!=typeof g;h&&(a=d[g],f=-1!==e.referncedIDList.indexOf(g),f?e.referencedCounts[g]++:e.referencedCounts[g]=1,e.referncedIDList.push(g),e.keyList.push(b),e.objList.push(c));var i=!a._iN$t;i?Y(a,d,e):h&&e.referencedCounts[g]++};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=k),exports.Fire=k):"undefined"!=typeof define&&define.amd?define(k):j.Fire=k}).call(this);