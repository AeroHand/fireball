<html><head><style>html /deep/ hierarchy-tree[focused] hierarchy-item[selected]::shadow #bar{background:#059}html /deep/ hierarchy-item>hierarchy-item{margin-left:12px}html /deep/ hierarchy-item::shadow fire-ui-text-input{position:absolute;left:9px;top:-1px;height:18px;width:calc(100% - 9px);}html /deep/ hierarchy-item::shadow fire-ui-text-input[icon]{left:27px;width:calc(100% - 27px)}html /deep/ hierarchy-item::shadow fire-ui-text-input::shadow .input-area{padding:0 1px}</style></head><body><div hidden=""><polymer-element name="hierarchy-item" extends="fire-ui-ti" constructor="HierarchyItem" draggable="true" assetpath=""><template><style>:host([hover]) #bar{background-color:#333}:host([conflicted]) #bar{background-color:#900}:host([highlighted]) #header{background-color:#c7722c}:host([invalid]) #header{background-color:#f00}:host{display:block;font-size:12px;margin-left:0}:host([folded]) #content{display:none}#header{position:relative;padding-bottom:1px}#bar{position:absolute;left:0;right:0;height:16px}:host([selected]) #bar{background-color:#555}.inline-block-wrapper{display:inline-block}.flex-wrapper{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:flex-end;white-space:nowrap;height:16px;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;color:#aaa;cursor:default}#foldIcon{font-size:14px;width:10px;margin-right:2px;visibility:hidden;cursor:pointer;text-align:center}:host([foldable]) #foldIcon{visibility:visible}#typeIcon{font-size:16px;width:16px;height:16px;margin-right:2px;}#typeIcon[hidden]{display:none}#typeIcon img{width:16px;height:16px}#name.no-name{color:#6e6e6e}#content{display:block}</style><div id="bar" on-mouseenter="{{mouseenterAction}}" on-mouseleave="{{mouseleaveAction}}"></div><div id="header" on-mouseenter="{{mouseenterAction}}" on-mouseleave="{{mouseleaveAction}}"><div class="inline-block-wrapper"><div class="flex-wrapper"><i id="foldIcon" class="fa {{folded ? 'fa-caret-right' : 'fa-caret-down'}}" on-click="{{foldAction}}" on-mousedown="{{mousedownAction}}"></i><i id="typeIcon" hidden=""></i><span id="name" class="{{name === '' ? 'no-name' : ''}}">{{name === '' ? 'No Name' : name}}</span></div></div></div><div id="content"><content></content></div></template><script>!function(){Polymer("hierarchy-item",{publish:{selected:{value:!1,reflect:!0},conflicted:{value:!1,reflect:!0},highlighted:{value:!1,reflect:!0},invalid:{value:!1,reflect:!0},hover:{value:!1,reflect:!0}},created:function(){this["super"](),this._isToggle=!1,this._isShift=!1,this.renaming=!1},mouseenterAction:function(a){Fire.Selection.hoverEntity(this.userId),a.stopPropagation()},mouseleaveAction:function(a){Fire.Selection.hoverEntity(null),a.stopPropagation()}})}();</script></polymer-element><polymer-element name="hierarchy-tree" extends="fire-ui-tree" constructor="HierarchyTree" on-open="{{openAction}}" on-contextmenu="{{contextmenuAction}}" on-dragstart="{{dragstartAction}}" on-dragend="{{dragendAction}}" on-dragover="{{dragoverAction}}" on-drop="{{dropAction}}" assetpath=""><template><style>:host{box-shadow:none;background:none;border:none}:host::shadow .highlight{display:none;position:absolute;border:1px solid #c7722c;box-sizing:border-box;pointer-events:none}:host::shadow .insert{display:none;position:absolute;border:1px solid #0f0;box-sizing:border-box;pointer-events:none}</style><shadow></shadow></template><script>!function(){var a=require("ipc"),b=require("remote"),c=b.require("menu");Polymer("hierarchy-tree",{created:function(){this["super"](),this.contextmenuAt=null,this.dragenterCnt=0,this.curDragoverEL=null,this.lastDragoverEL=null,hierarchy=this,this.ipc=new Fire.IpcListener},ready:function(){this["super"](),this.addEventListener("dragenter",function(a){++this.dragenterCnt},!0),this.addEventListener("dragleave",function(a){--this.dragenterCnt,0===this.dragenterCnt&&this.resetDragState()},!0),this.refresh()},attached:function(){this.ipc.on("entity:removed",this.deleteItemById.bind(this)),this.ipc.on("entity:parentChanged",this.setItemParentById.bind(this)),this.ipc.on("entity:indexChanged",this.setItemIndex.bind(this)),this.ipc.on("entity:renamed",this.renameItemById.bind(this)),this.ipc.on("hierarchy:createEntity",this.createEntity.bind(this)),this.ipc.on("hierarchy:createChildEntity",this.createChildEntity.bind(this)),this.ipc.on("hierarchy:rename",function(){this.contextmenuAt instanceof HierarchyItem&&this.contextmenuAt.rename()}.bind(this)),this.ipc.on("hierarchy:delete",this.deleteSelection.bind(this)),this.ipc.on("hierarchy:duplicate",this.duplicateSelection.bind(this))},detached:function(){this.ipc.clear()},getContextMenuTemplate:function(){var a=[{label:"Duplicate",message:"hierarchy:duplicate"},{type:"separator"},{label:"Rename",message:"hierarchy:rename"},{label:"Delete",message:"hierarchy:delete"},{type:"separator"}],b=Fire.plugins.hierarchy.getMenuTemplate("hierarchy");return a=a.concat(b)},newItem:function(a,b,c){var d=new HierarchyItem;return this.initItem(d,a,b,c),d},setItemIndex:function(a,b){var c=this.idToItem[a];if(c)if(b){var d=this.idToItem[b];if(!d)return;c.parentElement.insertBefore(c,d)}else c.parentElement.appendChild(c)},refresh:function(){function a(c,d){var e=Fire.plugins.hierarchy.newEntity(c.name,c._objFlags,c.id,d);if(e){for(var f=c._children,g=0,h=f.length;h>g;g++)a(f[g],e);e.selected=-1!==b.indexOf(e.userId)}}if(this.clear(),Fire.Engine._scene)for(var b=Fire.Selection.entities,c=Fire.Engine._scene.entities,d=0,e=c.length;e>d;d++)a(c[d])},highlightBorder:function(a){if(a&&a instanceof HierarchyItem){var b=this.$.highlightBorder.style;b.display="block",b.left=a.offsetLeft-2+"px",b.top=a.offsetTop-1+"px",b.width=a.offsetWidth+4+"px",b.height=a.offsetHeight+3+"px"}else this.$.highlightBorder.style.display="none"},highlightInsert:function(a,b){if(a){var c=this.$.insertLine.style;"inside"===b?!a.folded&&a.firstElementChild?(c.display="block",c.top=a.firstElementChild.offsetTop-1+"px",c.left=a.firstElementChild.offsetLeft-2+"px",c.width=a.firstElementChild.offsetWidth+4+"px",c.height="0px"):c.display="none":(c.display="block",c.left=a.offsetLeft-2+"px",c.width=a.offsetWidth+4+"px","before"===b?c.top=a.offsetTop+"px":"after"===b&&(c.top=a.offsetTop+a.offsetHeight+"px"),c.height="0px")}},cancelHighligting:function(){this.$.highlightBorder.style.display="none",this.$.insertLine.style.display="none"},resetDragState:function(){this.cancelHighligting(),this.curDragoverEL=null,this.lastDragoverEL=null,this.dragenterCnt=0},moveEntities:function(a,b,c){Fire.sendToMainPage("engine:moveEntities",b,a?a.userId:null,c)},createEntity:function(){var a=this.contextmenuAt&&this.contextmenuAt.parentElement;a instanceof HierarchyItem?Fire.sendToMainPage("engine:createEntity",a.userId):Fire.sendToMainPage("engine:createEntity")},createChildEntity:function(){if(this.contextmenuAt)Fire.sendToMainPage("engine:createEntity",this.contextmenuAt.userId);else{var a=Fire.Selection.activeEntityId;Fire.sendToMainPage("engine:createEntity",a)}},deleteSelection:function(){Fire.sendToMainPage("engine:deleteEntities",Fire.Selection.entities)},duplicateSelection:function(){var a=this.getToplevelElements(Fire.Selection.entities).map(function(a){return a&&a.userId});Fire.sendToMainPage("engine:duplicateEntities",a)},select:function(a){Fire.Selection.selectEntity(a.userId,!0,!0)},clearSelect:function(){Fire.Selection.clearEntity(),this.activeElement=null,this.shiftStartElement=null},selectingAction:function(a){a.stopPropagation(),this.focus();var b=this.shiftStartElement;if(this.shiftStartElement=null,a.detail.shift){null===b&&(b=this.activeElement),this.shiftStartElement=b;var c=this.shiftStartElement,d=[];if(b!==a.target)if(this.shiftStartElement.offsetTop<a.target.offsetTop)for(;c!==a.target;)d.push(c.userId),c=this.nextItem(c);else for(;c!==a.target;)d.push(c.userId),c=this.prevItem(c);d.push(a.target.userId),Fire.Selection.selectEntity(d,!0,!1)}else a.detail.toggle?a.target.selected?Fire.Selection.unselectEntity(a.target.userId,!1):Fire.Selection.selectEntity(a.target.userId,!1,!1):a.target.selected||Fire.Selection.selectEntity(a.target.userId,!0,!1)},selectAction:function(a){a.stopPropagation(),a.detail.shift?Fire.Selection.confirm():a.detail.toggle?Fire.Selection.confirm():Fire.Selection.selectEntity(a.target.userId,!0)},renameConfirmAction:function(a){a.stopPropagation();var b=this.$.nameInput.renamingEL;this.$.nameInput.style.display="none",this.$.content.appendChild(this.$.nameInput),this.$.nameInput.renamingEL=null,window.requestAnimationFrame(function(){this.focus()}.bind(this)),b._renaming=!1,Fire.sendToMainPage("engine:renameEntity",b.userId,a.target.value)},openAction:function(a){a.target instanceof HierarchyItem,a.stopPropagation()},contextmenuAction:function(a){if(this.resetDragState(),this.contextmenuAt=null,a.target instanceof HierarchyItem){this.contextmenuAt=a.target;var b=-1===Fire.Selection.entities.indexOf(a.target.userId);Fire.Selection.selectEntity(a.target.userId,b,!0)}Fire.popupMenu(this.getContextMenuTemplate()),a.stopPropagation()},keydownAction:function(a){if(this["super"]([a]),!a.cancelBubble)switch(a.which){case 46:this.deleteSelection(),a.stopPropagation();break;case 8:a.metaKey&&this.deleteSelection(),a.stopPropagation()}},dragstartAction:function(a){a.stopPropagation(),EditorUI.DragDrop.start(a.dataTransfer,"move","entity",Fire.Selection.entities.map(function(a){var b=Fire._getInstanceById(a);return{name:b.name,id:a}}))},dragendAction:function(a){EditorUI.DragDrop.end(),this.resetDragState(),Fire.Selection.cancel()},dragoverAction:function(a){var b=EditorUI.DragDrop.type(a.dataTransfer);if("entity"!==b&&"asset"!==b)return void EditorUI.DragDrop.allowDrop(a.dataTransfer,!1);if(a.preventDefault(),a.stopPropagation(),a.target){this.lastDragoverEL=this.curDragoverEL;var c,d=this.getBoundingClientRect(),e=a.clientY-d.top+this.scrollTop,f=a.target;f!==this.lastDragoverEL&&(f===this&&(f=e<=this.firstElementChild.offsetTop?this.firstElementChild:this.lastElementChild),this.curDragoverEL=f),c=e<=f.offsetTop+.3*f.offsetHeight?"before":e>=f.offsetTop+.7*f.offsetHeight?"after":"inside",this.highlightBorder("inside"===c?f:f.parentElement),this.highlightInsert(f,c),EditorUI.DragDrop.allowDrop(a.dataTransfer,!0)}var g="none";"asset"===b?g="copy":"entity"===b&&(g="move"),EditorUI.DragDrop.updateDropEffect(a.dataTransfer,g)},dropAction:function(a){var b=EditorUI.DragDrop.type(a.dataTransfer);if("asset"===b||"entity"===b){a.preventDefault(),a.stopPropagation();var c=EditorUI.DragDrop.drop(a.dataTransfer);if(this.resetDragState(),Fire.Selection.cancel(),c.length>0){var d=a.target,e=null,f=null,g=this.getBoundingClientRect(),h=a.clientY-g.top+this.scrollTop;if(d===this?(e=null,this.firstElementChild&&h<=this.firstElementChild.offsetTop&&(f=this.firstElementChild.userId)):h<=d.offsetTop+.3*d.offsetHeight?(f=d.userId,e=d.parentElement):h>=d.offsetTop+.7*d.offsetHeight?(f=d.nextElementSibling?d.nextElementSibling.userId:null,e=d.parentElement):(f=null,e=d,e.firstElementChild&&(f=e.firstElementChild.userId)),e===this&&(e=null),"entity"===b)this.moveEntities(e,c,f);else if("asset"===b){var i=null;e&&(i=Fire._getInstanceById(e.userId)),Fire.Selection.clearEntity();for(var j=function(a,b){b&&b.createEntity&&b.createEntity(function(a){a.parent=i,a.transform.position=new Fire.Vec2(0,0),Fire.Selection.selectEntity(a.id,!1,!0),Fire.sendToPages("scene:dirty"),Fire.AssetLibrary.cacheAsset(b)}.bind(this))}.bind(this),k=0;k<c.length;++k)Fire.AssetLibrary.loadAsset(c[k],j)}}}}})}();</script></polymer-element></div><polymer-element name="fire-hierarchy" constructor="FireHierarchy" assetpath=""><template><style>:host{display:flex;flex-direction:column;flex-wrap:nowrap;align-items:stretch;font-size:12px;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;color:#aaa;cursor:default;outline:none}</style><fire-ui-toolbar><i on-click="{{createAction}}" class="fa fa-plus"></i><fire-ui-text-input flex-1="" placeholder="Search..."></fire-ui-text-input></fire-ui-toolbar><hierarchy-tree id="hierarchyTree" flex-1=""></hierarchy-tree></template><script>!function(){function a(b,c,d,e){if(!(d.objFlags&Fire._ObjectFlags.HideInEditor)){var f=b.newItem(d.name,d.id,e);c&&(f.selected=-1!==c.indexOf(f.userId));for(var g=d.children,h=0,i=g.length;i>h;h++)a(b,c,g[h],f)}}var b=require("remote"),c=b.require("menu");Polymer("fire-hierarchy",{created:function(){this.icon=new Image,this.icon.src="fire://static/img/plugin-hierarchy.png",this.ipc=new Fire.IpcListener},attached:function(){this.ipc.on("entity:created",this.newEntity.bind(this)),this.ipc.on("scene:launched",this.reload.bind(this)),this.ipc.on("selection:entity:selected",this.select.bind(this,!0)),this.ipc.on("selection:entity:unselected",this.select.bind(this,!1)),this.ipc.on("selection:entity:hover",this.hover.bind(this)),this.ipc.on("selection:entity:hoverout",this.hoverout.bind(this)),this.ipc.on("selection:entity:activated",this.active.bind(this,!0)),this.ipc.on("selection:entity:deactivated",this.active.bind(this,!1)),this.ipc.on("entity:hint",this.hint.bind(this))},detached:function(){this.ipc.clear()},select:function(a,b){for(var c=0;c<b.length;++c){var d=b[c],e=this.$.hierarchyTree.idToItem[d];e&&(e.selected=a)}},active:function(a,b){if(a){var c=this.$.hierarchyTree.idToItem[b];this.$.hierarchyTree.active(c)}else this.$.hierarchyTree.active(null)},hover:function(a){var b=this.$.hierarchyTree.idToItem[a];b&&(b.hover=!0)},hoverout:function(a){var b=this.$.hierarchyTree.idToItem[a];b&&(b.hover=!1)},hint:function(a){this.$.hierarchyTree.hintItem(a)},createAction:function(){var a="create";Fire.popupMenu(Fire.plugins.hierarchy.getMenuTemplate(a))},reload:function(b){var c=this.$.hierarchyTree;c.clear();for(var d=Fire.Selection.entities,e=b.entities,f=0,g=e.length;g>f;f++)a(c,d,e[f])},newEntity:function(b,c,d,e){var f=this.$.hierarchyTree;if("string"==typeof b){if(!(c&Fire._ObjectFlags.HideInEditor))return f.newItem(b,d,e)}else if(b){var g=b;a(f,null,g)}}})}();</script></polymer-element></body></html>