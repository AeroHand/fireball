<html><head><style>html /deep/ assets-tree[focused] assets-item[selected]::shadow #bar{background:#059}html /deep/ assets-tree[focused] assets-item[conflicted]::shadow #bar{background:#900}html /deep/ assets-item>assets-item{margin-left:18px}html /deep/ assets-item::shadow fire-ui-text-input{position:absolute;left:9px;top:-1px;height:18px;width:calc(100% - 9px);}html /deep/ assets-item::shadow fire-ui-text-input[icon]{left:27px;width:calc(100% - 27px)}html /deep/ assets-item::shadow fire-ui-text-input::shadow .input-area{padding:0 1px}html /deep/ assets-item::shadow .type-icon.folder{background-image:url("img/assets-folder.png")}html /deep/ assets-item::shadow .type-icon.db{background-image:url("img/assets-db.png")}html /deep/ assets-item::shadow .type-icon.fire{background-image:url("img/assets-fire.png")}html /deep/ assets-item::shadow .type-icon.txt{background-image:url("img/assets-txt.png")}html /deep/ assets-item::shadow .type-icon.js{background-image:url("img/assets-js.png")}html /deep/ assets-item::shadow .type-icon.co{background-image:url("img/assets-co.png")}html /deep/ assets-item::shadow .type-icon.ts{background-image:url("img/assets-ts.png")}html /deep/ assets-item::shadow .type-icon.html{background-image:url("img/assets-html.png")}html /deep/ assets-item::shadow .type-icon.css{background-image:url("img/assets-css.png")}html /deep/ assets-item::shadow .type-icon.anim{background-image:url("img/assets-anim.png")}html /deep/ assets-item::shadow .type-icon.bmfont{background-image:url("img/assets-bmfont.png")}html /deep/ assets-item::shadow .type-icon.sprite{background-image:url("img/assets-sprite.png")}html /deep/ assets-item::shadow .type-icon.audio{background-image:url("img/assets-audio.png")}html /deep/ assets-item::shadow .type-icon.atlas{background-image:url("img/assets-atlas.png")}html /deep/ assets-item::shadow .type-icon.fa-cube{color:#0f9}html /deep/ assets-item::shadow .type-icon.fa-question-circle{color:#f00}html /deep/ assets-item::shadow .type-icon.fa-fire{color:#dc5b3c}</style></head><body><div hidden=""><polymer-element name="assets-item" extends="fire-ui-ti" constructor="AssetsItem" draggable="true" assetpath=""><template><style>:host([conflicted]) #bar{background-color:#900}:host([highlighted]) #header{background-color:#c7722c}:host([invalid]) #header{background-color:#f00}:host{display:block;font-size:12px;margin-left:0}:host([folded]) #content{display:none}#header{position:relative;padding-bottom:1px}#bar{position:absolute;left:0;right:0;height:16px}:host([selected]) #bar{background-color:#555}.inline-block-wrapper{display:inline-block}.flex-wrapper{display:flex;flex-direction:row;flex-wrap:nowrap;align-items:flex-end;white-space:nowrap;height:16px;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;color:#aaa;cursor:default}#foldIcon{font-size:14px;width:10px;margin-right:2px;visibility:hidden;cursor:pointer;text-align:center}:host([foldable]) #foldIcon{visibility:visible}#typeIcon{font-size:16px;width:16px;height:16px;margin-right:2px;}#typeIcon[hidden]{display:none}#typeIcon img{width:16px;height:16px}#name.no-name{color:#6e6e6e}#content{display:block}</style><div id="bar"></div><div id="header"><div class="inline-block-wrapper"><div class="flex-wrapper"><i id="foldIcon" class="fa {{folded ? 'fa-caret-right' : 'fa-caret-down'}}" on-click="{{foldAction}}" on-mousedown="{{mousedownAction}}"></i><i id="typeIcon" hidden=""></i><span id="name" class="{{name === '' ? 'no-name' : ''}}">{{name === '' ? 'No Name' : name}}</span></div></div></div><div id="content"><content></content></div></template><script>!function(){function a(a,b){for(var c=0,d=a.length-1,e,f;d>=c;)if(e=c+d>>1,name=a[e].name+a[e].extname,name<b)c=e+1;else{if(!(name>b))return e;d=e-1}return c}function b(b,c){var d=a(b.children,c.name+c.extname);-1===d?b.appendChild(c):b.insertBefore(c,b.children[d])}Polymer("assets-item",{publish:{conflicted:{value:!1,reflect:!0},highlighted:{value:!1,reflect:!0},invalid:{value:!1,reflect:!0}},created:function(){this["super"](),this.extname="",this.isRoot=!1,this.isFolder=!1,this.isSubAsset=!1},addChild:function(a){b(this,a),this.foldable=!0}})}();</script></polymer-element><polymer-element name="assets-tree" extends="fire-ui-tree" constructor="AssetsTree" on-open="{{openAction}}" on-contextmenu="{{contextmenuAction}}" on-dragstart="{{dragstartAction}}" on-dragend="{{dragendAction}}" on-dragover="{{dragoverAction}}" on-drop="{{dropAction}}" assetpath=""><template><style>:host::shadow .highlight{display:none;position:absolute;border:2px solid #c7722c;box-sizing:border-box;pointer-events:none}:host::shadow .highlight[invalid]{border:2px solid #f00}:host::shadow .insert{display:none;position:absolute;border:1px solid #0f0;box-sizing:border-box;pointer-events:none}</style><shadow></shadow></template><script>!function(){function a(a){return".png"===a||".jpg"===a}function b(a,b,c,d){var e=new AssetsItem;e.isRoot="root"===b,e.isFolder="folder"===b||e.isRoot,e.isSubAsset=!d.isFolder;var g="",h=f.basename(a);e.isFolder||(g=f.extname(a),h=f.basename(a,g));var i;switch(e.extname=g,b=b||g.toLowerCase()){case"root":e.setIcon("db");break;case"folder":e.setIcon("folder");break;case".fire":e.setIcon("fire");break;case".js":e.setIcon("js");break;case".coffee":e.setIcon("co");break;case".ts":e.setIcon("ts");break;case".txt":e.setIcon("txt");break;case".html":case".htm":case".xml":case".json":e.setIcon("html");break;case".css":case".less":case".styl":e.setIcon("css");break;case".anim":e.setIcon("anim");break;case".sprite":e.setIcon("sprite");break;case".fnt":case".bmf":case".bmfont":e.setIcon("bmfont");break;case".atlas":e.setIcon("atlas");break;case".mp3":case".wav":case".ogg":e.setIcon("audio");break;case".png":case".jpg":i=new Image,i.src="uuid://"+c+"?thumb",e.setIcon(i);break;case".asset":e.setIcon("fa fa-cube");break;default:e.setIcon("fa fa-question-circle")}return this.initItem(e,h,c,d),e}function c(a,b){var c=a.childNodes,d=c.length,e=b.length,f,g,h,i,j=[];for(f=0;e>f;f++)for(h=b[f],g=0;d>g;g++)i=c[g],i.name+i.extname===h&&j.push(i);return j}function d(a,b){function c(a,b){for(var c=0;c<a.length;c++)if(a[c].label===b)return a[c];return null}function d(){if(a.contextmenuAt instanceof AssetsItem){var b=a.contextmenuAt;a.contextmenuAt.isFolder||(b=a.contextmenuAt.parentElement);var c=a.getUrl(b),d=new h.customAsset,e=f.join(c,j+".asset");a._focusUrl=e,Fire.sendToCore("asset-db:save",e,Fire.serialize(d))}}for(var e=Fire._customAssetMenuItems,g=0;g<e.length;g++){var h=e[g],i=h.menuPath.split("/"),j=i.length>0?i[i.length-1]:i[0];if(""!==j){for(var k=h.priority||0,l=null,m=0,n=b;m<i.length;m++){var o=i[m];if(o){var p=n===b?b:n.submenu,q;if(p&&(p.length>0&&(q=c(p,o)),q)){if(q.submenu){n=q;continue}Fire.error("Custom Asset menu path %s conflict",h.menuPath);break}l={label:o},p?p.splice(3,0,l):n.submenu=[l],n=l}}l&&!l.submenu?l.click=d:Fire.error("Invalid custom asset menu path: "+h.menuPath)}else Fire.error("Invalid custom asset menu path: "+h.menuPath)}}var e=require("fire-path"),f=require("fire-url"),g=require("remote"),h=g.require("menu");Polymer("assets-tree",{created:function(){this["super"](),this.contextmenu=null,this.contextmenuAt=null,this.curDragoverEL=null,this.lastDragoverEL=null,this.dragenterCnt=0,this.confliction=[],this.ipc=new Fire.IpcListener,this._focusUrl=null},ready:function(){this["super"](),this.addEventListener("dragenter",function(a){++this.dragenterCnt},!0),this.addEventListener("dragleave",function(a){--this.dragenterCnt,0===this.dragenterCnt&&this.resetDragState()},!0)},attached:function(){this.ipc.on("folder:created",function(a,b,c){this.newItem(a,b,c,!0)}.bind(this)),this.ipc.on("asset:created",function(a,b,c){this.newItem(a,b,c,!1)}.bind(this)),this.ipc.on("asset:moved",this.moveItem.bind(this)),this.ipc.on("assets:created",function(a){for(var b=0;b<a.length;++b){var c=a[b];this.newItem(c.url,c.uuid,c.parentUuid,c.isDir)}}.bind(this)),this.ipc.on("assets:deleted",function(a){for(var b=Fire.arrayCmpFilter(a,function(a,b){return e.contains(a.url,b.url)?1:e.contains(b.url,a.url)?-1:0}),c=0;c<b.length;++c)this.deleteItemById(b[c].uuid)}.bind(this)),this.ipc.on("asset-db:deep-query-results",function(a,b){for(var c=0;c<b.length;++c){var d=b[c];this.newItem(d.url,d.uuid,d.parentUuid,d.isDir)}}.bind(this)),this.ipc.on("asset:refresh-context-menu",function(){this.contextmenu=null}.bind(this))},detached:function(){this.ipc.clear()},createContextMenu:function(){var b=[{label:"Create",submenu:[{label:"New Scene",click:function(){var a=this.contextmenuAt;if(a instanceof AssetsItem){a.isFolder||(a=a.parentElement);var b=this.getUrl(a),c=new Fire._Scene,d=f.join(b,"New Scene.fire");this._focusUrl=d,Fire.sendToCore("asset-db:save",d,Fire.serialize(c))}}.bind(this)},{label:"New Folder",click:function(){var a=this.contextmenuAt;if(a instanceof AssetsItem){a.isFolder||(a=a.parentElement);var b=this.getUrl(a),c=f.join(b,"New Folder");this._focusUrl=c,Fire.rpc("asset-db:makedirs",c)}}.bind(this)},{label:"New Sprite (Standalone)",click:function(){var b=this.contextmenuAt;if(b instanceof AssetsItem&&a(b.extname)){var c=b.name;Fire.AssetLibrary.loadAsset(b.userId,function(a,d){var e=new Fire.Sprite;e.texture=d,e.width=d.width,e.height=d.height;var g=this.getUrl(b.parentElement),h=f.join(g,c+".sprite");this._focusUrl=h,Fire.sendToCore("asset-db:save",h,Fire.serialize(e))}.bind(this))}else Fire.warn("Can not create sprite from non-texture element, please select a texture first.")}.bind(this)},{label:"New Atlas",click:function(){var a=this.contextmenuAt;if(a instanceof AssetsItem){a.isFolder||(a=a.parentElement);var b=new Fire.Atlas,c=this.getUrl(a),d=f.join(c,"New Atlas.atlas");this._focusUrl=d,Fire.sendToCore("asset-db:save",d,Fire.serialize(b))}}.bind(this)}]},{type:"separator"},{label:"Rename",click:function(){this.contextmenuAt instanceof AssetsItem&&this.rename(this.contextmenuAt)}.bind(this)},{label:"Delete",click:this.deleteSelection.bind(this)},{label:"Reimport",click:function(){if(this.contextmenuAt instanceof AssetsItem){var a=this.contextmenuAt,b=this.getUrl(a);if(a.isFolder){for(;a.firstChild;)a.removeChild(a.firstChild);a.foldable=!1}Fire.sendToCore("asset-db:reimport",b)}}.bind(this)},{type:"separator"},{label:"Show in "+(Fire.isWin32?"Explorer":"Finder"),click:function(){this.contextmenuAt instanceof AssetsItem&&Fire.sendToCore("asset-db:explore",this.getUrl(this.contextmenuAt))}.bind(this)},{label:"Show in Library",click:function(){this.contextmenuAt instanceof AssetsItem&&Fire.sendToCore("asset-db:explore-lib",this.getUrl(this.contextmenuAt))}.bind(this)},{label:"Show Uuid",click:function(){this.contextmenuAt instanceof AssetsItem&&Fire.log(this.contextmenuAt.userId)}.bind(this)}];d(this,b),this.contextmenu=h.buildFromTemplate(b)},browse:function(a){var c=b.call(this,a,"root",Fire.UUID.AssetsRoot,this);c.folded=!1,Fire.sendToCore("asset-db:deep-query",a)},newItem:function(a,c,d,e){var f=this.idToItem[d];if(!f)return void Fire.warn("Can not find element for "+d+" when import "+a);var g=e?"folder":"",h=b.call(this,a,g,c,f);this._focusUrl===a&&(this._focusUrl=null,this.scrollToItem(h),Fire.Selection.selectAsset(h.userId,!0,!0))},moveItem:function(a,b,c){var d=this.idToItem[a];if(!d)return void Fire.warn("Can not find source element: "+a);var f=e.extname(b),g=e.basename(b,f);d.extname=f,d.name=g,this.setItemParentById(a,c);var h=this.idToItem[c];h.isFolder&&(h.folded=!1)},deleteSelection:function(){for(var a=this.getToplevelElements(Fire.Selection.assets),b=0;b<a.length;b++)Fire.sendToCore("asset-db:delete",this.getUrl(a[b]))},getUrl:function(a){if(a.isRoot)return a.name+"://";for(var b=a.name+a.extname,c=a.parentElement;c instanceof AssetsItem;){if(c.isRoot){b=c.name+"://"+b;break}b=f.join(c.name+c.extname,b),c=c.parentElement}return b},highlightBorder:function(a){if(a&&a instanceof AssetsItem){var b=this.$.highlightBorder.style;b.display="block",b.left=a.offsetLeft-2+"px",b.top=a.offsetTop-1+"px",b.width=a.offsetWidth+4+"px",b.height=a.offsetHeight+3+"px",a.highlighted=!0}},highlightInsert:function(a,b,c){var d=this.$.insertLine.style;a===this&&(a=this.firstChild),a===b?d.display="none":a&&b&&(d.display="block",d.left=b.offsetLeft+"px",d.top="before"===c?a.offsetTop+"px":a.offsetTop+a.offsetHeight+"px",d.width=b.offsetWidth+"px",d.height="0px")},highlightConflicts:function(a){for(var b=0;b<a.length;++b){var c=a[b];c.conflicted===!1&&(c.conflicted=!0,this.confliction.push(c))}this.curDragoverEL&&(this.curDragoverEL.invalid=!0),this.$.highlightBorder.setAttribute("invalid","")},cancelHighligting:function(){this.curDragoverEL&&(this.curDragoverEL.highlighted=!1,this.$.highlightBorder.style.display="none",this.$.insertLine.style.display="none")},cancelConflictsHighliting:function(){for(var a=0;a<this.confliction.length;++a)this.confliction[a].conflicted=!1;this.confliction=[],this.curDragoverEL&&(this.curDragoverEL.invalid=!1,this.$.highlightBorder.removeAttribute("invalid"))},resetDragState:function(){this.cancelHighligting(),this.cancelConflictsHighliting(),this.curDragoverEL=null,this.lastDragoverEL=null,this.dragenterCnt=0},moveAssets:function(a,b){for(var c=this.getToplevelElements(b),d=this.getUrl(a),e=0;e<c.length;++e){var g=c[e];if(g!==a&&g.parentElement!==a&&g.contains(a)===!1){var h=this.getUrl(g),i=f.join(d,g.name+g.extname);Fire.sendToCore("asset-db:move",h,i)}}},select:function(a){Fire.Selection.selectAsset(a.userId,!0,!0)},clearSelect:function(){Fire.Selection.clearAsset(),this.activeElement=null,this.shiftStartElement=null},selectingAction:function(a){a.stopPropagation(),this.focus();var b=this.shiftStartElement;if(this.shiftStartElement=null,a.detail.shift){null===b&&(b=this.activeElement),this.shiftStartElement=b;var c=this.shiftStartElement,d=[];if(b!==a.target)if(this.shiftStartElement.offsetTop<a.target.offsetTop)for(;c!==a.target;)d.push(c.userId),c=this.nextItem(c);else for(;c!==a.target;)d.push(c.userId),c=this.prevItem(c);d.push(a.target.userId),Fire.Selection.selectAsset(d,!0,!1)}else a.detail.toggle?a.target.selected?Fire.Selection.unselectAsset(a.target.userId,!1):Fire.Selection.selectAsset(a.target.userId,!1,!1):a.target.selected||Fire.Selection.selectAsset(a.target.userId,!0,!1)},selectAction:function(a){a.stopPropagation(),a.detail.shift?Fire.Selection.confirm():a.detail.toggle?Fire.Selection.confirm():Fire.Selection.selectAsset(a.target.userId,!0)},renameConfirmAction:function(a){a.stopPropagation();var b=this.$.nameInput.renamingEL;if(this.$.nameInput.style.display="none",this.$.content.appendChild(this.$.nameInput),this.$.nameInput.renamingEL=null,window.requestAnimationFrame(function(){this.focus()}.bind(this)),b._renaming=!1,b.name!==a.target.value){var c=this.getUrl(b),d=f.join(f.dirname(c),a.target.value+b.extname);Fire.sendToCore("asset-db:move",c,d)}},openAction:function(a){if(a.target instanceof AssetsItem){if(".fire"===a.target.extname)return void Fire.sendToMainPage("engine:openScene",a.target.userId);Fire.sendToCore("asset:open",a.target.userId)}a.stopPropagation()},contextmenuAction:function(a){if(a.stopPropagation(),this.resetDragState(),this.contextmenuAt=null,a.target instanceof AssetsItem){this.contextmenuAt=a.target;var b=-1===Fire.Selection.assets.indexOf(a.target.userId);Fire.Selection.selectAsset(a.target.userId,b,!0)}else this.contextmenuAt=this.idToItem[Fire.UUID.AssetsRoot];this.contextmenu||this.createContextMenu(),this.contextmenu.popup(g.getCurrentWindow())},keydownAction:function(a){if(this["super"]([a]),!a.cancelBubble)switch(a.which){case 46:this.deleteSelection(),a.stopPropagation();break;case 8:a.metaKey&&this.deleteSelection(),a.stopPropagation()}},dragstartAction:function(a){a.stopPropagation(),EditorUI.DragDrop.start(a.dataTransfer,"copyMove","asset",Fire.Selection.assets.map(function(a){var b=a,c=this.idToItem[b];return{name:c.name,id:a}}.bind(this)))},dragendAction:function(a){EditorUI.DragDrop.end(),this.resetDragState(),Fire.Selection.cancel()},dragoverAction:function(a){var b=EditorUI.DragDrop.type(a.dataTransfer);if("file"!==b&&"asset"!==b)return void EditorUI.DragDrop.allowDrop(a.dataTransfer,!1);if(a.preventDefault(),a.stopPropagation(),a.target){this.lastDragoverEL=this.curDragoverEL;var d=a.target;if(a.target.isFolder===!1&&(d=a.target.parentElement),a.target===this&&(d=this.firstChild),d!==this.lastDragoverEL){this.cancelHighligting(),this.cancelConflictsHighliting(),this.curDragoverEL=d,this.highlightBorder(d);var f=[],g=0,h=EditorUI.DragDrop.items(a.dataTransfer);if("file"===b)for(g=0;g<h.length;g++)f.push(e.basename(h[g]));else if("asset"===b){var i=this.getToplevelElements(h);for(g=0;g<i.length;g++){var j=i[g];d!==j.parentElement&&f.push(j.name+j.extname)}}var k=!0;if(f.length>0){var l=c(d,f);l.length>0&&(this.highlightConflicts(l),k=!1)}EditorUI.DragDrop.allowDrop(a.dataTransfer,k)}var m=this.getBoundingClientRect(),n=a.clientY-m.top+this.scrollTop,o="before";n>=a.target.offsetTop+.5*a.target.offsetHeight&&(o="after"),this.highlightInsert(a.target,d,o)}var p="none";"file"===b?p="copy":"asset"===b&&(p="move"),EditorUI.DragDrop.updateDropEffect(a.dataTransfer,p)},dropAction:function(a){var b=EditorUI.DragDrop.type(a.dataTransfer);if("asset"===b||"entity"===b||"file"===b){a.preventDefault(),a.stopPropagation();var c=EditorUI.DragDrop.drop(a.dataTransfer),d=this.curDragoverEL;if(this.resetDragState(),Fire.Selection.cancel(),c.length>0)if("file"===b){var e=this.getUrl(d);Fire.sendToCore("asset-db:import",e,c)}else"asset"===b&&this.moveAssets(d,c)}}})}();</script></polymer-element></div><polymer-element name="fire-assets" constructor="FireAssets" assetpath=""><template><style>:host{display:flex;flex-direction:column;flex-wrap:nowrap;align-items:stretch;font-size:12px;font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;color:#aaa;cursor:default;outline:none}</style><fire-ui-toolbar><fire-ui-text-input flex-1="" placeholder="Search..."></fire-ui-text-input><i class="fa fa-search"></i></fire-ui-toolbar><assets-tree id="assetsTree" flex-1=""></assets-tree></template><script>!function(){Polymer("fire-assets",{created:function(){this.icon=new Image,this.icon.src="fire://static/img/plugin-assets.png",this.ipc=new Fire.IpcListener},attached:function(){this.ipc.on("selection:asset:selected",this.select.bind(this,!0)),this.ipc.on("selection:asset:unselected",this.select.bind(this,!1)),this.ipc.on("selection:asset:activated",this.active.bind(this,!0)),this.ipc.on("selection:asset:deactivated",this.active.bind(this,!1)),this.ipc.on("asset:hint",this.hint.bind(this))},detached:function(){this.ipc.clear()},select:function(a,b){for(var c=0;c<b.length;++c){var d=b[c],e=this.$.assetsTree.idToItem[d];e&&(e.selected=a)}},active:function(a,b){if(a){var c=this.$.assetsTree.idToItem[b];this.$.assetsTree.active(c)}else this.$.assetsTree.active(null)},hint:function(a){this.$.assetsTree.hintItem(a)},domReady:function(){Fire.info("browse assets://"),this.$.assetsTree.browse("assets://")}})}();</script></polymer-element></body></html>