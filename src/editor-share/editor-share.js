var Fire=Fire||{};process&&"renderer"!==process.type&&(Fire=global.Fire),function(a){function b(){this.listeningIpcs=[]}function c(b,c,d,e){this["package"]=c,this.name=b,this.path=d,this._mainPath=e,this._ipc=new a.IpcListener}if(a.arrayCmpFilter=function(a,b){var c,d,e,f;for(c=[],e=0;e<a.length;++e){d=a[e];var g=!0;for(f=0;f<c.length;++f){var h=c[f];if(d===h){g=!1;break}var i=b(h,d);if(i>0){g=!1;break}0>i&&(c.splice(f,1),--f)}g&&c.push(d)}return c},a.arrayResize=function(a,b){if(a.length>=b)return void(a.length=b);var c=a.length,d=a[a.length-1];a.length=b;for(var e=c;b>e;++e)a[e]=d.clone?d.clone():d},a.arrayFillUndefined=function(a,b){for(var c=0;c<a.length;++c)void 0===a[c]&&(a[c]=null!==b&&b.clone?b.clone():b)},a.isNode){var d=require("fs"),e=require("path"),f=function(a,b){for(var c=d.readdirSync(a),g=null,h="",i=0;i<c.length;i++){h=e.join(a,c[i]);try{g=d.statSync(h)}catch(j){continue}g.isFile()?b.push(h):g.isDirectory()&&f(h,b)}};a.readDirRecursively=function(b){var c=[];if(Array.isArray(b)){for(var e=0;e<b.length;e++)c=c.concat(a.readDirRecursively(b[e]));return c}var g=null;try{g=d.statSync(b)}catch(h){return[]}return g.isFile()?c.push(b):g.isDirectory()&&f(b,c),c}}else{var g=function(){throw new Error("This function can only be used in node-webkit or server")};a.readDirRecursively=g}if(a.isNodeWebkit&&a.isWeb){a.askSavePath=function(b,c,d,e){"function"==typeof d&&a.error("Fire.askSavePath: swap title and callback please");var f="SaveFileDialog",g=document.getElementById(f);g&&document.body.removeChild(g),g=document.createElement("input"),document.body.appendChild(g),g.id=f,g.style.display="none",g.type="file",g.nwsaveas=b;var h=localStorage[c];g.nwworkingdir=h||"",g.onchange=function(a){document.body.removeChild(g),g.onchange=null,localStorage[c]=this.value,e(this.value)},g.click()},a.getSavePath=function(){a.error("Fire.getSavePath is deprecated, use Fire.askSavePath plz")};var h=require("nw.gui");a.showItemInFolder=h.Shell.showItemInFolder}else if(a.isAtomShell)"undefined"==typeof localStorage&&(localStorage=a.userProfile||{}),a.askSavePath=function(b,c,d,e,f){var g=localStorage[c],h=null;g&&"string"==typeof g&&(g=a.Path.dirname(g),h=a.Path.join(g,b));var i;if(a.isWeb){var j=require("remote");i=j.require("dialog"),f||(f=j.getCurrentWindow())}else if(i=require("dialog"),!f){var k=require("browser-window");f=k.getFocusedWindow()}var l={title:d,defaultPath:h};i.showSaveDialog(f,l,function(a){a&&(localStorage[c]=a),e(a)})},a.askDirPath=function(b,c,d,e,f){var g=localStorage[c];g&&"string"==typeof g&&(b=g);var h;if(a.isWeb){var i=require("remote");h=i.require("dialog"),f||(f=i.getCurrentWindow())}else if(h=require("dialog"),!f){var j=require("browser-window");f=j.getFocusedWindow()}var k={title:d,defaultPath:b,properties:["openDirectory"]};h.showOpenDialog(f,k,function(a){a=a&&a[0],a&&(localStorage[c]=a),e(a)})},a.showItemInFolder=require("shell").showItemInFolder;else{var g=function(){throw new Error("This function can only be used in node-webkit or atom-shell")};a.askSavePath=g,a.askDirPath=g,a.showItemInFolder=g}a.UUID={AssetsRoot:"b4145302-f47b-49a5-ba5e-049f41ee4915"},a.SelfExcluded={FIRE_MSG_OPTIONS:!0,SelfExcluded:!0};var i=require("ipc");b.prototype.on=function(a,b){i.on(a,b),this.listeningIpcs.push([a,b])},b.prototype.clear=function(){for(var a=0;a<this.listeningIpcs.length;a++){var b=this.listeningIpcs[a];i.removeListener(b[0],b[1])}this.listeningIpcs.length=0},a.IpcListener=b;var i=require("ipc");a.Selection=function(){var b="selection:entity:selected",c="selection:asset:selected",d="selection:entity:unselected",e="selection:asset:unselected",f="selection:entity:activated",g="selection:asset:activated",h="selection:entity:hover",j="selection:asset:hover",k="selection:entity:hoverout",l="selection:asset:hoverout",m=function(){function a(a){this.lastActive="",this.selection=[],this.lastHover="",this.msg_selected="selection:"+a+":selected",this.msg_unselected="selection:"+a+":unselected",this.msg_activate="selection:"+a+":activated",this.msg_deactivate="selection:"+a+":deactivated",this.msg_hover="selection:"+a+":hover",this.msg_hoverout="selection:"+a+":hoverout"}return a.prototype._activate=function(a){this.lastActive!==a&&(this.lastActive&&q._sendToAll(this.msg_deactivate,this.lastActive),this.lastActive=a,q._sendToAll(this.msg_activate,a))},a.prototype._unselectOthers=function(a){if(Array.isArray(a)){for(var b=[],c=this.selection.length-1;c>=0;c--){var d=this.selection[c];-1===a.indexOf(d)&&(this.selection.splice(c,1),b.push(d))}b.length>0&&q._sendToAll(this.msg_unselected,b)}else{var e=this.selection.indexOf(a);-1!==e?(this.selection.splice(e,1),this.selection.length>0&&q._sendToAll(this.msg_unselected,this.selection),this.selection=[a]):(this.selection.length>0&&q._sendToAll(this.msg_unselected,this.selection),this.selection.length=0)}},a.prototype.select=function(a,b){if(b&&this._unselectOthers(a),Array.isArray(a)){if(a.length>0){for(var c=[],d=0;d<a.length;d++)-1===this.selection.indexOf(a[d])&&(this.selection.push(a[d]),c.push(a[d]));c.length>0&&q._sendToAll(this.msg_selected,c),this._activate(a[a.length-1])}}else-1===this.selection.indexOf(a)&&(this.selection.push(a),q._sendToAll(this.msg_selected,[a])),this._activate(a)},a.prototype.unselect=function(a){var b=!1;if(Array.isArray(a)){if(a.length>0){for(var c=[],d=0;d<a.length;d++){var e=this.selection.indexOf(a[d]);-1!==e&&(this.selection.splice(e,1),c.push(a[d]),b=b||a[d]===this.lastActive)}c.length>0&&q._sendToAll(this.msg_unselected,c)}}else{var f=this.selection.indexOf(a);-1!==f&&(this.selection.splice(f,1),q._sendToAll(this.msg_unselected,[a]),b=a===this.lastActive)}b&&this._activate(this.selection.length>0?this.selection[this.selection.length-1]:"")},a.prototype.hover=function(a){a="string"==typeof a?a:"",this.lastHover!==a&&(this.lastHover&&q._sendToAll(this.msg_hoverout,this.lastHover),this.lastHover=a,a&&q._sendToAll(this.msg_hover,a))},a.prototype.clear=function(){q._sendToAll(this.msg_unselected,this.selection),this.selection.length=0,this._activate("")},a}(),n=function(){function b(a){d.call(this,a),this.confirmed=!0,this._confirmedSnapShot=[]}function c(a){!this.confirmed&&a?this.confirm():this.confirmed&&!a&&(this._confirmedSnapShot=this.selection.slice(),this.confirmed=!1)}var d=m;return a.extend(b,d),b.prototype._activate=function(a){this.confirmed&&d.prototype._activate.call(this,a)},b.prototype.select=function(a,b,e){c.call(this,e),d.prototype.select.call(this,a,b)},b.prototype.unselect=function(a,b){c.call(this,b),d.prototype.unselect.call(this,a)},b.prototype.confirm=function(){this.confirmed||(this._confirmedSnapShot.length=0,this.confirmed=!0,this._activate(this.selection[this.selection.length-1]))},b.prototype.cancel=function(){this.confirmed||(d.prototype.select.call(this,this._confirmedSnapShot,!0),this._confirmedSnapShot.length=0,this.confirmed=!0)},b}(),o=new n("entity"),p=new n("asset"),q={confirm:function(){o.confirm(),p.confirm()},cancel:function(){o.cancel(),p.cancel()},selectEntity:function(b,c,d){return"string"==typeof b||Array.isArray(b)?(c="undefined"!=typeof c?c:!0,d="undefined"!=typeof d?d:!0,o.select(b,c,d),void(this._lastGlobalActive!==o&&o.confirmed&&o.lastActive&&(this._lastGlobalActive=o,this._doSend("selection:activated","entity",o.lastActive)))):void a.error("entity selection argument must be id(string) or array")},unselectEntity:function(b,c){"string"==typeof b||Array.isArray(b)?(c="undefined"!=typeof c?c:!0,o.unselect(b,c)):a.error("entity selection argument must be id(string) or array")},selectAsset:function(b,c,d){return"string"==typeof b||Array.isArray(b)?(c="undefined"!=typeof c?c:!0,d="undefined"!=typeof d?d:!0,p.select(b,c,d),void(this._lastGlobalActive!==p&&p.confirmed&&p.lastActive&&(this._lastGlobalActive=p,this._doSend("selection:activated","asset",p.lastActive)))):void a.error("asset selection argument must be uuid(string) or array")},unselectAsset:function(b,c){"string"==typeof b||Array.isArray(b)?(c="undefined"!=typeof c?c:!0,p.unselect(b,c)):a.error("asset selection argument must be uuid(string) or array")},hoverEntity:function(a){o.hover(a)},hoverAsset:function(a){p.hover(a)},clearEntity:function(){o.clear(),o.confirm()},clearAsset:function(){p.clear(),p.confirm()},_lastGlobalActive:null,_doSend:function(b,c,d){a.sendToAll(b,c,d)},_sendToAll:function(a,b){switch(this._doSend(a,b),a){case"selection:asset:activated":this._doSend("selection:activated","asset",b),this._lastGlobalActive=p;break;case"selection:asset:deactivated":this._lastGlobalActive===p&&(this._doSend("selection:deactivated","asset",b),this._lastGlobalActive=null);break;case"selection:entity:activated":this._doSend("selection:activated","entity",b),this._lastGlobalActive=o;break;case"selection:entity:deactivated":this._lastGlobalActive===o&&(this._doSend("selection:deactivated","entity",b),this._lastGlobalActive=null)}}};return i.on("window-reloaded",function(a){a.isMainWindow&&(q.clearEntity(),q.clearAsset())}),i.on(b,function(a){a=a.filter(function(a){return-1===o.selection.indexOf(a)}),1===a.length?o.selection.push(a[0]):a.length>1&&(o.selection=o.selection.concat(a))}),i.on(c,function(a){a=a.filter(function(a){return-1===p.selection.indexOf(a)}),1===a.length?p.selection.push(a[0]):a.length>1&&(p.selection=p.selection.concat(a))}),i.on(d,function(a){o.selection=o.selection.filter(function(b){return-1===a.indexOf(b)})}),i.on(e,function(a){p.selection=p.selection.filter(function(b){return-1===a.indexOf(b)})}),i.on(f,function(a){o.lastActive=a}),i.on(g,function(a){p.lastActive=a}),i.on(h,function(a){o.lastHover=a}),i.on(j,function(a){p.lastHover=a}),i.on(k,function(a){o.lastHover=""}),i.on(l,function(a){p.lastHover=""}),Object.defineProperty(q,"hoveringEntityId",{get:function(){return o.lastHover},enumerable:!0}),Object.defineProperty(q,"hoveringAssetUuid",{get:function(){return p.lastHover},enumerable:!0}),Object.defineProperty(q,"activeEntityId",{get:function(){return o.lastActive},enumerable:!0}),Object.defineProperty(q,"activeAssetUuid",{get:function(){return p.lastActive},enumerable:!0}),Object.defineProperty(q,"entities",{get:function(){return o.selection.slice()},enumerable:!0}),Object.defineProperty(q,"assets",{get:function(){return p.selection.slice()},enumerable:!0}),q.filter=function(a,b,c){var d,e,f,g;if("name"===b)d=a.filter(c);else for(d=[],f=0;f<a.length;++f){e=a[f];var h=!0;for(g=0;g<d.length;++g){var i=d[g];if(e===i){h=!1;break}var j=c(i,e);if(j>0){h=!1;break}0>j&&(d.splice(g,1),--g)}h&&d.push(e)}return d},q}();var e=require("path");c.prototype.openWindow=function(b,c){var d=this.config,f=d.windows&&d.windows[b];if(f)if(c=a.mixin(c,f.options),f.url){var g=e.resolve(this.path,f.url);a.sendToCore("plugin:window:open",this.name,b,c,g)}else a.error('Failed to get "%s"\'s "url" from %s\'s package.json.',b,this.name);else a.error('Can not find the %s\'s "%s" window in the package.json.',this.name,b)},c.prototype.on=function(a,b){this._ipc.on(a,b)},c.prototype._destruct=function(){this._ipc.clear()},Object.defineProperty(c.prototype,"config",{get:function(){var a=this["package"]["fireball-x"];return console.assert(a),a}}),Object.defineProperty(c.prototype,"openedWindows",{get:function(){return a._PluginWindowMgr.getWindows(this.name)}}),a._PluginContext=c,a._PluginLoaderBase=function(){function b(a){d.call(this),this.name=a,this.nameToPlugin={},this.launched=!1}var c=require("fire-path"),d=require("events").EventEmitter;return a.extend(b,d),b.prototype.onAfterUnload=function(){},b.prototype._loadImpl=function(){},b.prototype._unloadImpl=function(){},b.prototype.loadAll=function(){for(var a in this.nameToPlugin)this._loadImpl(this.nameToPlugin[a]);this.launched=!0},b.prototype.unloadAll=function(){for(var a in this.nameToPlugin)this.doUnload(this.nameToPlugin[a])},b.prototype.load=function(b,d){var e=b.name,f=b["fireball-x"];if(f){var g=c.dirname(d),h="";f.main&&("string"==typeof f.main?h=c.resolve(g,f.main):a.warn('The "main" data in package.json must be a string'));var i=new a._PluginContext(e,b,g,h);this.nameToPlugin[e]=i,this.launched&&this._loadImpl(i)}},b.prototype.unload=function(b){console.log("unload",b);var c=this.nameToPlugin[b];c?(this.doUnload(c),delete this.nameToPlugin[b],this.onAfterUnload()):a.error("Plugin not loaded:",b)},b.prototype.doUnload=function(a){this._unloadImpl(a),a._destruct()},b.parseMeta=function(b,d){var e=b.config.asset;if(e){var f=c.join(b.path,"package.json");e=[].concat(e);for(var g in e){var h=e[g];h.pattern?h.meta?h.asset?d(h):a.error('Undefined "fireball-x/asset/asset" in %s',f):a.error('Undefined "fireball-x/asset/meta" in %s',f):a.error('Undefined "fireball-x/asset/pattern" in %s',f)}}},b}(),a.AssetInspector=function(){var b=a.define("Fire.AssetInspector",function(){this.dirty=!1});return b.prop("assetDirty",!1,a.HideInInspector),b.prototype.init=function(a,b){},b.prototype.applyAsset=function(a){},b.prototype.applyMeta=function(a){},b}(),a.AssetMeta=function(){var b=require("events"),c=a.define("Fire.AssetMeta",b,function(){this.dirty=!1});return c.prop("ver",0,a.Integer,a.HideInInspector),c.prop("uuid","",a.HideInInspector),c.prop("subRawData",void 0,a.ObjectType(Array)),c.prototype.setDirty=function(){this.dirty=!0},c.prototype.done=function(){this.emit("end")},c.prototype.error=function(a){this.emit("error",a)},c.prototype.exportToJson=function(a,b){d.writeFile(a.path,b,function(a){return a?void this.error(a):void this.done()}.bind(this))},c.prototype.startImport=function(a){return setImmediate(function(){var b=require("fire-path");if(!a.meta)return void this.error(new Error("file.meta is not assigned."));if(a.asset)a.asset.name=b.basenameNoExt(a.path),this["import"](a);else{if(!this.createAsset)return void this.done();this.createAsset(a.path,function(c,d){return c?void this.error(new Error("Failed to create asset for "+a.path)):(d&&(a.asset=d,a.asset.name=b.basenameNoExt(a.path)),void this["import"](a))}.bind(this))}}.bind(this)),this},c.prototype.startExport=function(a,b){return setImmediate(function(){return a.meta?void this["export"](a,b):void this.error(new Error("file.meta is not assigned."))}.bind(this)),this},c.prototype.inspector=a.AssetInspector,c.prototype.assetType=a.Asset,c.prototype.createAsset=function(a,b){b()},c.prototype["import"]=function(a){this.done()},c.prototype["export"]=function(a,b){this.done()},c}(),a.FolderMeta=function(){var b=a.define("Fire.FolderMeta",a.AssetMeta);return b.prototype.createAsset=null,b.prototype["import"]=null,b.prototype["export"]=null,b.prototype.assetType=null,b}(),a.JsonMeta=function(){var b=a.define("Fire.JsonMeta",a.AssetMeta);return b.prop("binary",!1),b.prototype.assetType=a.JsonAsset,b.prototype.createAsset=function(b,c){d.readFile(b,function(d,e){if(d)return void this.error(d);var f=new a.JsonAsset;try{f.json=JSON.parse(e)}catch(g){var h=require("util");return void this.error(new Error(h.format("Failed to parse %s:\n%s",b,g)))}c(null,f)}.bind(this))},b.prototype["import"]=function(b){var c=this,d=require("async");d.parallel([function(c){a.AssetDB.saveAssetToLibrary(b.meta.uuid,b.asset,c)},function(c){a.AssetDB.copyToLibrary(b.meta.uuid,".json",b.path,c)}],function(a){return a?void c.error(a):void c.done()})},b.prototype["export"]=function(a,b){this.exportToJson(a,b)},b}();var j=function(){var b=a.define("Fire.PackageInspector",a.AssetInspector).prop("name","",a.ReadOnly).prop("version","",a.ReadOnly).prop("description","",a.ReadOnly).prop("author","",a.ReadOnly).prop("enable",!0);return b.prototype.init=function(a,b){this.enable=b.enable,this.name=a.json.name||"",this.version=a.json.version||"",this.description=a.json.description||"",this.author=a.json.author||""},b.prototype.applyMeta=function(a){a.enable=this.enable},b}();a.PackageMeta=function(){var b=a.define("Fire.PackageMeta",a.JsonMeta).prop("enable",!0);return b.prototype.inspector=j,b.prototype["import"]=function(b){a.PackageManager.unloadProjectPlugin(b.meta.uuid),b.meta.enable&&b.asset&&(console.assert(asset.json),a.PackageManager.loadProjectPlugin(b.meta.uuid,b.asset.json,b.path)),JsonMeta.prototype["import"].call(this,b)},b}();var e=require("fire-path");a.TextAssetMeta=function(){var b=a.define("Fire.TextAssetMeta",a.AssetMeta,null);return b.prop("binary",!1),b.prototype.assetType=a.TextAsset,b.prototype.createAsset=function(b,c){d.readFile(b,function(d,f){if(d)return void c(d);var g=new a.TextAsset;g.text=f,g._setRawExtname(e.extname(b)),c(null,g)})},b.prototype["import"]=function(b){var c=this,d=require("async");d.parallel([function(c){a.AssetDB.saveAssetToLibrary(b.meta.uuid,b.asset,c)},function(c){a.AssetDB.copyToLibrary(b.meta.uuid,e.extname(b.path),b.path,c)}],function(a){return a?void c.error(a):void c.done()})},b}(),a.CustomAssetMeta=function(){var b=a.define("Fire.CustomAssetMeta",a.AssetMeta);return b.prop("binary",!1),b.prototype.assetType=a.CustomAsset,b.prototype.createAsset=function(a,b){b()},b.prototype["import"]=function(b){var c=this;a.AssetDB.saveJsonToLibrary(b.meta.uuid,b.path,function(a){return a?void c.error(a):void c.done()})},b.prototype["export"]=function(a,b){this.exportToJson(a,b)},b}();var e=require("fire-path"),k=function(b,c,d,f,g){b.contain(f,f,{r:255,g:255,b:255,a:0},"grid",function(b,f){if(b)return void(g&&g(b));var h=a.AssetDB.mkdirForUuid(c);if(h){var i=e.join(h,c+".thumb"+d);f.writeFile(i,function(a){g&&g(a)})}})};a.TextureType=function(a){return a[a.Texture=0]="Texture",a[a.Sprite=1]="Sprite",a[a.NormalMap=2]="Normal Map",a}({}),a.TextureInspector=function(){var b=a.define("Fire.TextureInspector",a.AssetInspector,null);return b.prop("type",a.TextureType.Texture,a.Enum(a.TextureType)),b.prop("wrapMode",a.Texture.WrapMode.Clamp,a.Enum(a.Texture.WrapMode)),b.prop("filterMode",a.Texture.FilterMode.Bilinear,a.Enum(a.Texture.FilterMode)),b.prototype.init=function(a,b){this.type=b.type,this.wrapMode=b.wrapMode,this.filterMode=b.filterMode},b.prototype.applyMeta=function(a){a.type=this.type,a.wrapMode=this.wrapMode,a.filterMode=this.filterMode},b}(),a.TextureMeta=function(){var b=a.define("Fire.TextureMeta",a.AssetMeta,null);return b.prop("type",a.TextureType.Sprite,a.Enum(a.TextureType)),b.prop("wrapMode",a.Texture.WrapMode.Clamp,a.Enum(a.Texture.WrapMode)),b.prop("filterMode",a.Texture.FilterMode.Bilinear,a.Enum(a.Texture.FilterMode)),b.prototype.inspector=a.TextureInspector,b.prototype.assetType=a.Texture,b.prototype.createAsset=function(b,c){var d=require("lwip");d.open(b,function(d,f){if(d)return void c(d);var g=new a.Texture;g.width=f.width(),g.height=f.height(),g._setRawExtname(e.extname(b)),g.lwipImage=f,c(null,g)})},b.prototype["import"]=function(b){var c=b.meta,d=b.asset,f=e.extname(b.path),g=e.basename(b.path,f);if(d.wrapMode=c.wrapMode,d.filterMode=c.filterMode,c.type===a.TextureType.Sprite){var h=!1;if(c.subRawData&&0!==c.subRawData.length||(c.subRawData=[],h=!0),h){var i=require("node-uuid"),j=new a.Sprite;j.name=g,j.texture=a.serialize.asAsset(c.uuid),j.width=d.width,j.height=d.height,j.rawWidth=d.width,j.rawHeight=d.height;var l=new a.SpriteMeta;l.uuid=i.v4(),l.rawTextureUuid=c.uuid,c.subRawData.push({asset:j,meta:l})}}else c.subRawData&&c.subRawData.length>0&&(c.subRawData=[]);var m=this,n="."+d._rawext,o=require("async");o.series([function(b){a.AssetDB.saveAssetToLibrary(c.uuid,d,b)},function(b){var e=a.AssetDB.uuidToLibraryPath(c.uuid);d.lwipImage.writeFile(e+n,b)},function(a){k(d.lwipImage,c.uuid,n,32,a)}],function(a,b){return a?void m.error(a):void m.done()})},b.prototype["export"]=null,b}();var d=require("fire-fs"),l=function(a,b,c,d){var e=d,f=b,g=c,h=0,i=0,j,k;for(k=0;c>k;k++)for(j=0;b>j;j++)if(a.getPixel(j,k).a>=e){g=k,k=c;break}for(k=c-1;k>=g;k--)for(j=0;b>j;j++)if(a.getPixel(j,k).a>=e){i=k-g+1,k=0;break}for(j=0;b>j;j++)for(k=g;g+i>k;k++)if(a.getPixel(j,k).a>=e){f=j,j=b;break}for(j=b-1;j>=f;j--)for(k=g;g+i>k;k++)if(a.getPixel(j,k).a>=e){h=j-f+1,j=0;break}return[f,g,h,i]};a.TrimType=function(a){return a[a.Auto=0]="Auto",a[a.Custom=1]="Custom",a}({}),a.SpriteInspector=function(){var b=a.define("Fire.SpriteInspector",a.AssetInspector,null);return b.prop("atlasTag","default"),b.prop("trimType",a.TrimType.Auto,a.Enum(a.TrimType)),b.prop("trimThreshold",1,a.Range(0,100)),b.prop("pivot",new a.Vec2(.5,.5),a.Tooltip("The pivot is normalized, like a percentage.\n(0,0) means the bottom-left corner and (1,1) means the top-right corner.\nBut you can use values higher than (1,1) and lower than (0,0) too.")),b.prop("trimX",0,a.Integer),b.prop("trimY",0,a.Integer),b.prop("width",0,a.Integer),b.prop("height",0,a.Integer),b.prototype.init=function(a,b){this.assetDirty=!0,this.pivot=a.pivot.clone(),this.trimX=a.trimX,this.trimY=a.trimY,this.width=a.width,this.height=a.height,this.x=a.x,this.y=a.y,this.rawWidth=a.rawWidth,this.rawHeight=a.rawHeight,this.atlasTag=b.atlasTag,this.trimType=b.trimType,this.trimThreshold=b.trimThreshold},b.prototype.applyAsset=function(a){a.pivot=this.pivot.clone(),a.trimX=Math.clamp(this.trimX,0,a.rawWidth),a.trimY=Math.clamp(this.trimY,0,a.rawHeight),a.width=Math.clamp(this.width,0,a.rawWidth-a.trimX),a.height=Math.clamp(this.height,0,a.rawHeight-a.trimY)},b.prototype.applyMeta=function(a){a.atlasTag=this.atlasTag,a.trimType=this.trimType,a.trimThreshold=this.trimThreshold},b}(),a.SpriteMeta=function(){var b=a.define("Fire.SpriteMeta",a.AssetMeta,null);return b.prop("atlasTag","default"),b.prop("trimType",a.TrimType.Auto,a.Enum(a.TrimType)),b.prop("trimThreshold",1),b.prop("rawTextureUuid","",a.HideInInspector),b.prototype.inspector=a.SpriteInspector,b.prototype.assetType=a.Sprite,b.prototype.createAsset=function(b,c){d.readFile(b,function(b,d){if(b)return void c(b);var e=a.deserialize(d);c(null,e)})},b.prototype["import"]=function(b){var c=this,d=b.meta,e=a.AssetDB.uuidToFspath(d.rawTextureUuid);if(!e)return void c.error(new Error("Can not find raw texture for "+b.path+", uuid not found: "+d.rawTextureUuid));var f=require("async"),g=require("lwip");f.waterfall([function(a){g.open(e,a)},function(c,e){var f=c.width(),g=c.height(),h=b.asset;if(h.rawWidth=f,h.rawHeight=g,a.AssetDB.isValidUuid(h.texture._uuid)||(h.texture=null),h.texture||(h.texture=a.serialize.asAsset(d.rawTextureUuid)),d.trimType===a.TrimType.Auto){var i=l(c,f,g,d.trimThreshold);h.trimX=i[0],h.trimY=i[1],h.width=i[2],h.height=i[3]}h.texture._uuid===d.rawTextureUuid&&(h.x=h.trimX,h.y=h.trimY),e(null,h)},function(b,c){a.AssetDB.saveAssetToLibrary(d.uuid,b,c)}],function(a){return a?void c.error(a):void c.done()})},b.prototype["export"]=function(b,c){var e=a.deserialize(c),f=b.meta;f.rawTextureUuid=e.texture._uuid,d.writeFile(b.path,c,function(a){return a?void this.error(a):void this.done()}.bind(this))},b}();var d=require("fire-fs"),m=require("readline"),n=require("fire-url"),e=require("path"),o=function(a,b){var c=a.asset,e=a.meta;c.charInfos=[],c.kernings=[];var f=d.createReadStream(a.path,{encoding:"utf8"}),g=m.createInterface({input:f,output:process.stdout,terminal:!1});g.on("line",function(d){p(d,c,e,a.path)||b(new Error("Error: Failed to parse at line "+d))}).on("close",function(){b()})},p=function(b,c,f,g){var h={};h.chars={};var i=b.trimLeft(),j=i.split(" ");if("info"===j[0]){var k=q(j,"face");k&&(c.face=k.substring(1,k.length-1));var l=Math.floor(q(j,"size"));l&&(c.size=l)}else if("common"===j[0]){c.lineHeight=Math.floor(q(j,"lineHeight")),c.baseLine=Math.floor(q(j,"base"));var m=Math.floor(q(j,"pages"));if(1!=m)return a.error("Parse Error: only support one page"),!1}else if("page"===j[0]){var n=q(j,"file");if(f.texture)c.texture=f.texture;else{var o=n.substring(1,n.length-1),p=e.join(e.dirname(g),o);if(d.existsSync(p)){var r=a.AssetDB.fspathToUuid(p);c.texture=a.serialize.asAsset(r),f.texture=c.texture}}}else if("char"===j[0]){var s={id:Math.floor(q(j,"id")),y:Math.floor(q(j,"y")),x:Math.floor(q(j,"x")),width:Math.floor(q(j,"width")),height:Math.floor(q(j,"height")),xOffset:Math.floor(q(j,"xoffset")),yOffset:Math.floor(q(j,"yoffset")),xAdvance:Math.floor(q(j,"xadvance")),rotated:!1};c.charInfos.push(s)}else"kerning"===j[0]&&c.kernings.push({first:Math.floor(q(j,"first")),second:Math.floor(q(j,"second")),amount:Math.floor(q(j,"amount"))});return!0},q=function(a,b){for(var c=b.length+1,d=0;d<a.length;++d){var e=a[d];if(e.length>c&&e.substring(0,b.length)===b){var f=e.substring(c);if('"'===f[0]){if('"'===f[f.length-1])return f;for(var g=d+1;g<a.length;++g){var h=a[g];if(f=f+" "+h,'"'===f[f.length-1])return f}}return f}}return""};a.BitmapFontInspector=function(){var b=a.define("Fire.BitmapFontInspector",a.AssetInspector,null);return b.prop("texture",null,a.ObjectType(a.Texture)),b.prop("charInfos",[],a.HideInInspector),b.prop("kernings",[],a.HideInInspector),b.prop("baseLine",0,a.ReadOnly),b.prop("lineHeight",0,a.ReadOnly),b.prop("size",0,a.ReadOnly),b.prop("face",null,a.HideInInspector),b.prototype.init=function(a,b){this.assetDirty=!0,this.texture=a.texture,this.charInfos=a.charInfos,this.kernings=a.kernings,this.baseLine=a.baseLine,this.lineHeight=a.lineHeight,this.size=a.size,this.face=b.face},b.prototype.applyAsset=function(a){a.texture=this.texture,a.charInfos=this.charInfos,a.kernings=this.kernings,a.baseLine=this.baseLine,a.lineHeight=this.lineHeight,a.size=this.size,a.face=this.face},b.prototype.applyMeta=function(a){a.texture=this.texture},b}(),a.BitmapFontMeta=function(){var b=a.define("Fire.BitmapFontMeta",a.AssetMeta);return b.prop("texture",null,a.ObjectType(a.Texture)),b.prototype.inspector=a.BitmapFontInspector,b.prototype.assetType=a.BitmapFont,b.prototype.createAsset=function(b,c){var d=new a.BitmapFont;c(null,d)},b.prototype["import"]=function(b){var c=this,d=require("async");d.waterfall([function(a){o(b,a)},function(c){a.AssetDB.saveAssetToLibrary(b.meta.uuid,b.asset,c)}],function(a){return a?void c.error(a):void c.done()})},b}(),a.AtlasInspector=function(){var b=[{name:"128",value:128},{name:"256",value:256},{name:"512",value:512},{name:"1024",value:1024},{name:"2048",value:2048},{name:"4096",value:4096}],c=a.define("Fire.AtlasInspector",a.AssetInspector,null);return c.prop("width",512,a.EnumList(b)),c.prop("height",512,a.EnumList(b)),c.prop("sprites",[],a.ObjectType(a.Sprite),a.HideInInspector),c.prop("autoSize",!0),c.prop("algorithm",a.Atlas.Algorithm.MaxRect,a.Enum(a.Atlas.Algorithm)),c.prop("sortBy",a.Atlas.SortBy.UseBest,a.Enum(a.Atlas.SortBy)),c.prop("sortOrder",a.Atlas.SortOrder.UseBest,a.Enum(a.Atlas.SortOrder)),c.prop("allowRotate",!0),c.prop("useContourBleed",!0,a.DisplayName("Contour Bleed"),a.Tooltip("reduce border artifacts")),c.prop("usePaddingBleed",!0,a.DisplayName("Padding Bleed"),a.Tooltip("extrude")),c.prop("customPadding",2,a.Integer),c.prop("buildColor",new a.Color(1,1,1,1),a.Nullable("customBuildColor",!1)),c.prototype.init=function(a,b){this.assetDirty=!0,this.width=a.width,this.height=a.height,this.sprites=a.sprites.slice(),this.autoSize=b.autoSize,this.algorithm=b.algorithm,this.sortBy=b.sortBy,this.sortOrder=b.sortOrder,this.allowRotate=b.allowRotate,this.useContourBleed=b.useContourBleed,this.usePaddingBleed=b.usePaddingBleed,this.customPadding=b.customPadding,this.buildColor=b.buildColor},c.prototype.applyAsset=function(a){a.width=this.width,a.height=this.height,a.sprites=this.sprites.slice()},c.prototype.applyMeta=function(a){a.autoSize=this.autoSize,a.algorithm=this.algorithm,a.sortBy=this.sortBy,a.sortOrder=this.sortOrder,a.allowRotate=this.allowRotate,a.useContourBleed=this.useContourBleed,a.usePaddingBleed=this.usePaddingBleed,a.customPadding=this.customPadding,a.buildColor=this.buildColor},c}(),a.AtlasMeta=function(){var b=a.define("Fire.AtlasMeta",a.AssetMeta,null);return b.prototype.inspector=a.AtlasInspector,b.prop("autoSize",!0),b.prop("algorithm",a.Atlas.Algorithm.MaxRect,a.Enum(a.Atlas.Algorithm)),b.prop("sortBy",a.Atlas.SortBy.UseBest,a.Enum(a.Atlas.SortBy)),b.prop("sortOrder",a.Atlas.SortOrder.UseBest,a.Enum(a.Atlas.SortOrder)),b.prop("allowRotate",!0),b.prop("useContourBleed",!0,a.DisplayName("Contour Bleed"),a.Tooltip("reduce border artifacts")),b.prop("usePaddingBleed",!0,a.DisplayName("Padding Bleed"),a.Tooltip("extrude")),b.prop("customPadding",2,a.Integer),b.prop("buildColor",new a.Color(1,1,1,1),a.Nullable("customBuildColor",!1)),b.prototype.createAsset=function(b,c){var e=require("async");e.waterfall([function(a){d.readFile(b,a)},function(b,c){var f=a.deserialize(b);e.each(f.sprites,function(b,c){var e=f.sprites.indexOf(b),g=b._uuid,h=a.AssetDB.uuidToLibraryPath(g);d.readFile(h,function(b,d){if(b)return void c(b);var h=a.deserialize(d);h._uuid=g,f.sprites[e]=h,c()})},function(a){c(a,f)})}],function(a,b){c(a,b)})},b.prototype["import"]=function(b){var c=this,d=b.asset,e=b.meta,f=require("lwip"),g=require("async"),h=require(a.url("editor-core://meta"));g.waterfall([function(a){e.layout(d),a(null)},function(b){g.each(d.sprites,function(b,c){g.waterfall([function(c){var d=h.loadByUuid(b._uuid);if(!d)return void c(new Error("Failed to load sprite meta by uuid "+uuid));var e=a.AssetDB.uuidToFspath(d.rawTextureUuid);c(null,e,b)},function(a,b,c){f.open(a,function(a,d){c(a,d,b)})},function(a,b,c){a.crop(b.trimX,b.trimY,b.trimX+b.width-1,b.trimY+b.height-1,function(a,d){c(a,d,b)})},function(a,b,c){return b.rotated?void a.rotate(90,function(a,d){c(a,d,b)}):void c(null,a,b)},function(a,b,c){b.lwipImage=a,c(null)}],function(a){c(a)})},function(a){b(null)})},function(a){var b={r:0,g:0,b:0,a:0};d.customBuildColor&&(b={r:d.buildColor.r,g:d.buildColor.g,b:d.buildColor.b,a:d.buildColor.a/255*100}),f.create(d.width,d.height,b,function(b,c){a(b,c)})},function(b,c){g.eachSeries(d.sprites,function(c,d){try{b.paste(c.x,c.y,c.lwipImage,d)}catch(e){a.warn("Failed to paste sprite %s, message: %s",c.name,e.message),d()}},function(a){c(a,b)})},function(b,c){var f=null,g=null;if(e.subRawData)f=e.subRawData[0].asset,g=e.subRawData[0].meta;else{var h=require("node-uuid");e.subRawData=[],f=new a.Texture,g=new a.TextureMeta,g.uuid=h.v4(),e.subRawData.push({asset:f,meta:g})}f.name=d.name,f.width=b.width(),f.height=b.height(),f._setRawExtname(".png"),f.lwipImage=b,g.type=a.TextureType.Texture,g.wrapMode=a.Texture.WrapMode.Clamp,g.filterMode=a.Texture.FilterMode.Bilinear,c(null,g.uuid)},function(b,c){g.each(d.sprites,function(c,d){c.texture=a.serialize.asAsset(b);var e=a.AssetDB.uuidToUrl(c._uuid);a.AssetDB.saveAsset(e,a.serialize(c),null).on("end",function(b,c){for(var e=0;e<c.length;++e){var f=c[e];a.sendToAll("asset:saved",f.url,f.uuid)}d()})},function(a){c(a)})},function(b){a.AssetDB.saveAssetToLibrary(e.uuid,d,b)}],function(a){return a?void c.error(a):void c.done()})},b.prototype["export"]=function(b,c){var e=a.deserialize(c);d.writeFile(b.path,c,function(a){return a?void this.error(a):void this.done()}.bind(this))},b.prototype.layout=function(a){a.layout({algorithm:this.algorithm,sortBy:this.sortBy,sortOrder:this.sortOrder,allowRotate:this.allowRotate,autoSize:this.autoSize,padding:this.customPadding})},b}()}(Fire),"undefined"!=typeof module&&module?module.exports=Fire:"function"==typeof define&&define&&define.amd&&define([],function(){return Fire});