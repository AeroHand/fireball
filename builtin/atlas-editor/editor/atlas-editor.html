<html><head></head><body><polymer-element name="atlas-editor" constructor="AtlasEditor" on-drop-area-enter="{{dropAreaEnterAction}}" on-drop-area-leave="{{dropAreaLeaveAction}}" on-drop-area-accept="{{dropAreaAcceptAction}}" assetpath=""><template><style>:host{position:absolute;top:0;right:0;bottom:0;left:0;display:flex;flex-direction:row;flex-wrap:nowrap;align-items:stretch;margin-top:3px;margin-left:3px;margin-bottom:3px}span.space{width:5px}#view{position:relative;border:1px solid #222;box-shadow:inset 0 0 8px 2px rgba(0,0,0,0.2);background-color:#333;overflow:hidden}#canvas{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background-image:url("img/checkerboard-32x32.png");background-size:32px 32px;box-shadow:0 0 15px 2px rgba(0,0,0,0.3);border:1px solid #222;}#canvas.active{border:1px solid #09f}.right-panel{width:320px;position:relative;display:flex;flex-direction:column;flex-wrap:nowrap;align-items:stretch}.tool-box{background:#333;padding:3px 5px}.settings{padding-right:5px}.sprite-list{margin-left:5px;margin-right:5px;overflow:auto;background:#333}.sprite-list-item{padding:3px 5px;margin-bottom:1px;font-size:12px;color:#bdbdbd;background-color:#222;white-space:nowrap;text-overflow:ellipsis}</style><div id="view" flex-1=""><canvas id="canvas" class="{{highlighted ? 'active' : ''}}"></canvas></div><div class="right-panel"><div flex-row="" class="tool-box"><fire-ui-slider value="{{zoom}}" flex-1=""></fire-ui-slider><span class="space"></span><fire-ui-button on-click="{{resetCamera}}"><i class="fa fa-refresh"></i></fire-ui-button></div><div class="settings"><fire-ui-prop name="Element Background" value="{{elementBG}}"></fire-ui-prop><fire-ui-prop name="Element Select" value="{{elementSel}}"></fire-ui-prop><fire-ui-custom-prop name="Custom Background"><fire-ui-checkbox value="{{customBG}}"></fire-ui-checkbox><span class="space"></span><fire-ui-color flex-1="" value="{{atlasBG}}" disabled="{{!customBG}}"></fire-ui-color></fire-ui-custom-prop><fire-ui-prop name="Show Checkerboard" value="{{showCheckerboard}}"></fire-ui-prop></div><div class="sprite-list" flex-1=""><template repeat="{{sprite in asset.sprites}}"><div class="sprite-list-item">
                    {{sprite.name}}
                </div></template></div></div></template><script>!function(){Polymer("atlas-editor",EditorUI.mixin({elementBG:null,elementSel:null,customBG:!1,atlasBG:null,showCheckerboard:!0,zoom:1,highlighted:!1,url:"",uuid:"",asset:null,meta:null,publish:{droppable:"asset"},created:function(){this.ipc=new Fire.IpcListener,this.elementBG=new Fire.Color(.1,.38,1,.5),this.elementSel=new Fire.Color(0,0,0,1),this.atlasBG=new Fire.Color(1,0,1,1)},attached:function(){this.ipc.on("asset:changed",function(a){this.uuid===a&&Fire.AssetLibrary.loadAsset(this.uuid,function(a){this.asset=a,this.resize(),this.repaint()}.bind(this))}.bind(this)),this.ipc.on("asset:edit",function(a){this.load(a)}.bind(this))},detached:function(){this.ipc.clear()},ready:function(){for(var a="",b=decodeURIComponent(location.search.substr(1)),c=b.split("&"),d=0;d<c.length;++d){var e=c[d].split("=");"url"===e[0]&&(a=e[1])}Fire.AssetLibrary.init("library://"),this._initDroppable(this.$.view),this.load(a)},load:function(a){this.url=a,this.uuid=Fire.AssetDB.urlToUuid(a);var b=Fire.AssetDB.loadMetaJson(this.uuid);Fire.AssetLibrary.loadMeta(b,function(a){this.meta=a,Fire.AssetLibrary.loadAsset(this.uuid,function(a){this.asset=a,this.resize(),this.repaint()}.bind(this))}.bind(this))},layoutAtlas:function(){this.meta.layout(this.asset),this.resize(),this.repaint()},importSprite:function(a){if(this.asset.add(a)===!1)return void Fire.warn(a.name+" already exists in atlas.");if(this.meta.trim){var b=Fire.getTrimRect(a.texture.image,this.meta.trimThreshold);a.trimX=b.x,a.trimY=b.y,a.width=b.width,a.height=b.height}},resize:function(){this.$.canvas.width=this.asset.width,this.$.canvas.height=this.asset.height},repaint:function(){var a=this.$.canvas.getContext("2d");a.imageSmoothingEnabled=!1,a.clearRect(0,0,this.$.canvas.width,this.$.canvas.height),a.fillStyle=this.elementBG.toCSS("rgba"),this.asset.sprites.forEach(function(b){a.fillRect(b.x,b.y,b.rotatedWidth,b.rotatedHeight),b.rotated?(a.save(),a.translate(b.x,b.y),a.rotate(.5*Math.PI),a.drawImage(b.texture.image,b.trimX,b.trimY,b.width,b.height,0,-b.height,b.width,b.height),a.restore()):a.drawImage(b.texture.image,b.trimX,b.trimY,b.width,b.height,b.x,b.y,b.width,b.height)})},elementBGChanged:function(){this.repaint()},atlasBGChanged:function(){this.repaint()},dropAreaEnterAction:function(a){a.stopPropagation(),this.highlighted=!0},dropAreaLeaveAction:function(a){a.stopPropagation(),this.highlighted=!1},dropAreaAcceptAction:function(a){a.stopPropagation(),this.highlighted=!1;for(var b=this,c=a.detail.dragItems,d=c.length,e=function(){--d,0===d&&b.layoutAtlas()},f=function(a){if(a instanceof Fire.Texture){var c=Fire.AssetDB.loadMetaJson(a._uuid);return void Fire.AssetLibrary.loadMeta(c,function(a){a.type===Fire.TextureType.Sprite&&a.subAssets.forEach(function(a){b.importSprite(a.asset)}),e()})}return a instanceof Fire.Sprite?(b.importSprite(a),void e()):(Fire.warn("Can not accept asset "+a.name),void e())},g=0;g<c.length;++g){var h=c[g];Fire.AssetLibrary.loadAsset(h,f)}}},EditorUI.droppable))}();</script></polymer-element></body></html>