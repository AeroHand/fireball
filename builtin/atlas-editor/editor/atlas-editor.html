<html><head></head><body><polymer-element name="atlas-editor" constructor="AtlasEditor" on-drop-area-enter="{{dropAreaEnterAction}}" on-drop-area-leave="{{dropAreaLeaveAction}}" on-drop-area-accept="{{dropAreaAcceptAction}}" assetpath=""><template><style>:host{position:absolute;top:0;right:0;bottom:0;left:0;display:flex;flex-direction:row;flex-wrap:nowrap;align-items:stretch;margin-top:3px;margin-left:3px;margin-bottom:3px}span.space{width:5px}#view{position:relative;border:1px solid #222;box-shadow:inset 0 0 8px 2px rgba(0,0,0,0.2);background-color:#333;overflow:hidden}#canvas{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);background-image:url("img/checkerboard-32x32.png");background-size:32px 32px;box-shadow:0 0 15px 2px rgba(0,0,0,0.3);border:1px solid #222;}#canvas.active{border:1px solid #09f}.right-panel{width:320px;position:relative;display:flex;flex-direction:column;flex-wrap:nowrap;align-items:stretch}.tool-box{background:#333;padding:3px 5px}.settings{padding-right:5px}.sprite-list{margin-left:5px;margin-right:5px;overflow:auto;background:#333}.sprite-list-item{padding:3px 5px;margin-bottom:1px;font-size:12px;color:#bdbdbd;background-color:#222;white-space:nowrap;text-overflow:ellipsis}.buttons{margin-top:5px;margin-right:5px}</style><div id="view" flex-1=""><canvas id="canvas" class="{{highlighted ? 'active' : ''}}"></canvas></div><div class="right-panel"><div flex-row="" class="tool-box"><fire-ui-slider value="{{zoom}}" flex-1=""></fire-ui-slider><span class="space"></span><fire-ui-button on-click="{{resetCamera}}"><i class="fa fa-refresh"></i></fire-ui-button></div><div class="settings"><fire-ui-prop name="Element Background" value="{{elementBG}}"></fire-ui-prop><fire-ui-prop name="Element Select" value="{{elementSel}}"></fire-ui-prop><fire-ui-custom-prop name="Custom Background"><fire-ui-checkbox value="{{customBG}}"></fire-ui-checkbox><span class="space"></span><fire-ui-color flex-1="" value="{{atlasBG}}" disabled="{{!customBG}}"></fire-ui-color></fire-ui-custom-prop><fire-ui-prop name="Show Checkerboard" value="{{showCheckerboard}}"></fire-ui-prop></div><div class="sprite-list" flex-1=""><template repeat="{{sprite, index in asset.sprites}}"><div class="sprite-list-item">
                    [{{index}}] {{sprite.name}}
                </div></template></div><div class="buttons" flex-row=""><span flex-1=""></span><fire-ui-button on-click="{{applyAction}}">Apply</fire-ui-button></div></div></template><script>!function(){var a=require("async");Polymer("atlas-editor",EditorUI.mixin({elementBG:null,elementSel:null,customBG:!1,atlasBG:null,showCheckerboard:!0,zoom:1,highlighted:!1,url:"",uuid:"",asset:null,meta:null,publish:{droppable:"asset"},created:function(){this.ipc=new Fire.IpcListener,this.elementBG=new Fire.Color(.1,.38,1,.5),this.elementSel=new Fire.Color(0,0,0,1),this.atlasBG=new Fire.Color(1,0,1,1)},attached:function(){this.ipc.on("asset:changed",function(a){this.uuid===a&&this.load(a)}.bind(this)),this.ipc.on("asset:edit",function(a){this.load(a)}.bind(this)),this.ipc.on("inspector:dirty",function(b,c){if(this.uuid===b){var d=this;Fire.AssetLibrary.loadJson(c,"",function(b,c){c.applyMeta(d.meta),c.applyAsset(d.asset),a.each(d.asset.sprites,d.loadRawTextureFromSprite,function(a){return a?void Fire.error(a.message):void d.layoutAtlas()})})}}.bind(this))},detached:function(){this.ipc.clear()},ready:function(){for(var a="",b=decodeURIComponent(location.search.substr(1)),c=b.split("&"),d=0;d<c.length;++d){var e=c[d].split("=");"uuid"===e[0]&&(a=e[1])}Fire.AssetLibrary.init("library://"),this._initDroppable(this.$.view),this.load(a)},loadRawTextureFromSprite:function(a,b){var c=Fire.AssetDB.loadMetaJson(a._uuid),d=JSON.parse(c);Fire.AssetLibrary.loadAsset(d.rawTextureUuid,function(c,d){a.rawTexture=d,b()})},load:function(b){this.uuid=b,this.url=Fire.AssetDB.uuidToUrl(b);var c=Fire.AssetDB.loadMetaJson(this.uuid),d=this;a.waterfall([function(a){Fire.AssetLibrary.loadMeta(c,function(b,c){d.meta=c,a()})},function(a){Fire.AssetLibrary.loadAsset(d.uuid,function(b,c){d.asset=c,a()})},function(b){a.each(d.asset.sprites,d.loadRawTextureFromSprite,function(a){b(a)})}],function(a){d.resize(),d.repaint()})},layoutAtlas:function(){this.meta.layout(this.asset),this.resize(),this.repaint()},resize:function(){this.$.canvas.width=this.asset.width,this.$.canvas.height=this.asset.height},repaint:function(){var a=this.$.canvas.getContext("2d");a.imageSmoothingEnabled=!1,a.clearRect(0,0,this.$.canvas.width,this.$.canvas.height),a.fillStyle=this.elementBG.toCSS("rgba");for(var b=0;b<this.asset.sprites.length;++b){var c=this.asset.sprites[b];a.fillRect(c.x,c.y,c.rotatedWidth,c.rotatedHeight),c.rotated?(a.save(),a.translate(c.x,c.y),a.rotate(.5*Math.PI),a.drawImage(c.rawTexture.image,c.trimX,c.trimY,c.width,c.height,0,-c.height,c.width,c.height),a.restore()):a.drawImage(c.rawTexture.image,c.trimX,c.trimY,c.width,c.height,c.x,c.y,c.width,c.height)}},elementBGChanged:function(){this.repaint()},atlasBGChanged:function(){this.repaint()},applyAction:function(a){a.stopPropagation();var b=new this.meta.inspector;b.init(this.asset,this.meta),Fire.sendToCore("asset-db:apply",Fire.serialize(this.asset),Fire.serializeMeta(this.meta),Fire.serialize(b))},dropAreaEnterAction:function(a){a.stopPropagation(),this.highlighted=!0},dropAreaLeaveAction:function(a){a.stopPropagation(),this.highlighted=!1},dropAreaAcceptAction:function(b){b.stopPropagation(),this.highlighted=!1;var c=this,d=[];a.each(b.detail.dragItems,function(a,b){Fire.AssetLibrary.loadAsset(a,function(a,c){if(c instanceof Fire.Texture){var e=Fire.AssetDB.loadMetaJson(c._uuid);return void Fire.AssetLibrary.loadMeta(e,function(a,c){if(c.type===Fire.TextureType.Sprite)for(var e=0;e<c.subRawData.length;++e){var f=c.subRawData[e];d.push(f.asset)}b()})}return c instanceof Fire.Sprite?(d.push(c),void b()):(Fire.warn("Can not accept asset "+c.name),void b())})},function(b){return b?void Fire.error(b.message):void a.each(d,function(a,b){return c.asset.add(a)===!1?(Fire.warn(a.name+" already exists in atlas."),void b()):void c.loadRawTextureFromSprite(a,b)},function(a){c.layoutAtlas()})})}},EditorUI.droppable))}();</script></polymer-element></body></html>