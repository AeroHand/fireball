<html><head><style>html /deep/ hierarchy-tree[focused] hierarchy-item[selected]::shadow #bar { background: #059;}html /deep/ hierarchy-item>hierarchy-item { margin-left: 12px;}html /deep/ hierarchy-item::shadow fire-ui-text-input { position: absolute; left: 9px; top: -1px; height: 18px; width: calc(100% - 9px);}html /deep/ hierarchy-item::shadow fire-ui-text-input[icon] { left: 27px; width: calc(100% - 27px);}html /deep/ hierarchy-item::shadow fire-ui-text-input::shadow .input-area { padding: 0px 1px;}</style></head><body><div hidden=""><polymer-element name="hierarchy-item" extends="fire-ui-ti" constructor="HierarchyItem" draggable="true" assetpath=""><template><style>:host([hover]) #bar { background-color: #333;}:host([conflicted]) #bar { background-color: #900;}:host([highlighted]) #header { background-color: #c7722c;}:host([invalid]) #header { background-color: #f00;}:host { display: block; font-size: 12px; margin-left: 0px;}:host([folded]) #content { display: none;}#header { position: relative; padding-bottom: 1px;}#bar { position: absolute; left: 0; right: 0; height: 16px;}:host([selected]) #bar { background-color: #555;}.inline-block-wrapper { display: inline-block;}.flex-wrapper { display: flex; flex-direction: row; flex-wrap: nowrap; align-items: flex-end; white-space: nowrap; height: 16px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #aaa; cursor: default;}#foldIcon { font-size: 14px; width: 10px; margin-right: 2px; visibility: hidden; cursor: pointer; text-align: center;}:host([foldable]) #foldIcon { visibility: visible;}#typeIcon { font-size: 16px; width: 16px; height: 16px; margin-right: 2px;}#typeIcon[hidden] { display: none;}#typeIcon img { width: 16px; height: 16px;}#name.no-name { color: #6e6e6e;}#content { display: block;}</style><div id="bar" on-mouseenter="{{mouseenterAction}}" on-mouseleave="{{mouseleaveAction}}"></div><div id="header" on-mouseenter="{{mouseenterAction}}" on-mouseleave="{{mouseleaveAction}}"><div class="inline-block-wrapper"><div class="flex-wrapper"><i id="foldIcon" class="fa {{folded ? 'fa-caret-right' : 'fa-caret-down'}}" on-click="{{foldAction}}" on-dblclick="{{dblclickAction}}" on-mousedown="{{mousedownAction}}"></i><i id="typeIcon" hidden=""></i><span id="name" class="{{name === '' ? 'no-name' : ''}}">{{name === '' ? 'No Name' : name}}</span></div></div></div><div id="content"><content></content></div></template><script>(function(){Polymer("hierarchy-item",{publish:{selected:{value:false,reflect:true},conflicted:{value:false,reflect:true},highlighted:{value:false,reflect:true},invalid:{value:false,reflect:true},hover:{value:false,reflect:true}},created:function(){this.super();this._isToggle=false;this._isShift=false;this.renaming=false},mouseenterAction:function(event){Editor.Selection.hoverEntity(this.userId);event.stopPropagation()},mouseleaveAction:function(event){Editor.Selection.hoverEntity(null);event.stopPropagation()}})})();</script></polymer-element><polymer-element name="hierarchy-tree" extends="fire-ui-tree" constructor="HierarchyTree" on-open="{{openAction}}" on-contextmenu="{{contextmenuAction}}" on-dragstart="{{dragstartAction}}" on-dragend="{{dragendAction}}" on-dragover="{{dragoverAction}}" on-drop="{{dropAction}}" assetpath=""><template><style>:host { box-shadow: none; background: none; border: none;}:host::shadow .highlight { display: none; position: absolute; border: 1px solid #c7722c; box-sizing: border-box; pointer-events: none;}:host::shadow .insert { display: none; position: absolute; border: 1px solid #0f0; box-sizing: border-box; pointer-events: none;}</style><shadow></shadow></template><script>(function(){Polymer("hierarchy-tree",{created:function(){this.super();this.dragenterCnt=0;this.curDragoverEL=null;this.lastDragoverEL=null;hierarchy=this},ready:function(){this.super();this.addEventListener("dragenter",function(event){++this.dragenterCnt},true);this.addEventListener("dragleave",function(event){--this.dragenterCnt;if(this.dragenterCnt===0){this.resetDragState()}},true);this.refresh()},getContextMenuTemplate:function(){var template=[{label:"Duplicate",message:"hierarchy-menu:duplicate"},{type:"separator"},{label:"Rename",message:"hierarchy-menu:rename"},{label:"Delete",message:"hierarchy-menu:delete"},{type:"separator"}];var createMenu=Editor.plugins.hierarchy.getMenuTemplate("hierarchy-menu");template=template.concat(createMenu);return template},newItem:function(name,id,parentEL){var newEL=new HierarchyItem;this.initItem(newEL,name,id,parentEL);return newEL},setItemIndex:function(id,nextIdInGame){var el=this.idToItem[id];if(!el){return}if(nextIdInGame){var next=this.idToItem[nextIdInGame];if(!next){return}el.parentElement.insertBefore(el,next)}else{el.parentElement.appendChild(el)}},refresh:function(){this.clear();if(!Fire.Engine._scene){return}var selection=Editor.Selection.entities;function createItem(entity,parentEL){var el=Editor.plugins.hierarchy.newEntity(entity.name,entity._objFlags,entity.id,parentEL);if(el){var children=entity._children;for(var i=0,len=children.length;i<len;i++){createItem(children[i],el)}el.selected=selection.indexOf(el.userId)!==-1}}var entities=Fire.Engine._scene.entities;for(var i=0,len=entities.length;i<len;i++){createItem(entities[i])}},highlightBorder:function(item){if(item&&item instanceof HierarchyItem){var style=this.$.highlightBorder.style;style.display="block";style.left=item.offsetLeft-2+"px";style.top=item.offsetTop-1+"px";style.width=item.offsetWidth+4+"px";style.height=item.offsetHeight+3+"px"}else{this.$.highlightBorder.style.display="none"}},highlightInsert:function(item,position){if(item){var style=this.$.insertLine.style;if(position==="inside"){if(!item.folded&&item.firstElementChild){style.display="block";style.top=item.firstElementChild.offsetTop-1+"px";style.left=item.firstElementChild.offsetLeft-2+"px";style.width=item.firstElementChild.offsetWidth+4+"px";style.height="0px"}else{style.display="none"}}else{style.display="block";style.left=item.offsetLeft-2+"px";style.width=item.offsetWidth+4+"px";if(position==="before")style.top=item.offsetTop+"px";else if(position==="after")style.top=item.offsetTop+item.offsetHeight+"px";style.height="0px"}}},cancelHighligting:function(){this.$.highlightBorder.style.display="none";this.$.insertLine.style.display="none"},resetDragState:function(){this.cancelHighligting();this.curDragoverEL=null;this.lastDragoverEL=null;this.dragenterCnt=0},moveEntities:function(targetEL,entities,nextSiblingId){Editor.sendToMainWindow("engine:move-entities",{"entity-id-list":entities,"parent-id":targetEL?targetEL.userId:null,"next-sibling-id":nextSiblingId})},createEntityFromContextSelect:function(){var contextSelection=Editor.Selection.contextEntities;if(contextSelection.length>0){var targetEL=this.idToItem[contextSelection[0]];var parentEL=targetEL.parentElement;if(parentEL&&parentEL instanceof HierarchyItem){Editor.sendToMainWindow("engine:create-entity",{"parent-id":parentEL.userId})}else{Editor.sendToMainWindow("engine:create-entity")}}else{Editor.sendToMainWindow("engine:create-entity")}},createChildEntityFromContextSelect:function(){var contextSelection=Editor.Selection.contextEntities;if(contextSelection.length>0){var targetEL=this.idToItem[contextSelection[0]];Editor.sendToMainWindow("engine:create-entity",{"parent-id":targetEL.userId})}else{var activeId=Editor.Selection.activeEntityId;Editor.sendToMainWindow("engine:create-entity",{"parent-id":activeId})}},renameEntityFromContextSelect:function(){var contextSelection=Editor.Selection.contextEntities;if(contextSelection.length>0){var targetEL=this.idToItem[contextSelection[0]];this.rename(targetEL)}},deleteEntityFromContextSelect:function(){var contextSelection=Editor.Selection.contextEntities;Editor.sendToMainWindow("engine:delete-entities",{"entity-id-list":contextSelection})},duplicateEntityFromContextSelect:function(){var contextSelection=Editor.Selection.contextEntities;var entities=this.getToplevelElements(contextSelection).map(function(element){return element&&element.userId});Editor.sendToMainWindow("engine:duplicate-entities",{"entity-id-list":entities})},deleteSelection:function(){Editor.sendToMainWindow("engine:delete-entities",{"entity-id-list":Editor.Selection.entities})},duplicateSelection:function(){var entities=this.getToplevelElements(Editor.Selection.entities).map(function(element){return element&&element.userId});Editor.sendToMainWindow("engine:duplicate-entities",{"entity-id-list":entities})},select:function(element){Editor.Selection.selectEntity(element.userId,true,true)},clearSelect:function(){Editor.Selection.clearEntity();this.activeElement=null;this.shiftStartElement=null},selectingAction:function(event){event.stopPropagation();this.focus();var shiftStartEL=this.shiftStartElement;this.shiftStartElement=null;if(event.detail.shift){if(shiftStartEL===null){shiftStartEL=this.activeElement}this.shiftStartElement=shiftStartEL;var el=this.shiftStartElement;var userIds=[];if(shiftStartEL!==event.target){if(this.shiftStartElement.offsetTop<event.target.offsetTop){while(el!==event.target){userIds.push(el.userId);el=this.nextItem(el)}}else{while(el!==event.target){userIds.push(el.userId);el=this.prevItem(el)}}}userIds.push(event.target.userId);Editor.Selection.selectEntity(userIds,true,false)}else if(event.detail.toggle){if(event.target.selected){Editor.Selection.unselectEntity(event.target.userId,false)}else{Editor.Selection.selectEntity(event.target.userId,false,false)}}else{if(!event.target.selected){Editor.Selection.selectEntity(event.target.userId,true,false)}}},selectAction:function(event){event.stopPropagation();if(event.detail.shift){Editor.Selection.confirm()}else if(event.detail.toggle){Editor.Selection.confirm()}else{Editor.Selection.selectEntity(event.target.userId,true)}},renameConfirmAction:function(event){event.stopPropagation();var renamingEL=this.$.nameInput.renamingEL;this.$.nameInput.style.display="none";this.$.content.appendChild(this.$.nameInput);this.$.nameInput.renamingEL=null;window.requestAnimationFrame(function(){this.focus()}.bind(this));renamingEL._renaming=false;Editor.sendToMainWindow("engine:rename-entity",{id:renamingEL.userId,name:event.target.value})},openAction:function(event){if(event.target instanceof HierarchyItem){}event.stopPropagation()},contextmenuAction:function(event){event.preventDefault();event.stopPropagation();var Remote=require("remote");Remote.getCurrentWindow().focus();this.resetDragState();var curContextID=null;if(event.target instanceof HierarchyItem){curContextID=event.target.userId}Editor.Selection.setContextEntity(curContextID);Editor.popupMenu(this.getContextMenuTemplate())},keydownAction:function(event){this.super([event]);if(event.cancelBubble){return}switch(event.which){case 46:this.deleteSelection();event.stopPropagation();break;case 8:if(event.metaKey){this.deleteSelection()}event.stopPropagation();break}},dragstartAction:function(event){event.stopPropagation();EditorUI.DragDrop.start(event.dataTransfer,"move","entity",Editor.Selection.entities.map(function(item){var ent=Editor.getInstanceById(item);return{name:ent.name,id:item}}))},dragendAction:function(event){EditorUI.DragDrop.end();this.resetDragState();Editor.Selection.cancel()},dragoverAction:function(event){var dragType=EditorUI.DragDrop.type(event.dataTransfer);if(dragType!=="entity"&&dragType!=="asset"){EditorUI.DragDrop.allowDrop(event.dataTransfer,false);return}event.preventDefault();event.stopPropagation();if(event.target){this.lastDragoverEL=this.curDragoverEL;var position;var bounding=this.getBoundingClientRect();var offsetY=event.clientY-bounding.top+this.scrollTop;var target=event.target;if(target!==this.lastDragoverEL){if(target===this){if(offsetY<=this.firstElementChild.offsetTop){target=this.firstElementChild}else{target=this.lastElementChild}}this.curDragoverEL=target}if(offsetY<=target.offsetTop+target.offsetHeight*.3)position="before";else if(offsetY>=target.offsetTop+target.offsetHeight*.7)position="after";else position="inside";if(position==="inside"){this.highlightBorder(target)}else{this.highlightBorder(target.parentElement)}this.highlightInsert(target,position);EditorUI.DragDrop.allowDrop(event.dataTransfer,true)}var dropEffect="none";if(dragType==="asset"){dropEffect="copy"}else if(dragType==="entity"){dropEffect="move"}EditorUI.DragDrop.updateDropEffect(event.dataTransfer,dropEffect)},dropAction:function(event){var dragType=EditorUI.DragDrop.type(event.dataTransfer);if(dragType!=="asset"&&dragType!=="entity")return;event.preventDefault();event.stopPropagation();var items=EditorUI.DragDrop.drop(event.dataTransfer);this.resetDragState();Editor.Selection.cancel();if(items.length>0){var hoverTarget=event.target;var targetEL=null;var nextSiblingId=null;var bounding=this.getBoundingClientRect();var offsetY=event.clientY-bounding.top+this.scrollTop;if(hoverTarget===this){targetEL=null;if(this.firstElementChild){if(offsetY<=this.firstElementChild.offsetTop){nextSiblingId=this.firstElementChild.userId}}}else{if(offsetY<=hoverTarget.offsetTop+hoverTarget.offsetHeight*.3){nextSiblingId=hoverTarget.userId;targetEL=hoverTarget.parentElement}else if(offsetY>=hoverTarget.offsetTop+hoverTarget.offsetHeight*.7){if(hoverTarget.nextElementSibling){nextSiblingId=hoverTarget.nextElementSibling.userId}else{nextSiblingId=null}targetEL=hoverTarget.parentElement}else{nextSiblingId=null;targetEL=hoverTarget;if(targetEL.firstElementChild){nextSiblingId=targetEL.firstElementChild.userId}}}if(targetEL===this){targetEL=null}if(dragType==="entity"){this.moveEntities(targetEL,items,nextSiblingId)}else if(dragType==="asset"){var parentEnt=null;if(targetEL)parentEnt=Editor.getInstanceById(targetEL.userId);Editor.Selection.clearEntity();var onload=function(err,asset){if(asset&&asset.createEntity){asset.createEntity(function(ent){ent.parent=parentEnt;ent.transform.position=new Fire.Vec2(0,0);Editor.Selection.selectEntity(ent.id,false,true);Editor.sendToMainWindow("entity:added",ent.id);Editor.sendToWindows("scene:dirty");Fire.AssetLibrary.cacheAsset(asset)}.bind(this))}}.bind(this);for(var i=0;i<items.length;++i){Fire.AssetLibrary.loadAssetInEditor(items[i],onload)}}}}})})();</script></polymer-element></div><polymer-element name="fire-hierarchy" constructor="FireHierarchy" assetpath=""><template><style>:host { display: flex; flex-direction: column; flex-wrap: nowrap; align-items: stretch; font-size: 12px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; color: #aaa; cursor: default; outline: none;}</style><fire-ui-toolbar><i id="addIcon" on-click="{{createAction}}" class="fa fa-plus"></i><fire-ui-text-input flex-1="" placeholder="Search..."></fire-ui-text-input></fire-ui-toolbar><hierarchy-tree id="hierarchyTree" flex-1=""></hierarchy-tree></template><script>(function(){function createEntityFromSnapshot(tree,selection,entityData,parentEL){if(!(entityData.objFlags&Fire._ObjectFlags.HideInEditor)){var el=tree.newItem(entityData.name,entityData.id,parentEL);if(selection){el.selected=selection.indexOf(el.userId)!==-1}var children=entityData.children;for(var i=0,len=children.length;i<len;i++){createEntityFromSnapshot(tree,selection,children[i],el)}}}Polymer("fire-hierarchy",{created:function(){this.icon=new Image;this.icon.src="fire://static/img/plugin-hierarchy.png"},attached:function(){Editor.mainWindow.$.hierarchy=this},detached:function(){Editor.mainWindow.$.hierarchy=null},"scene:launched":function(event){this.reload(event.detail)},"entity:created":function(event){createEntityFromSnapshot(this.$.hierarchyTree,null,event.detail)},"entity:removed":function(event){var entityId=event.detail["entity-id"];this.$.hierarchyTree.deleteItemById(entityId)},"entity:renamed":function(event){var entityId=event.detail["entity-id"];var newName=event.detail.name;this.$.hierarchyTree.renameItemById(entityId,newName)},"entity:parent-changed":function(event){var entityId=event.detail["entity-id"];var parentId=event.detail["parent-id"];this.$.hierarchyTree.setItemParentById(entityId,parentId)},"entity:index-changed":function(event){var entityId=event.detail["entity-id"];var nextSiblingId=event.detail["next-sibliing-id"];this.$.hierarchyTree.setItemIndex(entityId,nextSiblingId)},"entity:hint":function(event){var entityId=event.detail["entity-id"];this.hint(entityId)},"hierarchy-menu:create-entity":function(event){this.$.hierarchyTree.createEntityFromContextSelect()},"hierarchy-menu:create-child-entity":function(event){this.$.hierarchyTree.createChildEntityFromContextSelect()},"hierarchy-menu:rename":function(event){this.$.hierarchyTree.renameEntityFromContextSelect()},"hierarchy-menu:delete":function(event){this.$.hierarchyTree.deleteEntityFromContextSelect()},"hierarchy-menu:duplicate":function(){this.$.hierarchyTree.duplicateEntityFromContextSelect()},"selection:entity:selected":function(event){this.select(event.detail["id-list"],true)},"selection:entity:unselected":function(event){this.select(event.detail["id-list"],false)},"selection:entity:activated":function(event){this.active(event.detail.id,true)},"selection:entity:deactivated":function(event){this.active(event.detail.id,false)},"selection:entity:hover":function(event){this.hover(event.detail.id)},"selection:entity:hoverout":function(event){this.hoverout(event.detail.id)},select:function(entityIds,selected){for(var i=0;i<entityIds.length;++i){var id=entityIds[i];var el=this.$.hierarchyTree.idToItem[id];if(el){el.selected=selected}}},active:function(id,activated){if(activated){var el=this.$.hierarchyTree.idToItem[id];this.$.hierarchyTree.active(el)}else{this.$.hierarchyTree.active(null)}},hover:function(entityId){var el=this.$.hierarchyTree.idToItem[entityId];if(el){el.hover=true}},hoverout:function(entityId){var el=this.$.hierarchyTree.idToItem[entityId];if(el){el.hover=false}},hint:function(entityId){this.$.hierarchyTree.hintItem(entityId)},createAction:function(){var rect=this.$.addIcon.getBoundingClientRect();Editor.popupMenu(Editor.plugins.hierarchy.getMenuTemplate("main-menu"),Math.floor(rect.left+5),Math.floor(rect.bottom+10))},reload:function(sceneSnapshot){var tree=this.$.hierarchyTree;tree.clear();var selection=Editor.Selection.entities;var entityDatas=sceneSnapshot.entities;for(var i=0,len=entityDatas.length;i<len;i++){createEntityFromSnapshot(tree,selection,entityDatas[i])}}})})();</script></polymer-element></body></html>