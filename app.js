function _initFire(){Fire=require("./src/core/core"),Fire.JS.mixin(Fire,require("./src/editor-share/editor-share")),Fire.JS.mixin(Fire,{log:Editor.log,success:Editor.success,failed:Editor.failed,info:Editor.info,warn:Editor.warn,error:Editor.error,fatal:Editor.fatal}),Fire.JS.mixin(Editor,Fire.Editor)}function _initLoginIpc(){Ipc.on("login:query-info",function(e){var r=Editor.loadProfile("fireball","global"),i=r["last-login"],o=r["remember-passwd"],t=r["login-type"];o?Getmac.getMac(function(r,a){if(r)return void e({account:i,"remember-passwd":o,password:""});var n=Path.join(Editor.dataPath,".info");if(Fs.existsSync(n)){var s=JSON.parse(Fs.readFileSync(n)),l=s[i],c="";if(l){var d=Crypto.createDecipher("aes-256-cbc",a);d.update(l,"hex","utf8"),c=d["final"]("utf8")}e({account:i,"remember-passwd":o,password:c,"login-type":t})}}):e({account:i,"remember-passwd":o,password:"","login-type":t})}),Ipc.on("login:save",function(e){var r=Editor.loadProfile("fireball","global");if(void 0!==e.account&&(r["last-login"]=e.account),r["login-type"]=e["login-type"],void 0!==e["remember-passwd"]&&(r["remember-passwd"]=e["remember-passwd"],e["remember-passwd"]===!1)){var i=Path.join(Editor.dataPath,".info");if(Fs.existsSync(i)){var o=JSON.parse(Fs.readFileSync(i));o[e.account]&&delete o[e.account],Fs.writeFileSync(i,JSON.stringify(o,null,2))}}r.save()}),Ipc.on("login:succeed",function(e){var r=Editor.loadProfile("fireball","global");r["last-login"]=e.account,r["login-type"]=e["login-type"],r["remember-passwd"]=e["remember-passwd"],r.save(),e["remember-passwd"]&&Getmac.getMac(function(r,i){if(r)return void Editor.error("Failed to remember your passwd.");var o=Crypto.createCipher("aes-256-cbc",i);o.update(e.password,"utf8","hex");var t=o["final"]("hex"),a=Path.join(Editor.dataPath,".info"),n={};Fs.existsSync(a)&&(n=JSON.parse(Fs.readFileSync(a))),n[e.account]=t,Fs.writeFileSync(a,JSON.stringify(n,null,2))}),Editor.sendToWindows("popup:login")})}var Fs=require("fire-fs"),Path=require("fire-path"),Ipc=require("ipc"),Crypto=require("crypto"),Getmac=require("getmac"),_projectPath=null,_requireLogin=!1;module.exports={initCommander:function(e){e.usage("[options] <project-path>").option("--test-login","Test login module in dev mode.")},init:function(e){Editor.log("Initializing fire"),_initFire(),_initLoginIpc(),Fire.info("Welcome to Fireball! The next-gen html5 game engine."),Editor.loadProfile("fireball","global",{"recently-opened":[],"last-login":"","remember-passwd":!0,"login-type":"account"}),e.args.length>0&&(_projectPath=e.args[0]),_requireLogin=!Editor.isDev||e.testLogin},run:function(){if(_requireLogin){var e=require(Editor.url("editor-core://login"));e.open(this.enter)}else this.enter()},enter:function(){if(_projectPath){var e=require(Editor.url("editor-core://fireball"));e.open({path:_projectPath})}else{var r=require(Editor.url("editor-core://dashboard"));r.open()}}};