<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>utils/api/builtin/fire-hierarchy/editor/panel/hierarchy-tree.js - Fireball Engine API</title>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/vendor/yui-min.js"></script>
</head>
<body>

<div id="doc">
    <header class="main-header">
        <div class="content">
            <div class="project-title">
                    <a href="http://docs-zh.fireball-x.com"><img class="logo" src="http://docs-zh.fireball-x.com/images/logo.png" title="Fireball Engine API"></a>
                    <h1 class="project-name">Fireball Engine API</h1> <span class="project-version">0.3.0</span>
                    <p class="description">Fireball is the game engine for the future.</p>
            </div>
            <ul class="jump-links">
                <li><a href="#index" class="index-jump-link">index</a></li>
                <li><a href="#top" class="top-jump-link">top</a></li>
            </ul>
        </div>
    </header>
    <div id="bd" class="main-body">

        <div id="docs-sidebar" class="sidebar apidocs">
            <div id="api-list">
                <div id="api-tabview" class="tabview">
                    <ul class="tabs">
                        <li><a href="#api-classes">Classes</a></li>
                        <li><a href="#api-modules">Modules</a></li>
                    </ul>
            
                    <div id="api-tabview-filter">
                        <input type="search" id="api-filter" placeholder="Type to filter APIs">
                    </div>
            
                    <div id="api-tabview-panel">
                        <ul id="api-classes" class="apis classes">
                            <li><a class="type" href="../classes/_CallbacksHandler.html">_CallbacksHandler</a></li>
                            <li><a class="type" href="../classes/_DeserializeInfo.html">_DeserializeInfo</a></li>
                            <li><a class="type" href="../classes/_ObjectFlags.html">_ObjectFlags</a></li>
                            <li><a class="type" href="../classes/_Runtime.RenderContext.html">_Runtime.RenderContext</a></li>
                            <li><a class="type" href="../classes/Asset.html">Asset</a></li>
                            <li><a class="type" href="../classes/AssetBundleBase.html">AssetBundleBase</a></li>
                            <li><a class="type" href="../classes/AssetLibrary.html">AssetLibrary</a></li>
                            <li><a class="type" href="../classes/AudioClip.html">AudioClip</a></li>
                            <li><a class="type" href="../classes/AudioSource.html">AudioSource</a></li>
                            <li><a class="type" href="../classes/BitmapFont.html">BitmapFont</a></li>
                            <li><a class="type" href="../classes/BitmapText.html">BitmapText</a></li>
                            <li><a class="type" href="../classes/CallbacksInvoker.html">CallbacksInvoker</a></li>
                            <li><a class="type" href="../classes/Camera.html">Camera</a></li>
                            <li><a class="type" href="../classes/Color.html">Color</a></li>
                            <li><a class="type" href="../classes/Component.html">Component</a></li>
                            <li><a class="type" href="../classes/ContentStrategyType.html">ContentStrategyType</a></li>
                            <li><a class="type" href="../classes/Editor.html">Editor</a></li>
                            <li><a class="type" href="../classes/Engine.html">Engine</a></li>
                            <li><a class="type" href="../classes/Entity.html">Entity</a></li>
                            <li><a class="type" href="../classes/EqualToFrame.html">EqualToFrame</a></li>
                            <li><a class="type" href="../classes/Event.html">Event</a></li>
                            <li><a class="type" href="../classes/EventTarget.html">EventTarget</a></li>
                            <li><a class="type" href="../classes/Fire.html">Fire</a></li>
                            <li><a class="type" href="../classes/FixedHeight.html">FixedHeight</a></li>
                            <li><a class="type" href="../classes/FObject.html">FObject</a></li>
                            <li><a class="type" href="../classes/FontType.html">FontType</a></li>
                            <li><a class="type" href="../classes/HashObject.html">HashObject</a></li>
                            <li><a class="type" href="../classes/Input.html">Input</a></li>
                            <li><a class="type" href="../classes/Intersection.html">Intersection</a></li>
                            <li><a class="type" href="../classes/JS.html">JS</a></li>
                            <li><a class="type" href="../classes/KeyboardEvent.html">KeyboardEvent</a></li>
                            <li><a class="type" href="../classes/LoadManager.html">LoadManager</a></li>
                            <li><a class="type" href="../classes/Math.html">Math</a></li>
                            <li><a class="type" href="../classes/Matrix23.html">Matrix23</a></li>
                            <li><a class="type" href="../classes/ModifierKeyStates.html">ModifierKeyStates</a></li>
                            <li><a class="type" href="../classes/MouseEvent.html">MouseEvent</a></li>
                            <li><a class="type" href="../classes/NoScale.html">NoScale</a></li>
                            <li><a class="type" href="../classes/Path.html">Path</a></li>
                            <li><a class="type" href="../classes/Playable.html">Playable</a></li>
                            <li><a class="type" href="../classes/Rect.html">Rect</a></li>
                            <li><a class="type" href="../classes/Renderer.html">Renderer</a></li>
                            <li><a class="type" href="../classes/Resources.html">Resources</a></li>
                            <li><a class="type" href="../classes/ResourcesBundle.html">ResourcesBundle</a></li>
                            <li><a class="type" href="../classes/Screen.html">Screen</a></li>
                            <li><a class="type" href="../classes/Screen.ContainerStrategy.html">Screen.ContainerStrategy</a></li>
                            <li><a class="type" href="../classes/Screen.ContentStrategy.html">Screen.ContentStrategy</a></li>
                            <li><a class="type" href="../classes/Sprite.html">Sprite</a></li>
                            <li><a class="type" href="../classes/SpriteAnimation.html">SpriteAnimation</a></li>
                            <li><a class="type" href="../classes/SpriteAnimationClip.html">SpriteAnimationClip</a></li>
                            <li><a class="type" href="../classes/SpriteAnimationClip.StopAction.html">SpriteAnimationClip.StopAction</a></li>
                            <li><a class="type" href="../classes/SpriteAnimationClip.WrapMode.html">SpriteAnimationClip.WrapMode</a></li>
                            <li><a class="type" href="../classes/SpriteAnimationState.html">SpriteAnimationState</a></li>
                            <li><a class="type" href="../classes/SpriteRenderer.html">SpriteRenderer</a></li>
                            <li><a class="type" href="../classes/TextAlign.html">TextAlign</a></li>
                            <li><a class="type" href="../classes/TextAnchor.html">TextAnchor</a></li>
                            <li><a class="type" href="../classes/Texture.html">Texture</a></li>
                            <li><a class="type" href="../classes/Texture.FilterMode.html">Texture.FilterMode</a></li>
                            <li><a class="type" href="../classes/Texture.WrapMode.html">Texture.WrapMode</a></li>
                            <li><a class="type" href="../classes/Time.html">Time</a></li>
                            <li><a class="type" href="../classes/Transform.html">Transform</a></li>
                            <li><a class="type" href="../classes/Vec2.html">Vec2</a></li>
                        </ul>
            
                        <ul id="api-modules" class="apis modules">
                            <li><a class="module" href="../modules/Editor.html">Editor</a></li>
                            <li><a class="module" href="../modules/Fire.html">Fire</a></li>
                            <li><a class="module" href="../modules/Math.html">Math</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <div id="docs-main" class="apidocs">
            <div class="content container">
                <h1 class="file-heading">File: utils/api/builtin/fire-hierarchy/editor/panel/hierarchy-tree.js</h1>
                
                <div class="file">
                    <pre class="code prettyprint linenums">
                /**
                 * @module Fire
                 * @class Fire
                 */
                Polymer({
                    created: function () {
                        this.super();
                
                        // dragging
                        this.dragenterCnt = 0;
                        this.curDragoverEL = null;
                        this.lastDragoverEL = null;
                
                        // debug
                        hierarchy = this;
                    },
                
                    ready: function () {
                        this.super();
                
                        // register events
                        this.addEventListener( &quot;dragenter&quot;, function (event) {
                            ++this.dragenterCnt;
                        }, true);
                
                        this.addEventListener( &quot;dragleave&quot;, function (event) {
                            --this.dragenterCnt;
                            if ( this.dragenterCnt === 0 ) {
                                this.resetDragState();
                            }
                        }, true);
                
                        //
                        this.refresh();
                    },
                
                    getContextMenuTemplate: function () {
                        var template = [
                            // Duplicate
                            {
                                label: &#x27;Duplicate&#x27;,
                                message: &#x27;hierarchy-menu:duplicate&#x27;,
                            },
                
                            // =====================
                            { type: &#x27;separator&#x27; },
                
                            // Rename
                            {
                                label: &#x27;Rename&#x27;,
                                message: &#x27;hierarchy-menu:rename&#x27;,
                            },
                
                            // Delete
                            {
                                label: &#x27;Delete&#x27;,
                                message: &#x27;hierarchy-menu:delete&#x27;,
                            },
                
                            // =====================
                            { type: &#x27;separator&#x27; },
                        ];
                        // append Create menu
                        var createMenu = Editor.plugins.hierarchy.getMenuTemplate(&#x27;hierarchy-menu&#x27;);
                        template = template.concat(createMenu);
                        //
                        return template;
                    },
                
                    newItem: function ( name, id, parentEL ) {
                        var newEL = new HierarchyItem();
                        this.initItem(newEL, name, id, parentEL);
                        return newEL;
                    },
                
                    setItemIndex: function ( id, nextIdInGame ) {
                        var el = this.idToItem[id];
                        if ( !el ) {
                            //Fire.warn( &#x27;Can not find source element: &#x27; + id );
                            return;
                        }
                        if ( nextIdInGame ) {
                            var next = this.idToItem[nextIdInGame];
                            if ( !next ) {
                                //Fire.warn( &#x27;Can not find next element: &#x27; + nextIdInGame );
                                return;
                            }
                            el.parentElement.insertBefore(el, next);
                        }
                        else {
                            el.parentElement.appendChild(el);
                        }
                    },
                
                    //beginLoad: function () {
                    //    // TODO lock
                    //    console.time(&#x27;hierarchy-tree:load&#x27;);
                    //    // TODO clear
                    //},
                
                    //endLoad: function () {
                    //    // TODO unlock
                    //    console.timeEnd(&#x27;hierarchy-tree:load&#x27;);
                    //},
                
                    refresh: function () {
                        this.clear();
                
                        // 这里只是直接读取场景，但场景在读取过程中很可能发生改变，也可能在读取之前改变的消息这时并没收到。
                        // 目前先假设在读取之前和读取过程中，场景不会改变。
                
                        if (!Fire.Engine._scene) {
                            return;
                        }
                        var selection = Editor.Selection.entities;
                        function createItem(entity, parentEL) {
                            var el = Editor.plugins.hierarchy.newEntity(entity.name, entity._objFlags, entity.id, parentEL);
                            if (el) {
                                var children = entity._children;
                                for (var i = 0, len = children.length; i &lt; len; i++) {
                                    createItem(children[i], el);
                                }
                                el.selected = selection.indexOf(el.userId) !== -1;
                            }
                        }
                        var entities = Fire.Engine._scene.entities;
                        for (var i = 0, len = entities.length; i &lt; len; i++) {
                            createItem(entities[i]);
                        }
                    },
                
                    highlightBorder: function ( item ) {
                        if ( item &amp;&amp; item instanceof HierarchyItem ) {
                            var style = this.$.highlightBorder.style;
                            style.display = &quot;block&quot;;
                            style.left = (item.offsetLeft-2) + &quot;px&quot;;
                            style.top = (item.offsetTop-1) + &quot;px&quot;;
                            style.width = (item.offsetWidth+4) + &quot;px&quot;;
                            style.height = (item.offsetHeight+3) + &quot;px&quot;;
                        }
                        else {
                            this.$.highlightBorder.style.display = &quot;none&quot;;
                        }
                    },
                
                    highlightInsert: function ( item, position ) {
                        if ( item ) {
                            var style = this.$.insertLine.style;
                
                            if ( position === &#x27;inside&#x27; ) {
                                if ( !item.folded &amp;&amp; item.firstElementChild ) {
                                    style.display = &quot;block&quot;;
                                    style.top = (item.firstElementChild.offsetTop-1) + &quot;px&quot;;
                                    style.left = (item.firstElementChild.offsetLeft-2) + &quot;px&quot;;
                                    style.width = (item.firstElementChild.offsetWidth+4) + &quot;px&quot;;
                                    style.height = &quot;0px&quot;;
                                }
                                else {
                                    style.display = &quot;none&quot;;
                                }
                            }
                            else {
                                style.display = &quot;block&quot;;
                
                                style.left = (item.offsetLeft-2) + &quot;px&quot;;
                                style.width = (item.offsetWidth+4) + &quot;px&quot;;
                
                                if ( position === &#x27;before&#x27; )
                                    style.top = item.offsetTop + &quot;px&quot;;
                                else if ( position === &#x27;after&#x27;  )
                                    style.top = (item.offsetTop + item.offsetHeight) + &quot;px&quot;;
                                style.height = &quot;0px&quot;;
                            }
                        }
                    },
                
                    cancelHighligting: function () {
                        this.$.highlightBorder.style.display = &quot;none&quot;;
                        this.$.insertLine.style.display = &quot;none&quot;;
                    },
                
                    resetDragState: function () {
                        this.cancelHighligting();
                
                        this.curDragoverEL = null;
                        this.lastDragoverEL = null;
                        this.dragenterCnt = 0;
                    },
                
                    moveEntities: function ( targetEL, entities, nextSiblingId ) {
                        // TODO: Editor.Selection.filter(entities,&#x27;sorted&#x27;);
                        Editor.sendToMainWindow(&#x27;engine:move-entities&#x27;, {
                            &#x27;entity-id-list&#x27;: entities,
                            &#x27;parent-id&#x27;: targetEL ? targetEL.userId : null,
                            &#x27;next-sibling-id&#x27;: nextSiblingId
                        });
                    },
                
                    createEntityFromContextSelect: function () {
                        var contextSelection = Editor.Selection.contextEntities;
                        if ( contextSelection.length &gt; 0 ) {
                            var targetEL = this.idToItem[contextSelection[0]];
                            var parentEL = targetEL.parentElement;
                            if ( parentEL &amp;&amp; parentEL instanceof HierarchyItem ) {
                                Editor.sendToMainWindow(&#x27;engine:create-entity&#x27;, {
                                    &#x27;parent-id&#x27;: parentEL.userId,
                                    &#x27;options&#x27;: {
                                        &#x27;select-in-hierarchy&#x27;: true
                                    }
                                });
                            }
                            else {
                                Editor.sendToMainWindow(&#x27;engine:create-entity&#x27;, {
                                    &#x27;options&#x27;: {
                                        &#x27;select-in-hierarchy&#x27;: true
                                    }
                                });
                            }
                        }
                        else {
                            Editor.sendToMainWindow(&#x27;engine:create-entity&#x27;, {
                                &#x27;options&#x27;: {
                                    &#x27;select-in-hierarchy&#x27;: true
                                }
                            });
                        }
                    },
                
                    createChildEntityFromContextSelect: function () {
                        var contextSelection = Editor.Selection.contextEntities;
                        if ( contextSelection.length &gt; 0 ) {
                            var targetEL = this.idToItem[contextSelection[0]];
                            Editor.sendToMainWindow(&#x27;engine:create-entity&#x27;, {
                                &#x27;parent-id&#x27;: targetEL.userId,
                                &#x27;options&#x27;: {
                                    &#x27;select-in-hierarchy&#x27;: true
                                }
                            });
                        }
                        else {
                            var activeId = Editor.Selection.activeEntityId;
                            Editor.sendToMainWindow(&#x27;engine:create-entity&#x27;, {
                                &#x27;parent-id&#x27;: activeId,
                                &#x27;options&#x27;: {
                                    &#x27;select-in-hierarchy&#x27;: true
                                }
                            });
                        }
                    },
                
                    renameEntityFromContextSelect: function () {
                        var contextSelection = Editor.Selection.contextEntities;
                        if ( contextSelection.length &gt; 0 ) {
                            var targetEL = this.idToItem[contextSelection[0]];
                            this.rename(targetEL);
                        }
                    },
                
                    deleteEntityFromContextSelect: function () {
                        var contextSelection = Editor.Selection.contextEntities;
                        Editor.sendToMainWindow(&#x27;engine:delete-entities&#x27;, {
                            &#x27;entity-id-list&#x27;: contextSelection
                        });
                    },
                
                    duplicateEntityFromContextSelect: function () {
                        var contextSelection = Editor.Selection.contextEntities;
                        var entities = this.getToplevelElements(contextSelection).map(function (element) {
                            return element &amp;&amp; element.userId;
                        });
                        Editor.sendToMainWindow(&#x27;engine:duplicate-entities&#x27;, {
                            &#x27;entity-id-list&#x27;: entities
                        });
                    },
                
                    deleteSelection: function () {
                        Editor.sendToMainWindow(&#x27;engine:delete-entities&#x27;, {
                            &#x27;entity-id-list&#x27;: Editor.Selection.entities
                        });
                    },
                
                    duplicateSelection: function () {
                        var entities = this.getToplevelElements(Editor.Selection.entities).map(function (element) {
                            return element &amp;&amp; element.userId;
                        });
                        Editor.sendToMainWindow(&#x27;engine:duplicate-entities&#x27;, {
                            &#x27;entity-id-list&#x27;: entities
                        });
                    },
                
                    select: function ( element ) {
                        Editor.Selection.selectEntity(element.userId, true, true);
                    },
                
                    clearSelect: function () {
                        Editor.Selection.clearEntity();
                        this.activeElement = null;
                        this.shiftStartElement = null;
                    },
                
                    selectingAction: function (event) {
                        event.stopPropagation();
                        this.focus();
                
                        var shiftStartEL = this.shiftStartElement;
                        this.shiftStartElement = null;
                
                        if ( event.detail.shift ) {
                            if ( shiftStartEL === null ) {
                                shiftStartEL = this.activeElement;
                            }
                
                            this.shiftStartElement = shiftStartEL;
                
                            var el = this.shiftStartElement;
                            var userIds = [];
                
                            if ( shiftStartEL !== event.target ) {
                                if ( this.shiftStartElement.offsetTop &lt; event.target.offsetTop ) {
                                    while ( el !== event.target ) {
                                        userIds.push(el.userId);
                                        el = this.nextItem(el);
                                    }
                                }
                                else {
                                    while ( el !== event.target ) {
                                        userIds.push(el.userId);
                                        el = this.prevItem(el);
                                    }
                                }
                            }
                            userIds.push(event.target.userId);
                            Editor.Selection.selectEntity(userIds, true, false);
                        }
                        else if ( event.detail.toggle ) {
                            if ( event.target.selected ) {
                                Editor.Selection.unselectEntity(event.target.userId, false);
                            }
                            else {
                                Editor.Selection.selectEntity(event.target.userId, false, false);
                            }
                        }
                        else {
                            // if target already selected, do not unselect others
                            if ( !event.target.selected ) {
                                Editor.Selection.selectEntity(event.target.userId, true, false);
                            }
                        }
                    },
                
                    selectAction: function (event) {
                        event.stopPropagation();
                
                        if ( event.detail.shift ) {
                            Editor.Selection.confirm();
                        }
                        else if ( event.detail.toggle ) {
                            Editor.Selection.confirm();
                        }
                        else {
                            Editor.Selection.selectEntity(event.target.userId, true);
                        }
                    },
                
                    renameConfirmAction: function (event) {
                        event.stopPropagation();
                
                        var renamingEL = this.$.nameInput.renamingEL;
                
                        this.$.nameInput.style.display = &#x27;none&#x27;;
                        this.$.content.appendChild(this.$.nameInput);
                        this.$.nameInput.renamingEL = null;
                
                        // NOTE: the rename confirm will invoke focusoutAction
                        window.requestAnimationFrame( function () {
                            this.focus();
                        }.bind(this));
                
                        renamingEL._renaming = false;
                
                        // TODO: pull up to view ?
                        Editor.sendToMainWindow(&#x27;engine:rename-entity&#x27;, {
                            id: renamingEL.userId,
                            name: event.target.value
                        } );
                    },
                
                    openAction: function (event) {
                        if ( event.target instanceof HierarchyItem ) {
                            // TODO: align scene view to target
                        }
                        event.stopPropagation();
                    },
                
                    contextmenuAction: function (event) {
                        event.preventDefault();
                        event.stopPropagation();
                
                        var Remote = require(&#x27;remote&#x27;);
                        Remote.getCurrentWindow().focus();
                
                        this.resetDragState();
                
                        //
                        var curContextID = null;
                        if ( event.target instanceof HierarchyItem ) {
                            curContextID = event.target.userId;
                        }
                
                        Editor.Selection.setContextEntity(curContextID);
                
                        Editor.popupMenu(this.getContextMenuTemplate());
                    },
                
                    keydownAction: function (event) {
                        this.super([event]);
                        if (event.cancelBubble) {
                            return;
                        }
                
                        switch ( event.which ) {
                            // delete (Windows)
                            case 46:
                                this.deleteSelection();
                                event.stopPropagation();
                            break;
                
                            // command + delete (Mac)
                            case 8:
                                if ( event.metaKey ) {
                                    this.deleteSelection();
                                }
                                event.stopPropagation();
                            break;
                        }
                    },
                
                    dragstartAction: function ( event ) {
                        event.stopPropagation();
                
                        EditorUI.DragDrop.start( event.dataTransfer, &#x27;move&#x27;, &#x27;entity&#x27;, Editor.Selection.entities.map( function (item) {
                            var ent = Editor.getInstanceById(item);
                            return { name: ent.name, id: item };
                        }) );
                    },
                
                    dragendAction: function (event) {
                        EditorUI.DragDrop.end();
                
                        this.resetDragState();
                        Editor.Selection.cancel();
                    },
                
                    dragoverAction: function (event) {
                        var dragType = EditorUI.DragDrop.type(event.dataTransfer);
                        if ( dragType !== &quot;entity&quot; &amp;&amp; dragType !== &quot;asset&quot; ) {
                            EditorUI.DragDrop.allowDrop( event.dataTransfer, false );
                            return;
                        }
                
                        //
                        event.preventDefault();
                        event.stopPropagation();
                
                        //
                        if ( event.target ) {
                            this.lastDragoverEL = this.curDragoverEL;
                            var position;
                            var bounding = this.getBoundingClientRect();
                            var offsetY = event.clientY - bounding.top + this.scrollTop;
                            var target = event.target;
                
                            //
                            if ( target !== this.lastDragoverEL ) {
                                if ( target === this ) {
                                    if ( offsetY &lt;= this.firstElementChild.offsetTop ) {
                                        target = this.firstElementChild;
                                    }
                                    else {
                                        target = this.lastElementChild;
                                    }
                                }
                                this.curDragoverEL = target;
                            }
                
                            // highlight insertion
                            if ( offsetY &lt;= (target.offsetTop + target.offsetHeight * 0.3) )
                                position = &#x27;before&#x27;;
                            else if ( offsetY &gt;= (target.offsetTop + target.offsetHeight * 0.7) )
                                position = &#x27;after&#x27;;
                            else
                                position = &#x27;inside&#x27;;
                
                            if ( position === &#x27;inside&#x27; ) {
                                this.highlightBorder( target );
                            }
                            else {
                                this.highlightBorder( target.parentElement );
                            }
                            this.highlightInsert( target, position );
                
                            //
                            EditorUI.DragDrop.allowDrop(event.dataTransfer, true);
                        }
                
                        //
                        var dropEffect = &quot;none&quot;;
                        if ( dragType === &quot;asset&quot; ) {
                            dropEffect = &quot;copy&quot;;
                        }
                        else if ( dragType === &quot;entity&quot; ) {
                            dropEffect = &quot;move&quot;;
                        }
                        EditorUI.DragDrop.updateDropEffect(event.dataTransfer, dropEffect);
                    },
                
                    dropAction: function ( event ) {
                        var dragType = EditorUI.DragDrop.type(event.dataTransfer);
                        if ( dragType !== &#x27;asset&#x27; &amp;&amp; dragType !== &#x27;entity&#x27; )
                            return;
                
                        event.preventDefault();
                        event.stopPropagation();
                
                        var items = EditorUI.DragDrop.drop(event.dataTransfer);
                
                        this.resetDragState();
                        Editor.Selection.cancel();
                
                        if ( items.length &gt; 0 ) {
                            // get next sibliing id
                            var hoverTarget = event.target;
                            var targetEL = null;
                            var nextSiblingId = null;
                            var bounding = this.getBoundingClientRect();
                            var offsetY = event.clientY - bounding.top + this.scrollTop;
                
                            if ( hoverTarget === this ) {
                                targetEL = null;
                                if ( this.firstElementChild ) {
                                    if ( offsetY &lt;= this.firstElementChild.offsetTop ) {
                                        nextSiblingId = this.firstElementChild.userId;
                                    }
                                }
                            }
                            else {
                                if ( offsetY &lt;= (hoverTarget.offsetTop + hoverTarget.offsetHeight * 0.3) ) {
                                    nextSiblingId = hoverTarget.userId;
                                    targetEL = hoverTarget.parentElement;
                                }
                                else if ( offsetY &gt;= (hoverTarget.offsetTop + hoverTarget.offsetHeight * 0.7) ) {
                                    if ( hoverTarget.nextElementSibling ) {
                                        nextSiblingId = hoverTarget.nextElementSibling.userId;
                                    }
                                    else {
                                        nextSiblingId = null;
                                    }
                                    targetEL = hoverTarget.parentElement;
                                }
                                else {
                                    nextSiblingId = null;
                                    targetEL = hoverTarget;
                                    if ( targetEL.firstElementChild ) {
                                        nextSiblingId = targetEL.firstElementChild.userId;
                                    }
                                }
                            }
                
                            // if target is root, set it to null
                            if ( targetEL === this ) {
                                targetEL = null;
                            }
                
                            // process
                            if ( dragType === &#x27;entity&#x27; ) {
                                this.moveEntities( targetEL, items, nextSiblingId );
                            }
                            else if ( dragType === &#x27;asset&#x27; ) {
                                var parentEnt = null;
                                if ( targetEL )
                                    parentEnt = Editor.getInstanceById(targetEL.userId);
                
                                Editor.Selection.clearEntity();
                                var onload = function ( err, asset ) {
                                    if ( asset &amp;&amp; asset.createEntity ) {
                                        asset.createEntity( function ( ent ) {
                                            ent.parent = parentEnt;
                                            ent.transform.position = new Fire.Vec2(0,0);
                                            Editor.Selection.selectEntity( ent.id, false, true );
                                            Editor.sendToMainWindow( &#x27;scene:dirty&#x27;, ent.id );
                                            Editor.sendToWindows( &#x27;scene:repaint&#x27; );
                                            Fire.AssetLibrary.cacheAsset( asset );
                                        }.bind(this) );
                                    }
                                }.bind(this);
                
                                for ( var i = 0; i &lt; items.length; ++i ) {
                                    Fire.AssetLibrary.loadAssetInEditor( items[i], onload );
                                }
                            }
                        }
                    },
                
                });
                
                    </pre>
                </div>
            </div>
        </div>

    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/vendor/jquery.min.js"></script>
<script src="../assets/js/jquery-offscreen-trigger.js"></script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
